{
  "version": 4,
  "terraform_version": "1.2.4",
  "serial": 2034,
  "lineage": "c5dcb7f9-5137-1aa6-4fcb-fa7e45b179dd",
  "outputs": {
    "managed_ad_dns_ips": {
      "value": [
        "10.0.0.62",
        "10.0.0.79"
      ],
      "type": [
        "set",
        "string"
      ]
    },
    "managed_ad_id": {
      "value": "d-9a6719c031",
      "type": "string"
    },
    "managed_ad_password_secret_id": {
      "value": "arn:aws:secretsmanager:us-east-2:156285977455:secret:corp.example.com-MAD-Secret-dnb6z912-HIrOgH",
      "type": "string"
    },
    "managed_ad_sg_id": {
      "value": "sg-0ff92f05c471afb1e",
      "type": "string"
    }
  },
  "resources": [
    {
      "mode": "data",
      "type": "aws_ami",
      "name": "windows_2022",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "architecture": "x86_64",
            "arn": "arn:aws:ec2:us-east-2::image/ami-094a92978724fc94c",
            "block_device_mappings": [
              {
                "device_name": "/dev/sda1",
                "ebs": {
                  "delete_on_termination": "true",
                  "encrypted": "false",
                  "iops": "0",
                  "snapshot_id": "snap-09490bf8ae1ff8058",
                  "throughput": "0",
                  "volume_size": "30",
                  "volume_type": "gp2"
                },
                "no_device": "",
                "virtual_name": ""
              },
              {
                "device_name": "xvdca",
                "ebs": {},
                "no_device": "",
                "virtual_name": "ephemeral0"
              },
              {
                "device_name": "xvdcb",
                "ebs": {},
                "no_device": "",
                "virtual_name": "ephemeral1"
              },
              {
                "device_name": "xvdcc",
                "ebs": {},
                "no_device": "",
                "virtual_name": "ephemeral2"
              },
              {
                "device_name": "xvdcd",
                "ebs": {},
                "no_device": "",
                "virtual_name": "ephemeral3"
              },
              {
                "device_name": "xvdce",
                "ebs": {},
                "no_device": "",
                "virtual_name": "ephemeral4"
              },
              {
                "device_name": "xvdcf",
                "ebs": {},
                "no_device": "",
                "virtual_name": "ephemeral5"
              },
              {
                "device_name": "xvdcg",
                "ebs": {},
                "no_device": "",
                "virtual_name": "ephemeral6"
              },
              {
                "device_name": "xvdch",
                "ebs": {},
                "no_device": "",
                "virtual_name": "ephemeral7"
              },
              {
                "device_name": "xvdci",
                "ebs": {},
                "no_device": "",
                "virtual_name": "ephemeral8"
              },
              {
                "device_name": "xvdcj",
                "ebs": {},
                "no_device": "",
                "virtual_name": "ephemeral9"
              },
              {
                "device_name": "xvdck",
                "ebs": {},
                "no_device": "",
                "virtual_name": "ephemeral10"
              },
              {
                "device_name": "xvdcl",
                "ebs": {},
                "no_device": "",
                "virtual_name": "ephemeral11"
              },
              {
                "device_name": "xvdcm",
                "ebs": {},
                "no_device": "",
                "virtual_name": "ephemeral12"
              },
              {
                "device_name": "xvdcn",
                "ebs": {},
                "no_device": "",
                "virtual_name": "ephemeral13"
              },
              {
                "device_name": "xvdco",
                "ebs": {},
                "no_device": "",
                "virtual_name": "ephemeral14"
              },
              {
                "device_name": "xvdcp",
                "ebs": {},
                "no_device": "",
                "virtual_name": "ephemeral15"
              },
              {
                "device_name": "xvdcq",
                "ebs": {},
                "no_device": "",
                "virtual_name": "ephemeral16"
              },
              {
                "device_name": "xvdcr",
                "ebs": {},
                "no_device": "",
                "virtual_name": "ephemeral17"
              },
              {
                "device_name": "xvdcs",
                "ebs": {},
                "no_device": "",
                "virtual_name": "ephemeral18"
              },
              {
                "device_name": "xvdct",
                "ebs": {},
                "no_device": "",
                "virtual_name": "ephemeral19"
              },
              {
                "device_name": "xvdcu",
                "ebs": {},
                "no_device": "",
                "virtual_name": "ephemeral20"
              },
              {
                "device_name": "xvdcv",
                "ebs": {},
                "no_device": "",
                "virtual_name": "ephemeral21"
              },
              {
                "device_name": "xvdcw",
                "ebs": {},
                "no_device": "",
                "virtual_name": "ephemeral22"
              },
              {
                "device_name": "xvdcx",
                "ebs": {},
                "no_device": "",
                "virtual_name": "ephemeral23"
              },
              {
                "device_name": "xvdcy",
                "ebs": {},
                "no_device": "",
                "virtual_name": "ephemeral24"
              },
              {
                "device_name": "xvdcz",
                "ebs": {},
                "no_device": "",
                "virtual_name": "ephemeral25"
              }
            ],
            "boot_mode": "",
            "creation_date": "2022-06-15T07:36:48.000Z",
            "deprecation_time": "2024-06-15T07:36:48.000Z",
            "description": "Microsoft Windows Server 2022 Full Locale English AMI provided by Amazon",
            "ena_support": true,
            "executable_users": null,
            "filter": [
              {
                "name": "name",
                "values": [
                  "Windows_Server-2022-English-Full-Base*"
                ]
              }
            ],
            "hypervisor": "xen",
            "id": "ami-094a92978724fc94c",
            "image_id": "ami-094a92978724fc94c",
            "image_location": "amazon/Windows_Server-2022-English-Full-Base-2022.06.15",
            "image_owner_alias": "amazon",
            "image_type": "machine",
            "kernel_id": "",
            "most_recent": true,
            "name": "Windows_Server-2022-English-Full-Base-2022.06.15",
            "name_regex": null,
            "owner_id": "801119661308",
            "owners": [
              "amazon"
            ],
            "platform": "windows",
            "platform_details": "Windows",
            "product_codes": [],
            "public": true,
            "ramdisk_id": "",
            "root_device_name": "/dev/sda1",
            "root_device_type": "ebs",
            "root_snapshot_id": "snap-09490bf8ae1ff8058",
            "sriov_net_support": "simple",
            "state": "available",
            "state_reason": {
              "code": "UNSET",
              "message": "UNSET"
            },
            "tags": {},
            "tpm_support": "",
            "usage_operation": "RunInstances:0002",
            "virtualization_type": "hvm"
          },
          "sensitive_attributes": []
        }
      ]
    },
    {
      "mode": "data",
      "type": "aws_availability_zones",
      "name": "available",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "all_availability_zones": null,
            "exclude_names": null,
            "exclude_zone_ids": null,
            "filter": [
              {
                "name": "opt-in-status",
                "values": [
                  "opt-in-not-required"
                ]
              }
            ],
            "group_names": [
              "us-east-2"
            ],
            "id": "us-east-2",
            "names": [
              "us-east-2a",
              "us-east-2b",
              "us-east-2c"
            ],
            "state": "available",
            "zone_ids": [
              "use2-az1",
              "use2-az2",
              "use2-az3"
            ]
          },
          "sensitive_attributes": []
        }
      ]
    },
    {
      "mode": "data",
      "type": "aws_caller_identity",
      "name": "main",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "account_id": "156285977455",
            "arn": "arn:aws:iam::156285977455:user/girvenj",
            "id": "156285977455",
            "user_id": "AIDASIY26YNXYXAMQ3AR7"
          },
          "sensitive_attributes": []
        }
      ]
    },
    {
      "mode": "data",
      "type": "aws_iam_policy_document",
      "name": "ec2",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "id": "2585394954",
            "json": "{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Sid\": \"\",\n      \"Effect\": \"Allow\",\n      \"Action\": [\n        \"secretsmanager:GetSecretValue\",\n        \"secretsmanager:DescribeSecret\"\n      ],\n      \"Resource\": [\n        \"arn:aws:secretsmanager:us-east-2:156285977455:secret:onpremises.local-Onprem-Secret-dnb6z912-6YfVOP\",\n        \"arn:aws:secretsmanager:us-east-2:156285977455:secret:corp.example.com-MAD-Secret-dnb6z912-HIrOgH\"\n      ]\n    },\n    {\n      \"Sid\": \"\",\n      \"Effect\": \"Allow\",\n      \"Action\": [\n        \"ssm:ListCommands\",\n        \"ssm:ListCommandInvocations\",\n        \"ssm:GetAutomationExecution\",\n        \"ssm:DescribeInstanceInformation\",\n        \"ec2:DescribeSecurityGroups\",\n        \"ec2:DescribeInstances\",\n        \"ds:VerifyTrust\",\n        \"ds:DescribeTrusts\",\n        \"ds:CreateTrust\",\n        \"ds:CreateConditionalForwarder\"\n      ],\n      \"Resource\": \"*\"\n    },\n    {\n      \"Sid\": \"\",\n      \"Effect\": \"Allow\",\n      \"Action\": \"ssm:StartAutomationExecution\",\n      \"Resource\": [\n        \"arn:aws:ssm:us-east-2:156285977455:automation-definition/SSM-Pki-dnb6z912:$DEFAULT\",\n        \"arn:aws:ssm:us-east-2:156285977455:automation-definition/SSM-Baseline-dnb6z912:$DEFAULT\",\n        \"arn:aws:ssm:us-east-2:156285977455:automation-definition/SSM-AuditPol-dnb6z912:$DEFAULT\"\n      ]\n    },\n    {\n      \"Sid\": \"\",\n      \"Effect\": \"Allow\",\n      \"Action\": \"ssm:SendCommand\",\n      \"Resource\": [\n        \"arn:aws:ssm:us-east-2:*:document/AWS-RunRemoteScript\",\n        \"arn:aws:ssm:us-east-2:*:document/AWS-RunPowerShellScript\"\n      ]\n    },\n    {\n      \"Sid\": \"\",\n      \"Effect\": \"Allow\",\n      \"Action\": \"ssm:SendCommand\",\n      \"Resource\": \"arn:aws:ec2:us-east-2:156285977455:instance/*\",\n      \"Condition\": {\n        \"ForAnyValue:StringEquals\": {\n          \"ssm:ResourceTag/aws:cloudformation:stack-name\": [\n            \"instances-rootdc-dnb6z912\",\n            \"instances-non-rootdc-dnb6z912\"\n          ]\n        }\n      }\n    },\n    {\n      \"Sid\": \"\",\n      \"Effect\": \"Allow\",\n      \"Action\": \"cloudformation:SignalResource\",\n      \"Resource\": [\n        \"arn:aws:cloudformation:us-east-2:156285977455:stack/instances-rootdc-dnb6z912/*\",\n        \"arn:aws:cloudformation:us-east-2:156285977455:stack/instances-non-rootdc-dnb6z912/*\"\n      ]\n    }\n  ]\n}",
            "override_json": null,
            "override_policy_documents": null,
            "policy_id": null,
            "source_json": null,
            "source_policy_documents": null,
            "statement": [
              {
                "actions": [
                  "secretsmanager:DescribeSecret",
                  "secretsmanager:GetSecretValue"
                ],
                "condition": [],
                "effect": "Allow",
                "not_actions": [],
                "not_principals": [],
                "not_resources": [],
                "principals": [],
                "resources": [
                  "arn:aws:secretsmanager:us-east-2:156285977455:secret:corp.example.com-MAD-Secret-dnb6z912-HIrOgH",
                  "arn:aws:secretsmanager:us-east-2:156285977455:secret:onpremises.local-Onprem-Secret-dnb6z912-6YfVOP"
                ],
                "sid": ""
              },
              {
                "actions": [
                  "ds:CreateConditionalForwarder",
                  "ds:CreateTrust",
                  "ds:DescribeTrusts",
                  "ds:VerifyTrust",
                  "ec2:DescribeInstances",
                  "ec2:DescribeSecurityGroups",
                  "ssm:DescribeInstanceInformation",
                  "ssm:GetAutomationExecution",
                  "ssm:ListCommandInvocations",
                  "ssm:ListCommands"
                ],
                "condition": [],
                "effect": "Allow",
                "not_actions": [],
                "not_principals": [],
                "not_resources": [],
                "principals": [],
                "resources": [
                  "*"
                ],
                "sid": ""
              },
              {
                "actions": [
                  "ssm:StartAutomationExecution"
                ],
                "condition": [],
                "effect": "Allow",
                "not_actions": [],
                "not_principals": [],
                "not_resources": [],
                "principals": [],
                "resources": [
                  "arn:aws:ssm:us-east-2:156285977455:automation-definition/SSM-AuditPol-dnb6z912:$DEFAULT",
                  "arn:aws:ssm:us-east-2:156285977455:automation-definition/SSM-Baseline-dnb6z912:$DEFAULT",
                  "arn:aws:ssm:us-east-2:156285977455:automation-definition/SSM-Pki-dnb6z912:$DEFAULT"
                ],
                "sid": ""
              },
              {
                "actions": [
                  "ssm:SendCommand"
                ],
                "condition": [],
                "effect": "Allow",
                "not_actions": [],
                "not_principals": [],
                "not_resources": [],
                "principals": [],
                "resources": [
                  "arn:aws:ssm:us-east-2:*:document/AWS-RunPowerShellScript",
                  "arn:aws:ssm:us-east-2:*:document/AWS-RunRemoteScript"
                ],
                "sid": ""
              },
              {
                "actions": [
                  "ssm:SendCommand"
                ],
                "condition": [
                  {
                    "test": "ForAnyValue:StringEquals",
                    "values": [
                      "instances-rootdc-dnb6z912",
                      "instances-non-rootdc-dnb6z912"
                    ],
                    "variable": "ssm:ResourceTag/aws:cloudformation:stack-name"
                  }
                ],
                "effect": "Allow",
                "not_actions": [],
                "not_principals": [],
                "not_resources": [],
                "principals": [],
                "resources": [
                  "arn:aws:ec2:us-east-2:156285977455:instance/*"
                ],
                "sid": ""
              },
              {
                "actions": [
                  "cloudformation:SignalResource"
                ],
                "condition": [],
                "effect": "Allow",
                "not_actions": [],
                "not_principals": [],
                "not_resources": [],
                "principals": [],
                "resources": [
                  "arn:aws:cloudformation:us-east-2:156285977455:stack/instances-non-rootdc-dnb6z912/*",
                  "arn:aws:cloudformation:us-east-2:156285977455:stack/instances-rootdc-dnb6z912/*"
                ],
                "sid": ""
              }
            ],
            "version": "2012-10-17"
          },
          "sensitive_attributes": []
        }
      ]
    },
    {
      "mode": "data",
      "type": "aws_iam_policy_document",
      "name": "ec2_instance_assume_role_policy",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "id": "1903849331",
            "json": "{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Sid\": \"\",\n      \"Effect\": \"Allow\",\n      \"Action\": \"sts:AssumeRole\",\n      \"Principal\": {\n        \"Service\": \"ec2.amazonaws.com\"\n      }\n    }\n  ]\n}",
            "override_json": null,
            "override_policy_documents": null,
            "policy_id": null,
            "source_json": null,
            "source_policy_documents": null,
            "statement": [
              {
                "actions": [
                  "sts:AssumeRole"
                ],
                "condition": [],
                "effect": "Allow",
                "not_actions": [],
                "not_principals": [],
                "not_resources": [],
                "principals": [
                  {
                    "identifiers": [
                      "ec2.amazonaws.com"
                    ],
                    "type": "Service"
                  }
                ],
                "resources": [],
                "sid": ""
              }
            ],
            "version": "2012-10-17"
          },
          "sensitive_attributes": []
        }
      ]
    },
    {
      "mode": "data",
      "type": "aws_iam_policy_document",
      "name": "rds_instance_assume_role_policy",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "id": "1077238154",
            "json": "{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Sid\": \"\",\n      \"Effect\": \"Allow\",\n      \"Action\": \"sts:AssumeRole\",\n      \"Principal\": {\n        \"Service\": \"rds.amazonaws.com\"\n      }\n    }\n  ]\n}",
            "override_json": null,
            "override_policy_documents": null,
            "policy_id": null,
            "source_json": null,
            "source_policy_documents": null,
            "statement": [
              {
                "actions": [
                  "sts:AssumeRole"
                ],
                "condition": [],
                "effect": "Allow",
                "not_actions": [],
                "not_principals": [],
                "not_resources": [],
                "principals": [
                  {
                    "identifiers": [
                      "rds.amazonaws.com"
                    ],
                    "type": "Service"
                  }
                ],
                "resources": [],
                "sid": ""
              }
            ],
            "version": "2012-10-17"
          },
          "sensitive_attributes": []
        }
      ]
    },
    {
      "mode": "data",
      "type": "aws_partition",
      "name": "main",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "dns_suffix": "amazonaws.com",
            "id": "aws",
            "partition": "aws",
            "reverse_dns_prefix": "com.amazonaws"
          },
          "sensitive_attributes": []
        }
      ]
    },
    {
      "mode": "data",
      "type": "aws_region",
      "name": "main",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "description": "US East (Ohio)",
            "endpoint": "ec2.us-east-2.amazonaws.com",
            "id": "us-east-2",
            "name": "us-east-2"
          },
          "sensitive_attributes": []
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_cloudformation_stack",
      "name": "instances_non_rootdc",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "capabilities": null,
            "disable_rollback": false,
            "iam_role_arn": "",
            "id": "arn:aws:cloudformation:us-east-2:156285977455:stack/instances-non-rootdc-dnb6z912/6b7b2940-0192-11ed-8b3d-0ae9fe192416",
            "name": "instances-non-rootdc-dnb6z912",
            "notification_arns": null,
            "on_failure": null,
            "outputs": {
              "ChildOnpremDomainControllerInstanceID": "i-027545cee3ccdd33b",
              "ChildOnpremDomainControllerInstancePrivateIP": "10.0.0.45",
              "MADMgmtInstanceID": "i-00c403b0cf8756742",
              "MADMgmtInstancePrivateIP": "10.0.0.50",
              "OnpremPkiInstanceID": "i-0ed11da7ebe0eab5d",
              "OnpremPkiInstancePrivateIP": "10.0.0.36"
            },
            "parameters": {
              "AMI": "ami-094a92978724fc94c",
              "CreateChildDomain": "true",
              "DeployMadPki": "false",
              "DeployOnpremPki": "true",
              "InstanceProfile": "EC2-Instance-IAM-Role-dnb6z912",
              "MadAdminSecret": "arn:aws:secretsmanager:us-east-2:156285977455:secret:corp.example.com-MAD-Secret-dnb6z912-HIrOgH",
              "MadDirectoryId": "d-9a6719c031",
              "MadDomainName": "corp.example.com",
              "MadNetBiosName": "CORP",
              "OnPremAdministratorSecret": "arn:aws:secretsmanager:us-east-2:156285977455:secret:onpremises.local-Onprem-Secret-dnb6z912-6YfVOP",
              "OnpremChildNetBiosName": "CHILD",
              "OnpremDomainName": "onpremises.local",
              "OnpremNetBiosName": "ONPREMISES",
              "ParentInstanceIP": "10.0.0.51",
              "SecurityGroupIds": "sg-08fcf1d2c74d387f2",
              "SsmAutoDocument": "SSM-Baseline-dnb6z912",
              "SubnetId": "subnet-028bf321af9ed43b0",
              "TrustDirection": "Two-Way",
              "VPCCIDR": "10.0.0.0/24"
            },
            "policy_body": null,
            "policy_url": null,
            "tags": null,
            "tags_all": {},
            "template_body": "AWSTemplateFormatVersion: '2010-09-09'\r\nParameters:\r\n  AMI:\r\n    #Default: /aws/service/ami-windows-latest/Windows_Server-2022-English-Full-Base\r\n    Description: System Manager parameter value for latest Windows Server AMI\r\n    Type: String\r\n  CreateChildDomain:\r\n    AllowedValues:\r\n      - 'true'\r\n      - 'false'\r\n    Description: Deploy a child domain as part of the On-Premises domain\r\n    Type: String\r\n  DeployMadPki:\r\n    AllowedValues:\r\n      - 'true'\r\n      - 'false'\r\n    Description: Deploy Enterpise Ca with AWS Managed Microsoft AD\r\n    Type: String\r\n  DeployOnpremPki:\r\n    AllowedValues:\r\n      - 'true'\r\n      - 'false'\r\n    Description: Deploy Enterpise Ca with On-Premises AD\r\n    Type: String\r\n  InstanceProfile:\r\n    Description: Instance profile and role to allow instances to use SSM Automation\r\n    Type: String  \r\n  MadAdminSecret:\r\n    Description: Secret containing the random password of the AWS Managed Microsoft AD Admin account\r\n    Type: String  \r\n  MadDirectoryId:\r\n    Description: Directory ID of the AWS Managed Microsoft AD\r\n    Type: String  \r\n  MadDomainName:\r\n    AllowedPattern: ^([a-zA-Z0-9]+(-[a-zA-Z0-9]+)*\\.)+[a-zA-Z]{2,}$\r\n    Description: Fully qualified domain name (FQDN) of the AWS Managed Microsoft AD domain e.g. corp.example.com\r\n    MaxLength: '255'\r\n    MinLength: '2'\r\n    Type: String\r\n  MadNetBiosName:\r\n    AllowedPattern: ^[^\\\\/:*?\"\u003c\u003e|.]+[^\\\\/:*?\"\u003c\u003e|]*$\r\n    Description: NetBIOS name of the AWS Managed Microsoft AD domain (up to 15 characters) e.g. CORP\r\n    MaxLength: '15'\r\n    MinLength: '1'\r\n    Type: String\r\n  OnPremAdministratorSecret:\r\n    Description: Secret containing the random password of the onpremises Microsoft AD Administrator account\r\n    Type: String  \r\n  OnpremChildNetBiosName:\r\n    AllowedPattern: ^[^\\\\/:*?\"\u003c\u003e|.]+[^\\\\/:*?\"\u003c\u003e|]*$\r\n    Description: NetBIOS name of the On-Premises child domain (up to 15 characters) e.g. CHILD\r\n    MaxLength: '15'\r\n    MinLength: '1'\r\n    Type: String\r\n  OnpremDomainName:\r\n    AllowedPattern: ^([a-zA-Z0-9]+(-[a-zA-Z0-9]+)*\\.)+[a-zA-Z]{2,}$\r\n    Description: Fully qualified domain name (FQDN) of the On-Premises domain e.g. onpremises.local\r\n    MaxLength: '255'\r\n    MinLength: '2'\r\n    Type: String\r\n  OnpremNetBiosName:\r\n    AllowedPattern: ^[^\\\\/:*?\"\u003c\u003e|.]+[^\\\\/:*?\"\u003c\u003e|]*$\r\n    Description: NetBIOS name of the On-Premises domain (up to 15 characters) e.g. ONPREMISES\r\n    MaxLength: '15'\r\n    MinLength: '1'\r\n    Type: String\r\n  ParentInstanceIP:\r\n    Description: IP Address of the forest root domain controller\r\n    Type: String\r\n  SecurityGroupIds:\r\n    Description: Security Group Id\r\n    Type: AWS::EC2::SecurityGroup::Id\r\n  SubnetId:\r\n    Description: Subnet Id\r\n    Type: AWS::EC2::Subnet::Id\r\n  SsmAutoDocument:\r\n    Description: SSM Automation Document used to configure the instances\r\n    Type: String\r\n  TrustDirection:\r\n    AllowedValues:\r\n      - Two-Way\r\n      - 'One-Way: Incoming'\r\n      - 'One-Way: Outgoing'\r\n    Description: Trust Direction from AWS Managed Microsoft AD to on-premises domain\r\n    Type: String\r\n  VPCCIDR:\r\n    Description: VPC CIDR where instance will be deployed to\r\n    Type: String\r\nConditions:\r\n  NoDeployMadPki: !Equals [!Ref DeployMadPki, 'false']\r\n  YesDeployMadPki: !Equals [!Ref DeployMadPki, 'true']\r\n  YesDeployOnpremPki: !Equals [!Ref DeployOnpremPki, 'true']\r\n  YesCreateChildDomain: !Equals [!Ref CreateChildDomain, 'true']\r\nResources:\r\n  ChildOnPremDomainController:\r\n    Type: AWS::EC2::Instance\r\n    Condition: YesCreateChildDomain\r\n    CreationPolicy:\r\n      ResourceSignal:\r\n        Count: 1\r\n        Timeout: PT60M\r\n    Properties:\r\n      BlockDeviceMappings:\r\n        - DeviceName: /dev/sda1\r\n          Ebs:\r\n            DeleteOnTermination: true\r\n            Encrypted: true\r\n            KmsKeyId: alias/aws/ebs\r\n            VolumeSize: 60\r\n            VolumeType: gp3\r\n        - DeviceName: /dev/xvdf\r\n          Ebs:\r\n            DeleteOnTermination: true\r\n            Encrypted: true\r\n            KmsKeyId: alias/aws/ebs\r\n            VolumeSize: 10\r\n            VolumeType: gp3\r\n      IamInstanceProfile: !Ref InstanceProfile\r\n      ImageId: !Ref AMI\r\n      InstanceType: m6i.large\r\n      KeyName: Baseline\r\n      SecurityGroupIds:\r\n        - Ref: SecurityGroupIds\r\n      SubnetId: !Ref SubnetId\r\n      Tags:\r\n        - Key: Domain\r\n          Value: !Join [ '.', [ !Ref OnpremChildNetBiosName, !Ref OnpremDomainName ] ]\r\n        - Key: Name\r\n          Value: CHILD-DC01\r\n        - Key: Role\r\n          Value: Domain Controller\r\n      UserData:\r\n        Fn::Base64: !Sub\r\n          - |\r\n              \u003cpowershell\u003e\r\n              $Params = @{\r\n                  DeployPki = 'No'\r\n                  DeploymentType = 'ChildDomainController'\r\n                  DomainDNSName = '${DomainDNSName}'\r\n                  DomainNetBIOSName = '${DomainNetBIOSName}'\r\n                  LogicalResourceId = 'ChildOnPremDomainController'\r\n                  ParentDomainDNSName = '${ParentDomainDNSName}'\r\n                  ParentInstanceIP = '${ParentInstanceIP}'\r\n                  AdministratorSecretName = '${AdministratorSecretName}'\r\n                  ServerNetBIOSName = 'CHILD-DC01'\r\n                  ServerRole = 'DomainController'\r\n                  StackName = 'instances-non-rootdc-dnb6z912'\r\n                  VPCCIDR = '${VPCCIDR}'\r\n              }\r\n              Start-SSMAutomationExecution -DocumentName '${SsmAutoDocument}' -Parameter $Params\r\n              \u003c/powershell\u003e\r\n          - DomainDNSName: !Join [ '.', [ !Ref OnpremChildNetBiosName, !Ref OnpremDomainName ] ]\r\n            DomainNetBIOSName: !Ref OnpremChildNetBiosName\r\n            ParentDomainDNSName: !Ref OnpremDomainName\r\n            ParentInstanceIP: !Ref ParentInstanceIP\r\n            AdministratorSecretName: !Ref OnPremAdministratorSecret\r\n            VPCCIDR: !Ref VPCCIDR\r\n  OnpremPkiInstance:\r\n    Type: AWS::EC2::Instance\r\n    Condition: YesDeployOnpremPki\r\n    CreationPolicy:\r\n      ResourceSignal:\r\n        Timeout: PT60M\r\n        Count: 1\r\n    Properties:\r\n        BlockDeviceMappings:\r\n          - DeviceName: /dev/sda1\r\n            Ebs:\r\n              VolumeSize: 60\r\n              VolumeType: gp3\r\n              Encrypted: true\r\n              KmsKeyId: alias/aws/ebs\r\n              DeleteOnTermination: true\r\n          - DeviceName: /dev/xvdf\r\n            Ebs:\r\n              VolumeSize: 10\r\n              VolumeType: gp3\r\n              Encrypted: true\r\n              KmsKeyId: alias/aws/ebs\r\n              DeleteOnTermination: true\r\n        IamInstanceProfile: !Ref InstanceProfile\r\n        ImageId: !Ref AMI\r\n        InstanceType: m6i.large\r\n        KeyName: Baseline\r\n        SecurityGroupIds:\r\n          - !Ref SecurityGroupIds\r\n        SubnetId: !Ref SubnetId\r\n        Tags:\r\n          - Key: Name\r\n            Value: ONPREM-PKI01\r\n          - Key: Domain\r\n            Value: !Ref MadDomainName\r\n          - Key: Role\r\n            Value: Enterpise CA\r\n        UserData:\r\n          Fn::Base64: !Sub\r\n            - |\r\n                \u003cpowershell\u003e\r\n                $Params = @{\r\n                    DeployPki = 'Yes'\r\n                    DeploymentType = 'EnterpriseCA'\r\n                    DomainDNSName = '${DomainDNSName}'\r\n                    DomainNetBIOSName = '${DomainNetBIOSName}'\r\n                    DomainType = 'SelfManagedAD'\r\n                    LogicalResourceId = 'OnpremPkiInstance'\r\n                    AdministratorSecretName = '${AdministratorSecretName}'\r\n                    ServerNetBIOSName = 'ONPREM-PKI01'\r\n                    ServerRole = 'CertificateAuthority'\r\n                    StackName = 'instances-non-rootdc-dnb6z912'\r\n                    VPCCIDR = '${VPCCIDR}'\r\n                }\r\n                Start-SSMAutomationExecution -DocumentName '${SsmAutoDocument}' -Parameter $Params\r\n                \u003c/powershell\u003e\r\n            - DomainDNSName: !Ref OnpremDomainName\r\n              DomainNetBIOSName: !Ref OnpremNetBiosName\r\n              AdministratorSecretName: !Ref OnPremAdministratorSecret\r\n              VPCCIDR: !Ref VPCCIDR\r\n  MADMgmtInstance:\r\n    Type: AWS::EC2::Instance\r\n    Condition: NoDeployMadPki\r\n    CreationPolicy:\r\n      ResourceSignal:\r\n        Timeout: PT60M\r\n        Count: 1\r\n    Properties:\r\n      BlockDeviceMappings:\r\n          - DeviceName: /dev/sda1\r\n            Ebs:\r\n              VolumeSize: 60\r\n              VolumeType: gp3\r\n              Encrypted: true\r\n              KmsKeyId: alias/aws/ebs\r\n              DeleteOnTermination: true\r\n          - DeviceName: /dev/xvdf\r\n            Ebs:\r\n              VolumeSize: 10\r\n              VolumeType: gp3\r\n              Encrypted: true\r\n              KmsKeyId: alias/aws/ebs\r\n              DeleteOnTermination: true\r\n      IamInstanceProfile: !Ref InstanceProfile\r\n      ImageId: !Ref AMI\r\n      InstanceType: m6i.large\r\n      KeyName: Baseline\r\n      SecurityGroupIds:\r\n        - !Ref SecurityGroupIds\r\n      SubnetId: !Ref SubnetId\r\n      Tags:\r\n        - Key: Name\r\n          Value: MAD-MGMT01\r\n        - Key: Domain\r\n          Value: !Ref MadDomainName\r\n        - Key: Role\r\n          Value: Enterpise CA\r\n      UserData:\r\n        Fn::Base64: !Sub\r\n          - |\r\n              \u003cpowershell\u003e\r\n              $Params = @{\r\n                  DeployPki = 'No'\r\n                  DeploymentType = 'ManagementInstance'\r\n                  DomainDNSName = '${DomainDNSName}'\r\n                  DomainNetBIOSName = '${DomainNetBIOSName}'\r\n                  DomainType = 'AWSManagedAD'\r\n                  LogicalResourceId = 'MADMgmtInstance'\r\n                  MadDirectoryID = '${MadDirectoryID}'\r\n                  OnpremDomainDNSName = '${OnpremDomainDNSName}'\r\n                  AdministratorSecretName = '${AdministratorSecretName}'\r\n                  ServerNetBIOSName = 'MAD-MGMT01'\r\n                  ServerRole = 'Default'\r\n                  StackName = 'instances-non-rootdc-dnb6z912'\r\n                  TrustDirection = '${TrustDirection}'\r\n                  VPCCIDR = '${VPCCIDR}'\r\n              }\r\n              Start-SSMAutomationExecution -DocumentName '${SsmAutoDocument}' -Parameter $Params\r\n              \u003c/powershell\u003e\r\n          - AdministratorSecretName: !Ref MadAdminSecret \r\n            DomainDNSName: !Ref MadDomainName\r\n            DomainNetBIOSName: !Ref MadNetBiosName\r\n            MadDirectoryID: !Ref MadDirectoryId\r\n            OnpremDomainDNSName: !Ref OnpremDomainName\r\n            TrustDirection: !Ref TrustDirection\r\n            VPCCIDR: !Ref VPCCIDR                  \r\n  MADMgmtInstancewPki:\r\n    Type: AWS::EC2::Instance\r\n    Condition: YesDeployMadPki\r\n    CreationPolicy:\r\n      ResourceSignal:\r\n        Timeout: PT60M\r\n        Count: 1\r\n    Properties:\r\n      BlockDeviceMappings:\r\n        - DeviceName: /dev/sda1\r\n          Ebs:\r\n            VolumeSize: 60\r\n            VolumeType: gp3\r\n            Encrypted: true\r\n            KmsKeyId: alias/aws/ebs\r\n            DeleteOnTermination: true\r\n        - DeviceName: /dev/xvdf\r\n          Ebs:\r\n            VolumeSize: 10\r\n            VolumeType: gp3\r\n            Encrypted: true\r\n            KmsKeyId: alias/aws/ebs\r\n            DeleteOnTermination: true\r\n      IamInstanceProfile: !Ref InstanceProfile\r\n      ImageId: !Ref AMI\r\n      InstanceType: m6i.large\r\n      KeyName: Baseline\r\n      SecurityGroupIds:\r\n        - !Ref SecurityGroupIds\r\n      SubnetId: !Ref SubnetId\r\n      Tags:\r\n        - Key: Name\r\n          Value: MAD-MGMT01\r\n        - Key: Domain\r\n          Value: !Ref MadDomainName\r\n        - Key: Role\r\n          Value: Enterpise CA\r\n      UserData:\r\n        Fn::Base64: !Sub\r\n          - |\r\n              \u003cpowershell\u003e\r\n              $Params = @{\r\n                  DeployPki = 'Yes'\r\n                  DeploymentType = 'EnterpriseCAManagementInstance'\r\n                  DomainDNSName = '${DomainDNSName}'\r\n                  DomainNetBIOSName = '${DomainNetBIOSName}'\r\n                  DomainType = 'AWSManagedAD'\r\n                  LogicalResourceId = 'MADMgmtInstancewPki'\r\n                  MadDirectoryID = '${MadDirectoryID}'\r\n                  OnpremDomainDNSName = '${OnpremDomainDNSName}'\r\n                  AdministratorSecretName = '${AdministratorSecretName}'\r\n                  ServerNetBIOSName = 'MAD-MGMT01'\r\n                  ServerRole = 'CertificateAuthority'\r\n                  StackName = 'instances-non-rootdc-dnb6z912'\r\n                  TrustDirection = '${TrustDirection}'\r\n                  VPCCIDR = '${VPCCIDR}'\r\n              }\r\n              Start-SSMAutomationExecution -DocumentName '${SsmAutoDocument}' -Parameter $Params\r\n              \u003c/powershell\u003e\r\n          - AdministratorSecretName: !Ref MadAdminSecret \r\n            DomainDNSName: !Ref MadDomainName\r\n            DomainNetBIOSName: !Ref MadNetBiosName\r\n            MadDirectoryID: !Ref MadDirectoryId\r\n            OnpremDomainDNSName: !Ref OnpremDomainName\r\n            TrustDirection: !Ref TrustDirection\r\n            VPCCIDR: !Ref VPCCIDR\r\nOutputs:\r\n  ChildOnpremDomainControllerInstanceID:\r\n    Condition: YesCreateChildDomain\r\n    Description: Child Onprem Domain Controller Instance ID\r\n    Value: !Ref ChildOnPremDomainController\r\n  ChildOnpremDomainControllerInstancePrivateIP:\r\n    Condition: YesCreateChildDomain\r\n    Description: Child Onprem Domain Controller Instance Private IP\r\n    Value: !GetAtt ChildOnPremDomainController.PrivateIp\r\n  MADMgmtInstanceID:\r\n    Condition: NoDeployMadPki\r\n    Description: MAD Mgmt Instance ID\r\n    Value: !Ref MADMgmtInstance\r\n  MADMgmtInstancePrivateIP:\r\n    Condition: NoDeployMadPki\r\n    Description: MAD Mgmt Instance Private IP\r\n    Value: !GetAtt MADMgmtInstance.PrivateIp\r\n  MADMgmtInstancewPkiID:\r\n    Condition: YesDeployMadPki\r\n    Description: MAD Mgmt Instance ID\r\n    Value: !Ref MADMgmtInstancewPki\r\n  MADMgmtInstancewPkiPrivateIP:\r\n    Condition: YesDeployMadPki\r\n    Description: MAD Mgmt Instance Private IP\r\n    Value: !GetAtt MADMgmtInstancewPki.PrivateIp\r\n  OnpremPkiInstanceID:\r\n    Condition: YesDeployOnpremPki\r\n    Description: Onprem PKI Instance ID\r\n    Value: !Ref OnpremPkiInstance\r\n  OnpremPkiInstancePrivateIP:\r\n    Condition: YesDeployOnpremPki\r\n    Description: Onprem PKI Instance Private IP\r\n    Value: !GetAtt OnpremPkiInstance.PrivateIp\r\n",
            "template_url": null,
            "timeout_in_minutes": 0,
            "timeouts": {
              "create": "120m",
              "delete": null,
              "update": null
            }
          },
          "sensitive_attributes": [],
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjo3MjAwMDAwMDAwMDAwLCJkZWxldGUiOjE4MDAwMDAwMDAwMDAsInVwZGF0ZSI6MTgwMDAwMDAwMDAwMH19",
          "dependencies": [
            "aws_cloudformation_stack.instances_rootdc",
            "aws_directory_service_directory.mad",
            "aws_iam_instance_profile.ec2",
            "aws_iam_role.ec2",
            "aws_route53_resolver_endpoint.r53_outbound_resolver",
            "aws_route53_resolver_rule.r53_outbound_resolver_rule_mad",
            "aws_route53_resolver_rule_association.r53_outbound_resolver_rule_mad_association",
            "aws_secretsmanager_secret.secret_mad",
            "aws_secretsmanager_secret.secret_onprem",
            "aws_security_group.onprem_ad_sg",
            "aws_security_group.r53_outbound_resolver_sg",
            "aws_ssm_document.ssm_auditpol",
            "aws_ssm_document.ssm_baseline",
            "aws_ssm_document.ssm_pki",
            "aws_subnet.network_subnet1",
            "aws_subnet.network_subnet2",
            "aws_vpc.network",
            "data.aws_ami.windows_2022",
            "data.aws_availability_zones.available",
            "data.aws_caller_identity.main",
            "data.aws_iam_policy_document.ec2",
            "data.aws_iam_policy_document.ec2_instance_assume_role_policy",
            "data.aws_partition.main",
            "random_password.secret_mad",
            "random_string.random_string"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_cloudformation_stack",
      "name": "instances_rootdc",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "capabilities": null,
            "disable_rollback": false,
            "iam_role_arn": "",
            "id": "arn:aws:cloudformation:us-east-2:156285977455:stack/instances-rootdc-dnb6z912/11198670-018f-11ed-a086-023d970a9024",
            "name": "instances-rootdc-dnb6z912",
            "notification_arns": null,
            "on_failure": null,
            "outputs": {
              "OnpremDomainControllerInstanceID": "i-05987e972b1dc2b49",
              "OnpremDomainControllerInstancePrivateIP": "10.0.0.51"
            },
            "parameters": {
              "AMI": "ami-094a92978724fc94c",
              "FsxOnpremParentOu": "DC=onpremises,DC=local",
              "InstanceProfile": "EC2-Instance-IAM-Role-dnb6z912",
              "IntegrateFsxOnprem": "false",
              "MadAdminSecret": "arn:aws:secretsmanager:us-east-2:156285977455:secret:corp.example.com-MAD-Secret-dnb6z912-HIrOgH",
              "MadDomainName": "corp.example.com",
              "OnPremAdministratorSecret": "arn:aws:secretsmanager:us-east-2:156285977455:secret:onpremises.local-Onprem-Secret-dnb6z912-6YfVOP",
              "OnpremDomainName": "onpremises.local",
              "OnpremNetBiosName": "ONPREMISES",
              "SecurityGroupIds": "sg-08fcf1d2c74d387f2",
              "SsmAutoDocument": "SSM-Baseline-dnb6z912",
              "SubnetId": "subnet-028bf321af9ed43b0",
              "TrustDirection": "Two-Way",
              "VPCCIDR": "10.0.0.0/24"
            },
            "policy_body": null,
            "policy_url": null,
            "tags": null,
            "tags_all": {},
            "template_body": "AWSTemplateFormatVersion: '2010-09-09'\r\nParameters:\r\n  AMI:\r\n    #Default: /aws/service/ami-windows-latest/Windows_Server-2022-English-Full-Base\r\n    Description: System Manager parameter value for latest Windows Server AMI\r\n    Type: String\r\n  IntegrateFsxOnprem:\r\n    AllowedValues:\r\n      - 'true'\r\n      - 'false'\r\n    Description: Deploy \u0026 Integrate Amazon FSX for Windows with On-Premises AD\r\n    Type: String\r\n  FsxOnpremParentOu:\r\n    Default: DC=onpremises,DC=local\r\n    Description: Parent DN for Amazon FSX for Windows OU (Only used when deployment with On-Premises AD)\r\n    Type: String\r\n  InstanceProfile:\r\n    Description: Instance profile and role to allow instances to use SSM Automation\r\n    Type: String  \r\n  MadAdminSecret:\r\n    Description: Secret containing the random password of the AWS Managed Microsoft AD Admin account\r\n    Type: String  \r\n  MadDomainName:\r\n    AllowedPattern: ^([a-zA-Z0-9]+(-[a-zA-Z0-9]+)*\\.)+[a-zA-Z]{2,}$\r\n    Description: Fully qualified domain name (FQDN) of the AWS Managed Microsoft AD domain e.g. corp.example.com\r\n    MaxLength: '255'\r\n    MinLength: '2'\r\n    Type: String\r\n  OnPremAdministratorSecret:\r\n    Description: Secret containing the random password of the onpremises Microsoft AD Administrator account\r\n    Type: String  \r\n  OnpremDomainName:\r\n    AllowedPattern: ^([a-zA-Z0-9]+(-[a-zA-Z0-9]+)*\\.)+[a-zA-Z]{2,}$\r\n    Description: Fully qualified domain name (FQDN) of the On-Premises domain e.g. onpremises.local\r\n    MaxLength: '255'\r\n    MinLength: '2'\r\n    Type: String\r\n  OnpremNetBiosName:\r\n    AllowedPattern: ^[^\\\\/:*?\"\u003c\u003e|.]+[^\\\\/:*?\"\u003c\u003e|]*$\r\n    Description: NetBIOS name of the On-Premises domain (up to 15 characters) e.g. ONPREMISES\r\n    MaxLength: '15'\r\n    MinLength: '1'\r\n    Type: String\r\n  SecurityGroupIds:\r\n    Description: Security Group Id\r\n    Type: AWS::EC2::SecurityGroup::Id\r\n  SubnetId:\r\n    Description: Subnet Id\r\n    Type: AWS::EC2::Subnet::Id\r\n  SsmAutoDocument:\r\n    Description: SSM Automation Document used to configure the instances\r\n    Type: String\r\n  TrustDirection:\r\n    AllowedValues:\r\n      - Two-Way\r\n      - 'One-Way: Incoming'\r\n      - 'One-Way: Outgoing'\r\n    Description: Trust Direction from AWS Managed Microsoft AD to on-premises domain\r\n    Type: String\r\n  VPCCIDR:\r\n    Description: VPC CIDR where instance will be deployed to\r\n    Type: String\r\nResources:\r\n  OnPremDomainController:\r\n    Type: AWS::EC2::Instance\r\n    CreationPolicy:\r\n      ResourceSignal:\r\n        Count: 1\r\n        Timeout: PT60M\r\n    Properties:\r\n      BlockDeviceMappings:\r\n        - DeviceName: /dev/sda1\r\n          Ebs:\r\n            DeleteOnTermination: true\r\n            Encrypted: true\r\n            KmsKeyId: alias/aws/ebs\r\n            VolumeSize: 60\r\n            VolumeType: gp3\r\n        - DeviceName: /dev/xvdf\r\n          Ebs:\r\n            DeleteOnTermination: true\r\n            Encrypted: true\r\n            KmsKeyId: alias/aws/ebs\r\n            VolumeSize: 10\r\n            VolumeType: gp3\r\n      IamInstanceProfile: !Ref InstanceProfile\r\n      ImageId: !Ref AMI\r\n      InstanceType: m6i.large\r\n      KeyName: Baseline\r\n      SecurityGroupIds:\r\n        - Ref: SecurityGroupIds\r\n      SubnetId: !Ref SubnetId\r\n      Tags:\r\n          - Key: Domain\r\n            Value: !Ref OnpremDomainName\r\n          - Key: Name\r\n            Value: ONPREM-DC01\r\n          - Key: Role\r\n            Value: Domain Controller\r\n      UserData:\r\n        Fn::Base64: !Sub\r\n          - |\r\n              \u003cpowershell\u003e\r\n              $Params = @{\r\n                  TrustSecretName = '${TrustSecretName}'\r\n                  DeployPki = 'No'\r\n                  DeploymentType = 'RootDomainController'\r\n                  DomainDNSName = '${DomainDNSName}'\r\n                  DomainNetBIOSName = '${OnpremNetBiosName}'\r\n                  FsxOnpremParentOu = '${FsxOnpremParentOu}'\r\n                  IntegrateFsxOnprem = '${IntegrateFsxOnprem}'\r\n                  LogicalResourceId = 'OnPremDomainController'\r\n                  MadDNSName = '${MadDNSName}'\r\n                  AdministratorSecretName = '${AdministratorSecretName}'\r\n                  ServerNetBIOSName = 'ONPREM-DC01'\r\n                  ServerRole = 'DomainController'\r\n                  StackName = 'instances-rootdc-dnb6z912'\r\n                  TrustDirection = '${TrustDirection}'\r\n                  VPCCIDR = '${VPCCIDR}'\r\n              }\r\n              Start-SSMAutomationExecution -DocumentName '${SsmAutoDocument}' -Parameter $Params\r\n              \u003c/powershell\u003e\r\n          - TrustSecretName: !Ref MadAdminSecret\r\n            DomainDNSName: !Ref OnpremDomainName\r\n            FsxOnpremParentOu: !Ref FsxOnpremParentOu\r\n            IntegrateFsxOnprem: !Ref IntegrateFsxOnprem\r\n            MadDNSName: !Ref MadDomainName\r\n            AdministratorSecretName: !Ref OnPremAdministratorSecret\r\n            TrustDirection: !Ref TrustDirection\r\n            VPCCIDR: !Ref VPCCIDR\r\nOutputs:\r\n  OnpremDomainControllerInstanceID:\r\n    Description: Onprem Domain Controller Instance ID\r\n    Value: !Ref OnPremDomainController\r\n  OnpremDomainControllerInstancePrivateIP:\r\n    Description: Onprem Domain Controller Instance Private IP\r\n    Value: !GetAtt OnPremDomainController.PrivateIp\r\n",
            "template_url": null,
            "timeout_in_minutes": 0,
            "timeouts": {
              "create": "120m",
              "delete": null,
              "update": null
            }
          },
          "sensitive_attributes": [],
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjo3MjAwMDAwMDAwMDAwLCJkZWxldGUiOjE4MDAwMDAwMDAwMDAsInVwZGF0ZSI6MTgwMDAwMDAwMDAwMH19",
          "dependencies": [
            "aws_directory_service_directory.mad",
            "aws_iam_instance_profile.ec2",
            "aws_iam_role.ec2",
            "aws_route53_resolver_endpoint.r53_outbound_resolver",
            "aws_route53_resolver_rule.r53_outbound_resolver_rule_mad",
            "aws_route53_resolver_rule_association.r53_outbound_resolver_rule_mad_association",
            "aws_secretsmanager_secret.secret_mad",
            "aws_secretsmanager_secret.secret_onprem",
            "aws_security_group.onprem_ad_sg",
            "aws_security_group.r53_outbound_resolver_sg",
            "aws_ssm_document.ssm_auditpol",
            "aws_ssm_document.ssm_baseline",
            "aws_ssm_document.ssm_pki",
            "aws_subnet.network_subnet1",
            "aws_subnet.network_subnet2",
            "aws_vpc.network",
            "data.aws_ami.windows_2022",
            "data.aws_availability_zones.available",
            "data.aws_caller_identity.main",
            "data.aws_iam_policy_document.ec2",
            "data.aws_iam_policy_document.ec2_instance_assume_role_policy",
            "data.aws_partition.main",
            "random_password.secret_mad",
            "random_string.random_string"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_db_subnet_group",
      "name": "rds",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "index_key": 0,
          "schema_version": 0,
          "attributes": {
            "arn": "arn:aws:rds:us-east-2:156285977455:subgrp:rds-subnet-group-dnb6z912",
            "description": "Managed by Terraform",
            "id": "rds-subnet-group-dnb6z912",
            "name": "rds-subnet-group-dnb6z912",
            "name_prefix": null,
            "subnet_ids": [
              "subnet-028bf321af9ed43b0",
              "subnet-096dcdd45474860ae"
            ],
            "tags": {
              "Name": "RDS-Subnet-Group"
            },
            "tags_all": {
              "Name": "RDS-Subnet-Group"
            }
          },
          "sensitive_attributes": [],
          "private": "bnVsbA==",
          "dependencies": [
            "aws_subnet.network_subnet1",
            "aws_subnet.network_subnet2",
            "aws_vpc.network",
            "data.aws_availability_zones.available",
            "random_string.random_string"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_default_route_table",
      "name": "network",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "arn": "arn:aws:ec2:us-east-2:156285977455:route-table/rtb-0d3753644c7723c1f",
            "default_route_table_id": "rtb-0d3753644c7723c1f",
            "id": "rtb-0d3753644c7723c1f",
            "owner_id": "156285977455",
            "propagating_vgws": null,
            "route": [
              {
                "cidr_block": "0.0.0.0/0",
                "core_network_arn": "",
                "destination_prefix_list_id": "",
                "egress_only_gateway_id": "",
                "gateway_id": "igw-01965ecdc037d56ce",
                "instance_id": "",
                "ipv6_cidr_block": "",
                "nat_gateway_id": "",
                "network_interface_id": "",
                "transit_gateway_id": "",
                "vpc_endpoint_id": "",
                "vpc_peering_connection_id": ""
              }
            ],
            "tags": {
              "Name": "Demo-VPC-Default-RT-dnb6z912"
            },
            "tags_all": {
              "Name": "Demo-VPC-Default-RT-dnb6z912"
            },
            "timeouts": null,
            "vpc_id": "vpc-04a2f5c1bfcfaf737"
          },
          "sensitive_attributes": [],
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjoxMjAwMDAwMDAwMDAsInVwZGF0ZSI6MTIwMDAwMDAwMDAwfX0=",
          "dependencies": [
            "aws_internet_gateway.network",
            "aws_vpc.network",
            "random_string.random_string"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_directory_service_directory",
      "name": "mad",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "access_url": "d-9a6719c031.awsapps.com",
            "alias": "d-9a6719c031",
            "connect_settings": [],
            "description": "",
            "dns_ip_addresses": [
              "10.0.0.62",
              "10.0.0.79"
            ],
            "edition": "Enterprise",
            "enable_sso": false,
            "id": "d-9a6719c031",
            "name": "corp.example.com",
            "password": "1g3?D!l3?1Nv3Ve-i1L=qmkH4#Q3bSTE",
            "security_group_id": "sg-0ff92f05c471afb1e",
            "short_name": "CORP",
            "size": "Large",
            "tags": {
              "Name": "corp.example.com-MAD-dnb6z912"
            },
            "tags_all": {
              "Name": "corp.example.com-MAD-dnb6z912"
            },
            "type": "MicrosoftAD",
            "vpc_settings": [
              {
                "availability_zones": [
                  "us-east-2a",
                  "us-east-2b"
                ],
                "subnet_ids": [
                  "subnet-028bf321af9ed43b0",
                  "subnet-096dcdd45474860ae"
                ],
                "vpc_id": "vpc-04a2f5c1bfcfaf737"
              }
            ]
          },
          "sensitive_attributes": [
            [
              {
                "type": "get_attr",
                "value": "password"
              }
            ]
          ],
          "private": "bnVsbA==",
          "dependencies": [
            "aws_subnet.network_subnet1",
            "aws_subnet.network_subnet2",
            "aws_vpc.network",
            "data.aws_availability_zones.available",
            "random_password.secret_mad",
            "random_string.random_string"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_fsx_windows_file_system",
      "name": "mad_fsx",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "index_key": 0,
          "schema_version": 0,
          "attributes": {
            "active_directory_id": "d-9a6719c031",
            "aliases": [
              "MAD-FSx.corp.example.com"
            ],
            "arn": "arn:aws:fsx:us-east-2:156285977455:file-system/fs-0793a8506e8e7ecca",
            "audit_log_configuration": [
              {
                "audit_log_destination": "",
                "file_access_audit_log_level": "DISABLED",
                "file_share_access_audit_log_level": "DISABLED"
              }
            ],
            "automatic_backup_retention_days": 0,
            "backup_id": null,
            "copy_tags_to_backups": false,
            "daily_automatic_backup_start_time": "10:00",
            "deployment_type": "SINGLE_AZ_2",
            "dns_name": "amznfsxmlpykr6m.corp.example.com",
            "id": "fs-0793a8506e8e7ecca",
            "kms_key_id": "arn:aws:kms:us-east-2:156285977455:key/7aef1b44-3c48-4047-a0ac-335a7b338195",
            "network_interface_ids": [
              "eni-0c80a8ff04abf8484"
            ],
            "owner_id": "156285977455",
            "preferred_file_server_ip": "10.0.0.54",
            "preferred_subnet_id": "subnet-028bf321af9ed43b0",
            "remote_administration_endpoint": "amznfsxztllqvka.corp.example.com",
            "security_group_ids": [
              "sg-09c4b7adc5923613f"
            ],
            "self_managed_active_directory": [],
            "skip_final_backup": false,
            "storage_capacity": 32,
            "storage_type": "SSD",
            "subnet_ids": [
              "subnet-028bf321af9ed43b0"
            ],
            "tags": {
              "Name": "MAD-FSx-dnb6z912"
            },
            "tags_all": {
              "Name": "MAD-FSx-dnb6z912"
            },
            "throughput_capacity": 16,
            "timeouts": null,
            "vpc_id": "vpc-04a2f5c1bfcfaf737",
            "weekly_maintenance_start_time": "2:05:00"
          },
          "sensitive_attributes": [],
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjoyNzAwMDAwMDAwMDAwLCJkZWxldGUiOjE4MDAwMDAwMDAwMDAsInVwZGF0ZSI6MjcwMDAwMDAwMDAwMH19",
          "dependencies": [
            "aws_directory_service_directory.mad",
            "aws_security_group.fsx",
            "aws_subnet.network_subnet1",
            "aws_subnet.network_subnet2",
            "aws_vpc.network",
            "data.aws_availability_zones.available",
            "random_password.secret_mad",
            "random_string.random_string"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_iam_instance_profile",
      "name": "ec2",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "arn": "arn:aws:iam::156285977455:instance-profile/EC2-Instance-IAM-Role-dnb6z912",
            "create_date": "2022-07-12T02:29:29Z",
            "id": "EC2-Instance-IAM-Role-dnb6z912",
            "name": "EC2-Instance-IAM-Role-dnb6z912",
            "name_prefix": null,
            "path": "/",
            "role": "EC2-Instance-IAM-Role-dnb6z912",
            "tags": null,
            "tags_all": {},
            "unique_id": "AIPASIY26YNX4KIYIJSPW"
          },
          "sensitive_attributes": [],
          "private": "bnVsbA==",
          "dependencies": [
            "aws_iam_role.ec2",
            "aws_secretsmanager_secret.secret_mad",
            "aws_secretsmanager_secret.secret_onprem",
            "aws_ssm_document.ssm_auditpol",
            "aws_ssm_document.ssm_baseline",
            "aws_ssm_document.ssm_pki",
            "data.aws_caller_identity.main",
            "data.aws_iam_policy_document.ec2",
            "data.aws_iam_policy_document.ec2_instance_assume_role_policy",
            "data.aws_partition.main",
            "random_string.random_string"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_iam_role",
      "name": "ec2",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "arn": "arn:aws:iam::156285977455:role/EC2-Instance-IAM-Role-dnb6z912",
            "assume_role_policy": "{\"Version\":\"2012-10-17\",\"Statement\":[{\"Sid\":\"\",\"Effect\":\"Allow\",\"Principal\":{\"Service\":\"ec2.amazonaws.com\"},\"Action\":\"sts:AssumeRole\"}]}",
            "create_date": "2022-07-12T02:29:27Z",
            "description": "",
            "force_detach_policies": false,
            "id": "EC2-Instance-IAM-Role-dnb6z912",
            "inline_policy": [
              {
                "name": "policy-8675309",
                "policy": "{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Sid\": \"\",\n      \"Effect\": \"Allow\",\n      \"Action\": [\n        \"secretsmanager:GetSecretValue\",\n        \"secretsmanager:DescribeSecret\"\n      ],\n      \"Resource\": [\n        \"arn:aws:secretsmanager:us-east-2:156285977455:secret:onpremises.local-Onprem-Secret-dnb6z912-6YfVOP\",\n        \"arn:aws:secretsmanager:us-east-2:156285977455:secret:corp.example.com-MAD-Secret-dnb6z912-HIrOgH\"\n      ]\n    },\n    {\n      \"Sid\": \"\",\n      \"Effect\": \"Allow\",\n      \"Action\": [\n        \"ssm:ListCommands\",\n        \"ssm:ListCommandInvocations\",\n        \"ssm:GetAutomationExecution\",\n        \"ssm:DescribeInstanceInformation\",\n        \"ec2:DescribeSecurityGroups\",\n        \"ec2:DescribeInstances\",\n        \"ds:VerifyTrust\",\n        \"ds:DescribeTrusts\",\n        \"ds:CreateTrust\",\n        \"ds:CreateConditionalForwarder\"\n      ],\n      \"Resource\": \"*\"\n    },\n    {\n      \"Sid\": \"\",\n      \"Effect\": \"Allow\",\n      \"Action\": \"ssm:StartAutomationExecution\",\n      \"Resource\": [\n        \"arn:aws:ssm:us-east-2:156285977455:automation-definition/SSM-Pki-dnb6z912:$DEFAULT\",\n        \"arn:aws:ssm:us-east-2:156285977455:automation-definition/SSM-Baseline-dnb6z912:$DEFAULT\",\n        \"arn:aws:ssm:us-east-2:156285977455:automation-definition/SSM-AuditPol-dnb6z912:$DEFAULT\"\n      ]\n    },\n    {\n      \"Sid\": \"\",\n      \"Effect\": \"Allow\",\n      \"Action\": \"ssm:SendCommand\",\n      \"Resource\": [\n        \"arn:aws:ssm:us-east-2:*:document/AWS-RunRemoteScript\",\n        \"arn:aws:ssm:us-east-2:*:document/AWS-RunPowerShellScript\"\n      ]\n    },\n    {\n      \"Sid\": \"\",\n      \"Effect\": \"Allow\",\n      \"Action\": \"ssm:SendCommand\",\n      \"Resource\": \"arn:aws:ec2:us-east-2:156285977455:instance/*\",\n      \"Condition\": {\n        \"ForAnyValue:StringEquals\": {\n          \"ssm:ResourceTag/aws:cloudformation:stack-name\": [\n            \"instances-rootdc-dnb6z912\",\n            \"instances-non-rootdc-dnb6z912\"\n          ]\n        }\n      }\n    },\n    {\n      \"Sid\": \"\",\n      \"Effect\": \"Allow\",\n      \"Action\": \"cloudformation:SignalResource\",\n      \"Resource\": [\n        \"arn:aws:cloudformation:us-east-2:156285977455:stack/instances-rootdc-dnb6z912/*\",\n        \"arn:aws:cloudformation:us-east-2:156285977455:stack/instances-non-rootdc-dnb6z912/*\"\n      ]\n    }\n  ]\n}"
              }
            ],
            "managed_policy_arns": [
              "arn:aws:iam::aws:policy/AmazonSSMManagedInstanceCore",
              "arn:aws:iam::aws:policy/CloudWatchAgentServerPolicy"
            ],
            "max_session_duration": 3600,
            "name": "EC2-Instance-IAM-Role-dnb6z912",
            "name_prefix": "",
            "path": "/",
            "permissions_boundary": null,
            "tags": {
              "Name": "EC2-Instance-IAM-Role-dnb6z912"
            },
            "tags_all": {
              "Name": "EC2-Instance-IAM-Role-dnb6z912"
            },
            "unique_id": "AROASIY26YNXYFDRLU6JJ"
          },
          "sensitive_attributes": [],
          "private": "bnVsbA==",
          "dependencies": [
            "aws_secretsmanager_secret.secret_mad",
            "aws_secretsmanager_secret.secret_onprem",
            "aws_ssm_document.ssm_auditpol",
            "aws_ssm_document.ssm_baseline",
            "aws_ssm_document.ssm_pki",
            "data.aws_caller_identity.main",
            "data.aws_iam_policy_document.ec2",
            "data.aws_iam_policy_document.ec2_instance_assume_role_policy",
            "data.aws_partition.main",
            "random_string.random_string"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_iam_role",
      "name": "rds",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "index_key": 0,
          "schema_version": 0,
          "attributes": {
            "arn": "arn:aws:iam::156285977455:role/RDS-Domain-IAM-Role-dnb6z912",
            "assume_role_policy": "{\"Version\":\"2012-10-17\",\"Statement\":[{\"Sid\":\"\",\"Effect\":\"Allow\",\"Principal\":{\"Service\":\"rds.amazonaws.com\"},\"Action\":\"sts:AssumeRole\"}]}",
            "create_date": "2022-07-12T02:29:26Z",
            "description": "",
            "force_detach_policies": false,
            "id": "RDS-Domain-IAM-Role-dnb6z912",
            "inline_policy": [
              {
                "name": "",
                "policy": ""
              }
            ],
            "managed_policy_arns": [
              "arn:aws:iam::aws:policy/service-role/AmazonRDSDirectoryServiceAccess"
            ],
            "max_session_duration": 3600,
            "name": "RDS-Domain-IAM-Role-dnb6z912",
            "name_prefix": "",
            "path": "/",
            "permissions_boundary": null,
            "tags": {
              "Name": "RDS-Domain-IAM-Role-dnb6z912"
            },
            "tags_all": {
              "Name": "RDS-Domain-IAM-Role-dnb6z912"
            },
            "unique_id": "AROASIY26YNX7T5ASK64U"
          },
          "sensitive_attributes": [],
          "private": "bnVsbA==",
          "dependencies": [
            "data.aws_iam_policy_document.rds_instance_assume_role_policy",
            "data.aws_partition.main",
            "random_string.random_string"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_internet_gateway",
      "name": "network",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "arn": "arn:aws:ec2:us-east-2:156285977455:internet-gateway/igw-01965ecdc037d56ce",
            "id": "igw-01965ecdc037d56ce",
            "owner_id": "156285977455",
            "tags": {
              "Name": "Demo-VPC-IGW-dnb6z912"
            },
            "tags_all": {
              "Name": "Demo-VPC-IGW-dnb6z912"
            },
            "vpc_id": "vpc-04a2f5c1bfcfaf737"
          },
          "sensitive_attributes": [],
          "private": "bnVsbA==",
          "dependencies": [
            "aws_vpc.network",
            "random_string.random_string"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_route53_resolver_endpoint",
      "name": "r53_outbound_resolver",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "arn": "arn:aws:route53resolver:us-east-2:156285977455:resolver-endpoint/rslvr-out-93c8c66758db445b8",
            "direction": "OUTBOUND",
            "host_vpc_id": "vpc-04a2f5c1bfcfaf737",
            "id": "rslvr-out-93c8c66758db445b8",
            "ip_address": [
              {
                "ip": "10.0.0.112",
                "ip_id": "rni-561503bfa7f242f8a",
                "subnet_id": "subnet-096dcdd45474860ae"
              },
              {
                "ip": "10.0.0.12",
                "ip_id": "rni-b1e591a4ed774206a",
                "subnet_id": "subnet-028bf321af9ed43b0"
              }
            ],
            "name": "Demo-VPC-Outbound-Resolver-dnb6z912",
            "security_group_ids": [
              "sg-00fe03e29d72ccb93"
            ],
            "tags": {
              "Name": "Demo-VPC-Outbound-Resolver-dnb6z912"
            },
            "tags_all": {
              "Name": "Demo-VPC-Outbound-Resolver-dnb6z912"
            },
            "timeouts": null
          },
          "sensitive_attributes": [],
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjo2MDAwMDAwMDAwMDAsImRlbGV0ZSI6NjAwMDAwMDAwMDAwLCJ1cGRhdGUiOjYwMDAwMDAwMDAwMH19",
          "dependencies": [
            "aws_security_group.r53_outbound_resolver_sg",
            "aws_subnet.network_subnet1",
            "aws_subnet.network_subnet2",
            "aws_vpc.network",
            "data.aws_availability_zones.available",
            "random_string.random_string"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_route53_resolver_rule",
      "name": "r53_outbound_resolver_rule_mad",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "arn": "arn:aws:route53resolver:us-east-2:156285977455:resolver-rule/rslvr-rr-774ba195c1bc4dd28",
            "domain_name": "corp.example.com",
            "id": "rslvr-rr-774ba195c1bc4dd28",
            "name": "CORP-dnb6z912",
            "owner_id": "156285977455",
            "resolver_endpoint_id": "rslvr-out-93c8c66758db445b8",
            "rule_type": "FORWARD",
            "share_status": "NOT_SHARED",
            "tags": {
              "Name": "Demo-VPC-Outbound-Resolver-Rule-MAD-dnb6z912"
            },
            "tags_all": {
              "Name": "Demo-VPC-Outbound-Resolver-Rule-MAD-dnb6z912"
            },
            "target_ip": [
              {
                "ip": "10.0.0.62",
                "port": 53
              },
              {
                "ip": "10.0.0.79",
                "port": 53
              }
            ],
            "timeouts": null
          },
          "sensitive_attributes": [],
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjo2MDAwMDAwMDAwMDAsImRlbGV0ZSI6NjAwMDAwMDAwMDAwLCJ1cGRhdGUiOjYwMDAwMDAwMDAwMH19",
          "dependencies": [
            "aws_directory_service_directory.mad",
            "aws_route53_resolver_endpoint.r53_outbound_resolver",
            "aws_security_group.r53_outbound_resolver_sg",
            "aws_subnet.network_subnet1",
            "aws_subnet.network_subnet2",
            "aws_vpc.network",
            "data.aws_availability_zones.available",
            "random_password.secret_mad",
            "random_string.random_string"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_route53_resolver_rule",
      "name": "r53_outbound_resolver_rule_onprem",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "arn": "arn:aws:route53resolver:us-east-2:156285977455:resolver-rule/rslvr-rr-7b0ccc650ff243de9",
            "domain_name": "onpremises.local",
            "id": "rslvr-rr-7b0ccc650ff243de9",
            "name": "ONPREMISES-dnb6z912",
            "owner_id": "156285977455",
            "resolver_endpoint_id": "rslvr-out-93c8c66758db445b8",
            "rule_type": "FORWARD",
            "share_status": "NOT_SHARED",
            "tags": {
              "Name": "Demo-VPC-Outbound-Resolver-Rule-Onprem-dnb6z912"
            },
            "tags_all": {
              "Name": "Demo-VPC-Outbound-Resolver-Rule-Onprem-dnb6z912"
            },
            "target_ip": [
              {
                "ip": "10.0.0.51",
                "port": 53
              }
            ],
            "timeouts": null
          },
          "sensitive_attributes": [],
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjo2MDAwMDAwMDAwMDAsImRlbGV0ZSI6NjAwMDAwMDAwMDAwLCJ1cGRhdGUiOjYwMDAwMDAwMDAwMH19",
          "dependencies": [
            "aws_cloudformation_stack.instances_rootdc",
            "aws_directory_service_directory.mad",
            "aws_iam_instance_profile.ec2",
            "aws_iam_role.ec2",
            "aws_route53_resolver_endpoint.r53_outbound_resolver",
            "aws_route53_resolver_rule.r53_outbound_resolver_rule_mad",
            "aws_route53_resolver_rule_association.r53_outbound_resolver_rule_mad_association",
            "aws_secretsmanager_secret.secret_mad",
            "aws_secretsmanager_secret.secret_onprem",
            "aws_security_group.onprem_ad_sg",
            "aws_security_group.r53_outbound_resolver_sg",
            "aws_ssm_document.ssm_auditpol",
            "aws_ssm_document.ssm_baseline",
            "aws_ssm_document.ssm_pki",
            "aws_subnet.network_subnet1",
            "aws_subnet.network_subnet2",
            "aws_vpc.network",
            "data.aws_ami.windows_2022",
            "data.aws_availability_zones.available",
            "data.aws_caller_identity.main",
            "data.aws_iam_policy_document.ec2",
            "data.aws_iam_policy_document.ec2_instance_assume_role_policy",
            "data.aws_partition.main",
            "random_password.secret_mad",
            "random_string.random_string"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_route53_resolver_rule",
      "name": "r53_outbound_resolver_rule_onprem_child",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "index_key": 0,
          "schema_version": 0,
          "attributes": {
            "arn": "arn:aws:route53resolver:us-east-2:156285977455:resolver-rule/rslvr-rr-7238d1059ade45649",
            "domain_name": "child.onpremises.local",
            "id": "rslvr-rr-7238d1059ade45649",
            "name": "CHILD-dnb6z912",
            "owner_id": "156285977455",
            "resolver_endpoint_id": "rslvr-out-93c8c66758db445b8",
            "rule_type": "FORWARD",
            "share_status": "NOT_SHARED",
            "tags": {
              "Name": "Demo-VPC-Outbound-Resolver-Rule-Onprem-Child-dnb6z912"
            },
            "tags_all": {
              "Name": "Demo-VPC-Outbound-Resolver-Rule-Onprem-Child-dnb6z912"
            },
            "target_ip": [
              {
                "ip": "10.0.0.45",
                "port": 53
              }
            ],
            "timeouts": null
          },
          "sensitive_attributes": [],
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjo2MDAwMDAwMDAwMDAsImRlbGV0ZSI6NjAwMDAwMDAwMDAwLCJ1cGRhdGUiOjYwMDAwMDAwMDAwMH19",
          "dependencies": [
            "aws_cloudformation_stack.instances_non_rootdc",
            "aws_cloudformation_stack.instances_rootdc",
            "aws_directory_service_directory.mad",
            "aws_iam_instance_profile.ec2",
            "aws_iam_role.ec2",
            "aws_route53_resolver_endpoint.r53_outbound_resolver",
            "aws_route53_resolver_rule.r53_outbound_resolver_rule_mad",
            "aws_route53_resolver_rule_association.r53_outbound_resolver_rule_mad_association",
            "aws_secretsmanager_secret.secret_mad",
            "aws_secretsmanager_secret.secret_onprem",
            "aws_security_group.onprem_ad_sg",
            "aws_security_group.r53_outbound_resolver_sg",
            "aws_ssm_document.ssm_auditpol",
            "aws_ssm_document.ssm_baseline",
            "aws_ssm_document.ssm_pki",
            "aws_subnet.network_subnet1",
            "aws_subnet.network_subnet2",
            "aws_vpc.network",
            "data.aws_ami.windows_2022",
            "data.aws_availability_zones.available",
            "data.aws_caller_identity.main",
            "data.aws_iam_policy_document.ec2",
            "data.aws_iam_policy_document.ec2_instance_assume_role_policy",
            "data.aws_partition.main",
            "random_password.secret_mad",
            "random_string.random_string"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_route53_resolver_rule_association",
      "name": "r53_outbound_resolver_rule_mad_association",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "id": "rslvr-rrassoc-4419f03a32574c6e8",
            "name": "Demo-VPC-Outbound-Resolver-Rule-Association-MAD-dnb6z912",
            "resolver_rule_id": "rslvr-rr-774ba195c1bc4dd28",
            "timeouts": null,
            "vpc_id": "vpc-04a2f5c1bfcfaf737"
          },
          "sensitive_attributes": [],
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjo2MDAwMDAwMDAwMDAsImRlbGV0ZSI6NjAwMDAwMDAwMDAwfX0=",
          "dependencies": [
            "aws_directory_service_directory.mad",
            "aws_route53_resolver_endpoint.r53_outbound_resolver",
            "aws_route53_resolver_rule.r53_outbound_resolver_rule_mad",
            "aws_security_group.r53_outbound_resolver_sg",
            "aws_subnet.network_subnet1",
            "aws_subnet.network_subnet2",
            "aws_vpc.network",
            "data.aws_availability_zones.available",
            "random_password.secret_mad",
            "random_string.random_string"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_route53_resolver_rule_association",
      "name": "r53_outbound_resolver_rule_onprem_association",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "id": "rslvr-rrassoc-679dce57139740aaa",
            "name": "Demo-VPC-Outbound-Resolver-Rule-Association-Onprem-dnb6z912",
            "resolver_rule_id": "rslvr-rr-7b0ccc650ff243de9",
            "timeouts": null,
            "vpc_id": "vpc-04a2f5c1bfcfaf737"
          },
          "sensitive_attributes": [],
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjo2MDAwMDAwMDAwMDAsImRlbGV0ZSI6NjAwMDAwMDAwMDAwfX0=",
          "dependencies": [
            "aws_cloudformation_stack.instances_rootdc",
            "aws_directory_service_directory.mad",
            "aws_iam_instance_profile.ec2",
            "aws_iam_role.ec2",
            "aws_route53_resolver_endpoint.r53_outbound_resolver",
            "aws_route53_resolver_rule.r53_outbound_resolver_rule_mad",
            "aws_route53_resolver_rule.r53_outbound_resolver_rule_onprem",
            "aws_route53_resolver_rule_association.r53_outbound_resolver_rule_mad_association",
            "aws_secretsmanager_secret.secret_mad",
            "aws_secretsmanager_secret.secret_onprem",
            "aws_security_group.onprem_ad_sg",
            "aws_security_group.r53_outbound_resolver_sg",
            "aws_ssm_document.ssm_auditpol",
            "aws_ssm_document.ssm_baseline",
            "aws_ssm_document.ssm_pki",
            "aws_subnet.network_subnet1",
            "aws_subnet.network_subnet2",
            "aws_vpc.network",
            "data.aws_ami.windows_2022",
            "data.aws_availability_zones.available",
            "data.aws_caller_identity.main",
            "data.aws_iam_policy_document.ec2",
            "data.aws_iam_policy_document.ec2_instance_assume_role_policy",
            "data.aws_partition.main",
            "random_password.secret_mad",
            "random_string.random_string"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_route53_resolver_rule_association",
      "name": "r53_outbound_resolver_rule_onprem_child_association",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": []
    },
    {
      "mode": "managed",
      "type": "aws_secretsmanager_secret",
      "name": "secret_fsx",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "arn": "arn:aws:secretsmanager:us-east-2:156285977455:secret:FSx-Service-Account-Secret-dnb6z912-LKKFwJ",
            "description": "",
            "force_overwrite_replica_secret": false,
            "id": "arn:aws:secretsmanager:us-east-2:156285977455:secret:FSx-Service-Account-Secret-dnb6z912-LKKFwJ",
            "kms_key_id": "",
            "name": "FSx-Service-Account-Secret-dnb6z912",
            "name_prefix": "",
            "policy": "",
            "recovery_window_in_days": 30,
            "replica": [],
            "rotation_enabled": false,
            "rotation_lambda_arn": "",
            "rotation_rules": [],
            "tags": {
              "Name": "FSx-Service-Account-Secret-dnb6z912"
            },
            "tags_all": {
              "Name": "FSx-Service-Account-Secret-dnb6z912"
            }
          },
          "sensitive_attributes": [],
          "private": "bnVsbA==",
          "dependencies": [
            "random_string.random_string"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_secretsmanager_secret",
      "name": "secret_mad",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "arn": "arn:aws:secretsmanager:us-east-2:156285977455:secret:corp.example.com-MAD-Secret-dnb6z912-HIrOgH",
            "description": "",
            "force_overwrite_replica_secret": false,
            "id": "arn:aws:secretsmanager:us-east-2:156285977455:secret:corp.example.com-MAD-Secret-dnb6z912-HIrOgH",
            "kms_key_id": "",
            "name": "corp.example.com-MAD-Secret-dnb6z912",
            "name_prefix": "",
            "policy": "",
            "recovery_window_in_days": 30,
            "replica": [],
            "rotation_enabled": false,
            "rotation_lambda_arn": "",
            "rotation_rules": [],
            "tags": {
              "Name": "corp.example.com-MAD-Secret-dnb6z912"
            },
            "tags_all": {
              "Name": "corp.example.com-MAD-Secret-dnb6z912"
            }
          },
          "sensitive_attributes": [],
          "private": "bnVsbA==",
          "dependencies": [
            "random_string.random_string"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_secretsmanager_secret",
      "name": "secret_onprem",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "arn": "arn:aws:secretsmanager:us-east-2:156285977455:secret:onpremises.local-Onprem-Secret-dnb6z912-6YfVOP",
            "description": "",
            "force_overwrite_replica_secret": false,
            "id": "arn:aws:secretsmanager:us-east-2:156285977455:secret:onpremises.local-Onprem-Secret-dnb6z912-6YfVOP",
            "kms_key_id": "",
            "name": "onpremises.local-Onprem-Secret-dnb6z912",
            "name_prefix": "",
            "policy": "",
            "recovery_window_in_days": 30,
            "replica": [],
            "rotation_enabled": false,
            "rotation_lambda_arn": "",
            "rotation_rules": [],
            "tags": {
              "Name": "onpremises.local-Onprem-Secret-dnb6z912"
            },
            "tags_all": {
              "Name": "onpremises.local-Onprem-Secret-dnb6z912"
            }
          },
          "sensitive_attributes": [],
          "private": "bnVsbA==",
          "dependencies": [
            "random_string.random_string"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_secretsmanager_secret",
      "name": "secret_rds",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "arn": "arn:aws:secretsmanager:us-east-2:156285977455:secret:RDS-Admin-Secret-dnb6z912-LKKFwJ",
            "description": "",
            "force_overwrite_replica_secret": false,
            "id": "arn:aws:secretsmanager:us-east-2:156285977455:secret:RDS-Admin-Secret-dnb6z912-LKKFwJ",
            "kms_key_id": "",
            "name": "RDS-Admin-Secret-dnb6z912",
            "name_prefix": "",
            "policy": "",
            "recovery_window_in_days": 30,
            "replica": [],
            "rotation_enabled": false,
            "rotation_lambda_arn": "",
            "rotation_rules": [],
            "tags": {
              "Name": "RDS-Admin-Secret-dnb6z912"
            },
            "tags_all": {
              "Name": "RDS-Admin-Secret-dnb6z912"
            }
          },
          "sensitive_attributes": [],
          "private": "bnVsbA==",
          "dependencies": [
            "random_string.random_string"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_secretsmanager_secret_version",
      "name": "secret_fsx",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "arn": "arn:aws:secretsmanager:us-east-2:156285977455:secret:FSx-Service-Account-Secret-dnb6z912-LKKFwJ",
            "id": "arn:aws:secretsmanager:us-east-2:156285977455:secret:FSx-Service-Account-Secret-dnb6z912-LKKFwJ|BDB5D173-93BB-4BD2-8E5F-619041D4E270",
            "secret_binary": "",
            "secret_id": "arn:aws:secretsmanager:us-east-2:156285977455:secret:FSx-Service-Account-Secret-dnb6z912-LKKFwJ",
            "secret_string": "{\"password\":\"0}o9PJME!{c%N)wTm\\u003caP?IYLEBXf5#aF\",\"username\":\"FSxServiceAccount\"}",
            "version_id": "BDB5D173-93BB-4BD2-8E5F-619041D4E270",
            "version_stages": [
              "AWSCURRENT"
            ]
          },
          "sensitive_attributes": [
            [
              {
                "type": "get_attr",
                "value": "secret_string"
              }
            ]
          ],
          "private": "bnVsbA==",
          "dependencies": [
            "aws_secretsmanager_secret.secret_fsx",
            "random_password.secret_fsx",
            "random_string.random_string"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_secretsmanager_secret_version",
      "name": "secret_mad",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "arn": "arn:aws:secretsmanager:us-east-2:156285977455:secret:corp.example.com-MAD-Secret-dnb6z912-HIrOgH",
            "id": "arn:aws:secretsmanager:us-east-2:156285977455:secret:corp.example.com-MAD-Secret-dnb6z912-HIrOgH|DE032BC9-D45F-4537-B906-C7A6CD24F7BB",
            "secret_binary": "",
            "secret_id": "arn:aws:secretsmanager:us-east-2:156285977455:secret:corp.example.com-MAD-Secret-dnb6z912-HIrOgH",
            "secret_string": "{\"password\":\"1g3?D!l3?1Nv3Ve-i1L=qmkH4#Q3bSTE\",\"username\":\"Admin\"}",
            "version_id": "DE032BC9-D45F-4537-B906-C7A6CD24F7BB",
            "version_stages": [
              "AWSCURRENT"
            ]
          },
          "sensitive_attributes": [
            [
              {
                "type": "get_attr",
                "value": "secret_string"
              }
            ]
          ],
          "private": "bnVsbA==",
          "dependencies": [
            "aws_secretsmanager_secret.secret_mad",
            "random_password.secret_mad",
            "random_string.random_string"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_secretsmanager_secret_version",
      "name": "secret_onprem",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "arn": "arn:aws:secretsmanager:us-east-2:156285977455:secret:onpremises.local-Onprem-Secret-dnb6z912-6YfVOP",
            "id": "arn:aws:secretsmanager:us-east-2:156285977455:secret:onpremises.local-Onprem-Secret-dnb6z912-6YfVOP|F5178CE1-D0BF-49DF-BDCB-99006387B6A0",
            "secret_binary": "",
            "secret_id": "arn:aws:secretsmanager:us-east-2:156285977455:secret:onpremises.local-Onprem-Secret-dnb6z912-6YfVOP",
            "secret_string": "{\"password\":\"l5Nrq[H[46BV9Hj8EiZiyW8ZpIm?Vi?s\",\"username\":\"Administrator\"}",
            "version_id": "F5178CE1-D0BF-49DF-BDCB-99006387B6A0",
            "version_stages": [
              "AWSCURRENT"
            ]
          },
          "sensitive_attributes": [
            [
              {
                "type": "get_attr",
                "value": "secret_string"
              }
            ]
          ],
          "private": "bnVsbA==",
          "dependencies": [
            "aws_secretsmanager_secret.secret_onprem",
            "random_password.secret_onprem",
            "random_string.random_string"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_secretsmanager_secret_version",
      "name": "secret_rds",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "arn": "arn:aws:secretsmanager:us-east-2:156285977455:secret:RDS-Admin-Secret-dnb6z912-LKKFwJ",
            "id": "arn:aws:secretsmanager:us-east-2:156285977455:secret:RDS-Admin-Secret-dnb6z912-LKKFwJ|605FCB67-7534-4DDD-852E-D166A3B48BFF",
            "secret_binary": "",
            "secret_id": "arn:aws:secretsmanager:us-east-2:156285977455:secret:RDS-Admin-Secret-dnb6z912-LKKFwJ",
            "secret_string": "{\"password\":\"XNb(n+oM=\\u0026PFmt+{u{KB3d8iMi]a+jGz\",\"username\":\"Admin\"}",
            "version_id": "605FCB67-7534-4DDD-852E-D166A3B48BFF",
            "version_stages": [
              "AWSCURRENT"
            ]
          },
          "sensitive_attributes": [
            [
              {
                "type": "get_attr",
                "value": "secret_string"
              }
            ]
          ],
          "private": "bnVsbA==",
          "dependencies": [
            "aws_secretsmanager_secret.secret_rds",
            "random_password.secret_rds",
            "random_string.random_string"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_security_group",
      "name": "fsx",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "index_key": 0,
          "schema_version": 1,
          "attributes": {
            "arn": "arn:aws:ec2:us-east-2:156285977455:security-group/sg-09c4b7adc5923613f",
            "description": "FSx Security Group",
            "egress": [
              {
                "cidr_blocks": [
                  "0.0.0.0/0"
                ],
                "description": "",
                "from_port": 0,
                "ipv6_cidr_blocks": [],
                "prefix_list_ids": [],
                "protocol": "-1",
                "security_groups": [],
                "self": false,
                "to_port": 0
              }
            ],
            "id": "sg-09c4b7adc5923613f",
            "ingress": [
              {
                "cidr_blocks": [
                  "10.0.0.0/24"
                ],
                "description": "",
                "from_port": 445,
                "ipv6_cidr_blocks": [],
                "prefix_list_ids": [],
                "protocol": "tcp",
                "security_groups": [],
                "self": false,
                "to_port": 445
              },
              {
                "cidr_blocks": [
                  "10.0.0.0/24"
                ],
                "description": "",
                "from_port": 5985,
                "ipv6_cidr_blocks": [],
                "prefix_list_ids": [],
                "protocol": "tcp",
                "security_groups": [],
                "self": false,
                "to_port": 5985
              }
            ],
            "name": "FSx-Security-Group-dnb6z912",
            "name_prefix": "",
            "owner_id": "156285977455",
            "revoke_rules_on_delete": false,
            "tags": {
              "Name": "FSx-Security-Group-dnb6z912"
            },
            "tags_all": {
              "Name": "FSx-Security-Group-dnb6z912"
            },
            "timeouts": null,
            "vpc_id": "vpc-04a2f5c1bfcfaf737"
          },
          "sensitive_attributes": [],
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjo2MDAwMDAwMDAwMDAsImRlbGV0ZSI6OTAwMDAwMDAwMDAwfSwic2NoZW1hX3ZlcnNpb24iOiIxIn0=",
          "dependencies": [
            "aws_vpc.network",
            "random_string.random_string"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_security_group",
      "name": "ms_sg",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 1,
          "attributes": {
            "arn": "arn:aws:ec2:us-east-2:156285977455:security-group/sg-070357a6b87c039be",
            "description": "Member Server Security Group",
            "egress": [
              {
                "cidr_blocks": [
                  "0.0.0.0/0"
                ],
                "description": "",
                "from_port": 0,
                "ipv6_cidr_blocks": [],
                "prefix_list_ids": [],
                "protocol": "-1",
                "security_groups": [],
                "self": false,
                "to_port": 0
              }
            ],
            "id": "sg-070357a6b87c039be",
            "ingress": [
              {
                "cidr_blocks": [
                  "10.0.0.0/24"
                ],
                "description": "",
                "from_port": 135,
                "ipv6_cidr_blocks": [],
                "prefix_list_ids": [],
                "protocol": "tcp",
                "security_groups": [],
                "self": false,
                "to_port": 135
              },
              {
                "cidr_blocks": [
                  "10.0.0.0/24"
                ],
                "description": "",
                "from_port": 3389,
                "ipv6_cidr_blocks": [],
                "prefix_list_ids": [],
                "protocol": "tcp",
                "security_groups": [],
                "self": false,
                "to_port": 3389
              },
              {
                "cidr_blocks": [
                  "10.0.0.0/24"
                ],
                "description": "",
                "from_port": 5985,
                "ipv6_cidr_blocks": [],
                "prefix_list_ids": [],
                "protocol": "tcp",
                "security_groups": [],
                "self": false,
                "to_port": 5985
              },
              {
                "cidr_blocks": [
                  "10.0.0.0/24"
                ],
                "description": "",
                "from_port": 5986,
                "ipv6_cidr_blocks": [],
                "prefix_list_ids": [],
                "protocol": "tcp",
                "security_groups": [],
                "self": false,
                "to_port": 5986
              }
            ],
            "name": "Member-Server-Security-Group-dnb6z912",
            "name_prefix": "",
            "owner_id": "156285977455",
            "revoke_rules_on_delete": false,
            "tags": {
              "Name": "Member-Server-Security-Group-dnb6z912"
            },
            "tags_all": {
              "Name": "Member-Server-Security-Group-dnb6z912"
            },
            "timeouts": null,
            "vpc_id": "vpc-04a2f5c1bfcfaf737"
          },
          "sensitive_attributes": [],
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjo2MDAwMDAwMDAwMDAsImRlbGV0ZSI6OTAwMDAwMDAwMDAwfSwic2NoZW1hX3ZlcnNpb24iOiIxIn0=",
          "dependencies": [
            "aws_vpc.network",
            "random_string.random_string"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_security_group",
      "name": "onprem_ad_sg",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 1,
          "attributes": {
            "arn": "arn:aws:ec2:us-east-2:156285977455:security-group/sg-08fcf1d2c74d387f2",
            "description": "Domain Controller Security Group",
            "egress": [
              {
                "cidr_blocks": [
                  "0.0.0.0/0"
                ],
                "description": "",
                "from_port": 0,
                "ipv6_cidr_blocks": [],
                "prefix_list_ids": [],
                "protocol": "-1",
                "security_groups": [],
                "self": false,
                "to_port": 0
              }
            ],
            "id": "sg-08fcf1d2c74d387f2",
            "ingress": [
              {
                "cidr_blocks": [
                  "10.0.0.0/24"
                ],
                "description": "",
                "from_port": 123,
                "ipv6_cidr_blocks": [],
                "prefix_list_ids": [],
                "protocol": "udp",
                "security_groups": [],
                "self": false,
                "to_port": 123
              },
              {
                "cidr_blocks": [
                  "10.0.0.0/24"
                ],
                "description": "",
                "from_port": 135,
                "ipv6_cidr_blocks": [],
                "prefix_list_ids": [],
                "protocol": "tcp",
                "security_groups": [],
                "self": false,
                "to_port": 135
              },
              {
                "cidr_blocks": [
                  "10.0.0.0/24"
                ],
                "description": "",
                "from_port": 138,
                "ipv6_cidr_blocks": [],
                "prefix_list_ids": [],
                "protocol": "udp",
                "security_groups": [],
                "self": false,
                "to_port": 138
              },
              {
                "cidr_blocks": [
                  "10.0.0.0/24"
                ],
                "description": "",
                "from_port": 3268,
                "ipv6_cidr_blocks": [],
                "prefix_list_ids": [],
                "protocol": "tcp",
                "security_groups": [],
                "self": false,
                "to_port": 3268
              },
              {
                "cidr_blocks": [
                  "10.0.0.0/24"
                ],
                "description": "",
                "from_port": 3269,
                "ipv6_cidr_blocks": [],
                "prefix_list_ids": [],
                "protocol": "tcp",
                "security_groups": [],
                "self": false,
                "to_port": 3269
              },
              {
                "cidr_blocks": [
                  "10.0.0.0/24"
                ],
                "description": "",
                "from_port": 3389,
                "ipv6_cidr_blocks": [],
                "prefix_list_ids": [],
                "protocol": "tcp",
                "security_groups": [],
                "self": false,
                "to_port": 3389
              },
              {
                "cidr_blocks": [
                  "10.0.0.0/24"
                ],
                "description": "",
                "from_port": 389,
                "ipv6_cidr_blocks": [],
                "prefix_list_ids": [],
                "protocol": "tcp",
                "security_groups": [],
                "self": false,
                "to_port": 389
              },
              {
                "cidr_blocks": [
                  "10.0.0.0/24"
                ],
                "description": "",
                "from_port": 389,
                "ipv6_cidr_blocks": [],
                "prefix_list_ids": [],
                "protocol": "udp",
                "security_groups": [],
                "self": false,
                "to_port": 389
              },
              {
                "cidr_blocks": [
                  "10.0.0.0/24"
                ],
                "description": "",
                "from_port": 445,
                "ipv6_cidr_blocks": [],
                "prefix_list_ids": [],
                "protocol": "tcp",
                "security_groups": [],
                "self": false,
                "to_port": 445
              },
              {
                "cidr_blocks": [
                  "10.0.0.0/24"
                ],
                "description": "",
                "from_port": 445,
                "ipv6_cidr_blocks": [],
                "prefix_list_ids": [],
                "protocol": "udp",
                "security_groups": [],
                "self": false,
                "to_port": 445
              },
              {
                "cidr_blocks": [
                  "10.0.0.0/24"
                ],
                "description": "",
                "from_port": 464,
                "ipv6_cidr_blocks": [],
                "prefix_list_ids": [],
                "protocol": "tcp",
                "security_groups": [],
                "self": false,
                "to_port": 464
              },
              {
                "cidr_blocks": [
                  "10.0.0.0/24"
                ],
                "description": "",
                "from_port": 464,
                "ipv6_cidr_blocks": [],
                "prefix_list_ids": [],
                "protocol": "udp",
                "security_groups": [],
                "self": false,
                "to_port": 464
              },
              {
                "cidr_blocks": [
                  "10.0.0.0/24"
                ],
                "description": "",
                "from_port": 49152,
                "ipv6_cidr_blocks": [],
                "prefix_list_ids": [],
                "protocol": "tcp",
                "security_groups": [],
                "self": false,
                "to_port": 65535
              },
              {
                "cidr_blocks": [
                  "10.0.0.0/24"
                ],
                "description": "",
                "from_port": 49152,
                "ipv6_cidr_blocks": [],
                "prefix_list_ids": [],
                "protocol": "udp",
                "security_groups": [],
                "self": false,
                "to_port": 65535
              },
              {
                "cidr_blocks": [
                  "10.0.0.0/24"
                ],
                "description": "",
                "from_port": 53,
                "ipv6_cidr_blocks": [],
                "prefix_list_ids": [],
                "protocol": "tcp",
                "security_groups": [],
                "self": false,
                "to_port": 53
              },
              {
                "cidr_blocks": [
                  "10.0.0.0/24"
                ],
                "description": "",
                "from_port": 53,
                "ipv6_cidr_blocks": [],
                "prefix_list_ids": [],
                "protocol": "udp",
                "security_groups": [],
                "self": false,
                "to_port": 53
              },
              {
                "cidr_blocks": [
                  "10.0.0.0/24"
                ],
                "description": "",
                "from_port": 5985,
                "ipv6_cidr_blocks": [],
                "prefix_list_ids": [],
                "protocol": "tcp",
                "security_groups": [],
                "self": false,
                "to_port": 5985
              },
              {
                "cidr_blocks": [
                  "10.0.0.0/24"
                ],
                "description": "",
                "from_port": 5986,
                "ipv6_cidr_blocks": [],
                "prefix_list_ids": [],
                "protocol": "tcp",
                "security_groups": [],
                "self": false,
                "to_port": 5986
              },
              {
                "cidr_blocks": [
                  "10.0.0.0/24"
                ],
                "description": "",
                "from_port": 636,
                "ipv6_cidr_blocks": [],
                "prefix_list_ids": [],
                "protocol": "tcp",
                "security_groups": [],
                "self": false,
                "to_port": 636
              },
              {
                "cidr_blocks": [
                  "10.0.0.0/24"
                ],
                "description": "",
                "from_port": 88,
                "ipv6_cidr_blocks": [],
                "prefix_list_ids": [],
                "protocol": "tcp",
                "security_groups": [],
                "self": false,
                "to_port": 88
              },
              {
                "cidr_blocks": [
                  "10.0.0.0/24"
                ],
                "description": "",
                "from_port": 88,
                "ipv6_cidr_blocks": [],
                "prefix_list_ids": [],
                "protocol": "udp",
                "security_groups": [],
                "self": false,
                "to_port": 88
              },
              {
                "cidr_blocks": [
                  "10.0.0.0/24"
                ],
                "description": "",
                "from_port": 9389,
                "ipv6_cidr_blocks": [],
                "prefix_list_ids": [],
                "protocol": "tcp",
                "security_groups": [],
                "self": false,
                "to_port": 9389
              }
            ],
            "name": "Domain-Controller-Security-Group-dnb6z912",
            "name_prefix": "",
            "owner_id": "156285977455",
            "revoke_rules_on_delete": false,
            "tags": {
              "Name": "Domain-Controller-Security-Group-dnb6z912"
            },
            "tags_all": {
              "Name": "Domain-Controller-Security-Group-dnb6z912"
            },
            "timeouts": null,
            "vpc_id": "vpc-04a2f5c1bfcfaf737"
          },
          "sensitive_attributes": [],
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjo2MDAwMDAwMDAwMDAsImRlbGV0ZSI6OTAwMDAwMDAwMDAwfSwic2NoZW1hX3ZlcnNpb24iOiIxIn0=",
          "dependencies": [
            "aws_vpc.network",
            "random_string.random_string"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_security_group",
      "name": "pki_sg",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 1,
          "attributes": {
            "arn": "arn:aws:ec2:us-east-2:156285977455:security-group/sg-0f61aeb7a0fc21703",
            "description": "PKI Security Group",
            "egress": [
              {
                "cidr_blocks": [
                  "0.0.0.0/0"
                ],
                "description": "",
                "from_port": 0,
                "ipv6_cidr_blocks": [],
                "prefix_list_ids": [],
                "protocol": "-1",
                "security_groups": [],
                "self": false,
                "to_port": 0
              }
            ],
            "id": "sg-0f61aeb7a0fc21703",
            "ingress": [
              {
                "cidr_blocks": [
                  "10.0.0.0/24"
                ],
                "description": "",
                "from_port": 135,
                "ipv6_cidr_blocks": [],
                "prefix_list_ids": [],
                "protocol": "tcp",
                "security_groups": [],
                "self": false,
                "to_port": 135
              },
              {
                "cidr_blocks": [
                  "10.0.0.0/24"
                ],
                "description": "",
                "from_port": 3389,
                "ipv6_cidr_blocks": [],
                "prefix_list_ids": [],
                "protocol": "tcp",
                "security_groups": [],
                "self": false,
                "to_port": 3389
              },
              {
                "cidr_blocks": [
                  "10.0.0.0/24"
                ],
                "description": "",
                "from_port": 49152,
                "ipv6_cidr_blocks": [],
                "prefix_list_ids": [],
                "protocol": "tcp",
                "security_groups": [],
                "self": false,
                "to_port": 65535
              },
              {
                "cidr_blocks": [
                  "10.0.0.0/24"
                ],
                "description": "",
                "from_port": 5985,
                "ipv6_cidr_blocks": [],
                "prefix_list_ids": [],
                "protocol": "tcp",
                "security_groups": [],
                "self": false,
                "to_port": 5985
              },
              {
                "cidr_blocks": [
                  "10.0.0.0/24"
                ],
                "description": "",
                "from_port": 5986,
                "ipv6_cidr_blocks": [],
                "prefix_list_ids": [],
                "protocol": "tcp",
                "security_groups": [],
                "self": false,
                "to_port": 5986
              }
            ],
            "name": "PKI-Security-Group-dnb6z912",
            "name_prefix": "",
            "owner_id": "156285977455",
            "revoke_rules_on_delete": false,
            "tags": {
              "Name": "PKI-Security-Group-dnb6z912"
            },
            "tags_all": {
              "Name": "PKI-Security-Group-dnb6z912"
            },
            "timeouts": null,
            "vpc_id": "vpc-04a2f5c1bfcfaf737"
          },
          "sensitive_attributes": [],
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjo2MDAwMDAwMDAwMDAsImRlbGV0ZSI6OTAwMDAwMDAwMDAwfSwic2NoZW1hX3ZlcnNpb24iOiIxIn0=",
          "dependencies": [
            "aws_vpc.network",
            "random_string.random_string"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_security_group",
      "name": "r53_outbound_resolver_sg",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 1,
          "attributes": {
            "arn": "arn:aws:ec2:us-east-2:156285977455:security-group/sg-00fe03e29d72ccb93",
            "description": "Demo-VPC-Outbound-Resolver-SG-dnb6z912",
            "egress": [
              {
                "cidr_blocks": [
                  "0.0.0.0/0"
                ],
                "description": "",
                "from_port": 53,
                "ipv6_cidr_blocks": [],
                "prefix_list_ids": [],
                "protocol": "tcp",
                "security_groups": [],
                "self": false,
                "to_port": 53
              },
              {
                "cidr_blocks": [
                  "0.0.0.0/0"
                ],
                "description": "",
                "from_port": 53,
                "ipv6_cidr_blocks": [],
                "prefix_list_ids": [],
                "protocol": "udp",
                "security_groups": [],
                "self": false,
                "to_port": 53
              }
            ],
            "id": "sg-00fe03e29d72ccb93",
            "ingress": [],
            "name": "Demo-VPC-Outbound-Resolver-SG-dnb6z912",
            "name_prefix": "",
            "owner_id": "156285977455",
            "revoke_rules_on_delete": false,
            "tags": {
              "Name": "Demo-VPC-Outbound-Resolver-SG-dnb6z912"
            },
            "tags_all": {
              "Name": "Demo-VPC-Outbound-Resolver-SG-dnb6z912"
            },
            "timeouts": null,
            "vpc_id": "vpc-04a2f5c1bfcfaf737"
          },
          "sensitive_attributes": [],
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjo2MDAwMDAwMDAwMDAsImRlbGV0ZSI6OTAwMDAwMDAwMDAwfSwic2NoZW1hX3ZlcnNpb24iOiIxIn0=",
          "dependencies": [
            "aws_vpc.network",
            "random_string.random_string"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_security_group",
      "name": "rds",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "index_key": 0,
          "schema_version": 1,
          "attributes": {
            "arn": "arn:aws:ec2:us-east-2:156285977455:security-group/sg-0b3a239ff6ed3518b",
            "description": "RDS Security Group",
            "egress": [
              {
                "cidr_blocks": [
                  "0.0.0.0/0"
                ],
                "description": "",
                "from_port": 0,
                "ipv6_cidr_blocks": [],
                "prefix_list_ids": [],
                "protocol": "-1",
                "security_groups": [],
                "self": false,
                "to_port": 0
              }
            ],
            "id": "sg-0b3a239ff6ed3518b",
            "ingress": [
              {
                "cidr_blocks": [
                  "10.0.0.0/24"
                ],
                "description": "SQL Inbound from VPC",
                "from_port": 1433,
                "ipv6_cidr_blocks": [],
                "prefix_list_ids": [],
                "protocol": "tcp",
                "security_groups": [],
                "self": false,
                "to_port": 1433
              }
            ],
            "name": "RDS-Security-Group-dnb6z912",
            "name_prefix": "",
            "owner_id": "156285977455",
            "revoke_rules_on_delete": false,
            "tags": {
              "Name": "RDS-Security-Group-dnb6z912"
            },
            "tags_all": {
              "Name": "RDS-Security-Group-dnb6z912"
            },
            "timeouts": null,
            "vpc_id": "vpc-04a2f5c1bfcfaf737"
          },
          "sensitive_attributes": [],
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjo2MDAwMDAwMDAwMDAsImRlbGV0ZSI6OTAwMDAwMDAwMDAwfSwic2NoZW1hX3ZlcnNpb24iOiIxIn0=",
          "dependencies": [
            "aws_vpc.network",
            "random_string.random_string"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_security_group_rule",
      "name": "mad",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 2,
          "attributes": {
            "cidr_blocks": [
              "0.0.0.0/0"
            ],
            "description": null,
            "from_port": 0,
            "id": "sgrule-385809410",
            "ipv6_cidr_blocks": null,
            "prefix_list_ids": null,
            "protocol": "-1",
            "security_group_id": "sg-0ff92f05c471afb1e",
            "self": false,
            "source_security_group_id": null,
            "to_port": 0,
            "type": "egress"
          },
          "sensitive_attributes": [],
          "private": "eyJzY2hlbWFfdmVyc2lvbiI6IjIifQ==",
          "dependencies": [
            "aws_directory_service_directory.mad",
            "aws_subnet.network_subnet1",
            "aws_subnet.network_subnet2",
            "aws_vpc.network",
            "data.aws_availability_zones.available",
            "random_password.secret_mad",
            "random_string.random_string"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_ssm_document",
      "name": "ssm_auditpol",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "arn": "arn:aws:ssm:us-east-2:156285977455:document/SSM-AuditPol-dnb6z912",
            "attachments_source": [],
            "content": "{\r\n  \"schemaVersion\" : \"0.3\",\r\n  \"description\" : \"Configure Kinesis Agent for Windows, Windows Auditing Policy, and deployment cleanup using SSM Automation\",\r\n  \"parameters\" : {\r\n    \"ServerNetBIOSName\" : {\r\n      \"description\" : \"NetBIOS name of the first Active Directory Domain Controller (up to 15 characters)\",\r\n      \"type\" : \"String\"\r\n    },\r\n    \"ServerRole\" : {\r\n      \"description\" : \"Role server will be (DomainController or CertificateAuthority)\",\r\n      \"type\" : \"String\"\r\n    },\r\n    \"VPCCIDR\" : {\r\n      \"description\" : \"CIDR Block for the VPC\",\r\n      \"type\" : \"String\"\r\n    },\r\n    \"StackName\" : {\r\n      \"description\" : \"Stack Name Input for cfn resource signal\",\r\n      \"type\" : \"String\"\r\n    }\r\n  },\r\n  \"mainSteps\" : [ {\r\n    \"outputs\" : [ {\r\n      \"Type\" : \"String\",\r\n      \"Name\" : \"InstanceId\",\r\n      \"Selector\" : \"$.Reservations[0].Instances[0].InstanceId\"\r\n    } ],\r\n    \"inputs\" : {\r\n      \"Filters\" : [ {\r\n        \"Values\" : [ \"{{ServerNetBIOSName}}\" ],\r\n        \"Name\" : \"tag:Name\"\r\n      }, {\r\n        \"Values\" : [ \"{{StackName}}\" ],\r\n        \"Name\" : \"tag:aws:cloudformation:stack-name\"\r\n      }, {\r\n        \"Values\" : [ \"running\" ],\r\n        \"Name\" : \"instance-state-name\"\r\n      } ],\r\n      \"Service\" : \"ec2\",\r\n      \"Api\" : \"DescribeInstances\"\r\n    },\r\n    \"name\" : \"InstanceId\",\r\n    \"action\" : \"aws:executeAwsApi\",\r\n    \"nextStep\" : \"configureInstance\"\r\n  }, {\r\n    \"inputs\" : {\r\n      \"Parameters\" : {\r\n        \"commands\" : \"Function Invoke-Cleanup {\\n    [CmdletBinding()]\\n    Param (\\n        [Parameter(Mandatory = $true)][String]$VPCCIDR\\n    )\\n\\n    Write-Output 'Setting Windows Firewall WinRM Public rule to allow VPC CIDR traffic'\\n    Try {\\n        Set-NetFirewallRule -Name 'WINRM-HTTP-In-TCP-PUBLIC' -RemoteAddress $VPCCIDR\\n    } Catch [System.Exception] {\\n        Write-Output \\\"Failed allow WinRM Traffic from VPC CIDR $_\\\"\\n    }\\n\\n    Write-Output 'Removing DSC Configuration'\\n    Try {\\n        Remove-DscConfigurationDocument -Stage 'Current' -ErrorAction Stop\\n    } Catch [System.Exception] {\\n        Write-Output \\\"Failed build DSC Configuration $_\\\"\\n    }\\n\\n    Write-Output 'Re-enabling Windows Firewall'\\n    Try {\\n        Get-NetFirewallProfile -ErrorAction Stop | Set-NetFirewallProfile -Enabled 'True' -ErrorAction Stop\\n    } Catch [System.Exception] {\\n        Write-Output \\\"Failed re-enable firewall $_\\\"\\n    }\\n\\n    Write-Output 'Removing build files'\\n    Try {\\n        Remove-Item -Path 'C:\\\\Temp' -Recurse -Force -ErrorAction Stop\\n    } Catch [System.Exception] {\\n        Write-Output \\\"Failed remove build files $_\\\"\\n    }\\n\\n    Write-Output 'Removing self signed cert'\\n    Try {\\n        $SelfSignedThumb = Get-ChildItem -Path 'cert:\\\\LocalMachine\\\\My\\\\' -ErrorAction Stop | Where-Object { $_.Subject -eq 'CN=DscEncryptCert' } | Select-Object -ExpandProperty 'Thumbprint'\\n        Remove-Item -Path \\\"cert:\\\\LocalMachine\\\\My\\\\$SelfSignedThumb\\\" -DeleteKey -ErrorAction Stop\\n    } Catch [System.Exception] {\\n        Write-Output \\\"Failed remove self signed cert $_\\\"\\n    }\\n}\\n\\nFunction Set-DscConfiguration {\\n    [CmdletBinding()]\\n    Param (\\n        [Parameter(Mandatory = $true)][String]$ServerRole\\n    )\\n    Configuration ConfigInstance {\\n        Import-DscResource -ModuleName 'AuditPolicyDsc', 'SChannelDsc'\\n        Node LocalHost {\\n            AuditPolicySubcategory CredentialValidationSuccess {\\n                Name      = 'Credential Validation'\\n                AuditFlag = 'Success'\\n                Ensure    = 'Present'\\n            }\\n            AuditPolicySubcategory CredentialValidationFailure {\\n                Name      = 'Credential Validation'\\n                AuditFlag = 'Failure'\\n                Ensure    = 'Present'\\n            }\\n            AuditPolicySubcategory OtherAccountLogonEventsSuccess {\\n                Name      = 'Other Account Logon Events'\\n                AuditFlag = 'Success'\\n                Ensure    = 'Absent'\\n            }\\n            AuditPolicySubcategory OtherAccountLogonEventsFailure {\\n                Name      = 'Other Account Logon Events'\\n                AuditFlag = 'Failure'\\n                Ensure    = 'Absent'\\n            }\\n            AuditPolicySubcategory ApplicationGroupManagementSuccess {\\n                Name      = 'Application Group Management'\\n                AuditFlag = 'Success'\\n                Ensure    = 'Absent'\\n            }\\n            AuditPolicySubcategory ApplicationGroupManagementFailure {\\n                Name      = 'Application Group Management'\\n                AuditFlag = 'Failure'\\n                Ensure    = 'Absent'\\n            }\\n            AuditPolicySubcategory ComputerAccountManagementFailure {\\n                Name      = 'Computer Account Management'\\n                AuditFlag = 'Failure'\\n                Ensure    = 'Absent'\\n            }\\n            AuditPolicySubcategory DistributionGroupManagementFailure {\\n                Name      = 'Distribution Group Management'\\n                AuditFlag = 'Failure'\\n                Ensure    = 'Absent'\\n            }\\n            AuditPolicySubcategory OtherAccountManagementEventsSuccess {\\n                Name      = 'Other Account Management Events'\\n                AuditFlag = 'Success'\\n                Ensure    = 'Present'\\n            }\\n            AuditPolicySubcategory OtherAccountManagementEventsFailure {\\n                Name      = 'Other Account Management Events'\\n                AuditFlag = 'Failure'\\n                Ensure    = 'Absent'\\n            }\\n            AuditPolicySubcategory SecurityGroupManagementSuccess {\\n                Name      = 'Security Group Management'\\n                AuditFlag = 'Success'\\n                Ensure    = 'Present'\\n            }\\n            AuditPolicySubcategory SecurityGroupManagementFailure {\\n                Name      = 'Security Group Management'\\n                AuditFlag = 'Failure'\\n                Ensure    = 'Absent'\\n            }\\n            AuditPolicySubcategory UserAccountManagementSuccess {\\n                Name      = 'User Account Management'\\n                AuditFlag = 'Success'\\n                Ensure    = 'Present'\\n            }\\n            AuditPolicySubcategory UserAccountManagementFailure {\\n                Name      = 'User Account Management'\\n                AuditFlag = 'Failure'\\n                Ensure    = 'Present'\\n            }\\n            AuditPolicySubcategory DPAPIActivitySuccess {\\n                Name      = 'DPAPI Activity'\\n                AuditFlag = 'Success'\\n                Ensure    = 'Present'\\n            }\\n            AuditPolicySubcategory DPAPIActivityFailure {\\n                Name      = 'DPAPI Activity'\\n                AuditFlag = 'Failure'\\n                Ensure    = 'Present'\\n            }\\n            AuditPolicySubcategory PNPActivitySuccess {\\n                Name      = 'Plug and Play Events'\\n                AuditFlag = 'Success'\\n                Ensure    = 'Present'\\n            }\\n            AuditPolicySubcategory PNPActivityFailure {\\n                Name      = 'Plug and Play Events'\\n                AuditFlag = 'Failure'\\n                Ensure    = 'Absent'\\n            }\\n            AuditPolicySubcategory ProcessCreationSuccess {\\n                Name      = 'Process Creation'\\n                AuditFlag = 'Success'\\n                Ensure    = 'Present'\\n            }\\n            AuditPolicySubcategory ProcessCreationFailure {\\n                Name      = 'Process Creation'\\n                AuditFlag = 'Failure'\\n                Ensure    = 'Absent'\\n            }\\n            AuditPolicySubcategory ProcessTerminationSuccess {\\n                Name      = 'Process Termination'\\n                AuditFlag = 'Success'\\n                Ensure    = 'Present'\\n            }\\n            AuditPolicySubcategory ProcessTerminationFailure {\\n                Name      = 'Process Termination'\\n                AuditFlag = 'Failure'\\n                Ensure    = 'Absent'\\n            }\\n            AuditPolicySubcategory RPCEventsSuccess {\\n                Name      = 'RPC Events'\\n                AuditFlag = 'Success'\\n                Ensure    = 'Absent'\\n            }\\n            AuditPolicySubcategory RPCEventsFailure {\\n                Name      = 'RPC Events'\\n                AuditFlag = 'Failure'\\n                Ensure    = 'Absent'\\n            }\\n            AuditPolicySubcategory TokenRightAdjustedSuccess {\\n                Name      = 'Token Right Adjusted Events'\\n                AuditFlag = 'Success'\\n                Ensure    = 'Present'\\n            }\\n            AuditPolicySubcategory TokenRightAdjustedFailure {\\n                Name      = 'Token Right Adjusted Events'\\n                AuditFlag = 'Failure'\\n                Ensure    = 'Absent'\\n            }\\n            AuditPolicySubcategory DirectoryServiceAccessSuccess {\\n                Name      = 'Directory Service Access'\\n                AuditFlag = 'Success'\\n                Ensure    = 'Absent'\\n            }\\n            AuditPolicySubcategory DirectoryServiceChangesFailure {\\n                Name      = 'Directory Service Changes'\\n                AuditFlag = 'Failure'\\n                Ensure    = 'Absent'\\n            }\\n            AuditPolicySubcategory AccountLockoutSuccess {\\n                Name      = 'Account Lockout'\\n                AuditFlag = 'Success'\\n                Ensure    = 'Absent'\\n            }\\n            AuditPolicySubcategory AccountLockoutFailure {\\n                Name      = 'Account Lockout'\\n                AuditFlag = 'Failure'\\n                Ensure    = 'Present'\\n            }\\n            AuditPolicySubcategory UserDeviceClaimsSuccess {\\n                Name      = 'User / Device Claims'\\n                AuditFlag = 'Success'\\n                Ensure    = 'Present'\\n            }\\n            AuditPolicySubcategory UserDeviceClaimsFailure {\\n                Name      = 'User / Device Claims'\\n                AuditFlag = 'Failure'\\n                Ensure    = 'Absent'\\n            }\\n            AuditPolicySubcategory GroupMembershipSuccess {\\n                Name      = 'Group Membership'\\n                AuditFlag = 'Success'\\n                Ensure    = 'Present'\\n            }\\n            AuditPolicySubcategory GroupMembershipFailure {\\n                Name      = 'Group Membership'\\n                AuditFlag = 'Failure'\\n                Ensure    = 'Absent'\\n            }\\n            AuditPolicySubcategory IPsecExtendedModeSuccess {\\n                Name      = 'IPsec Extended Mode'\\n                AuditFlag = 'Success'\\n                Ensure    = 'Present'\\n            }\\n            AuditPolicySubcategory IPsecExtendedModeFailure {\\n                Name      = 'IPsec Extended Mode'\\n                AuditFlag = 'Failure'\\n                Ensure    = 'Present'\\n            }\\n            AuditPolicySubcategory IPsecMainModeSuccess {\\n                Name      = 'IPsec Main Mode'\\n                AuditFlag = 'Success'\\n                Ensure    = 'Present'\\n            }\\n            AuditPolicySubcategory IPsecMainModeFailure {\\n                Name      = 'IPsec Main Mode'\\n                AuditFlag = 'Failure'\\n                Ensure    = 'Present'\\n            }\\n            AuditPolicySubcategory IPsecQuickModeSuccess {\\n                Name      = 'IPsec Quick Mode'\\n                AuditFlag = 'Success'\\n                Ensure    = 'Present'\\n            }\\n            AuditPolicySubcategory IPsecQuickModeFailure {\\n                Name      = 'IPsec Quick Mode'\\n                AuditFlag = 'Failure'\\n                Ensure    = 'Present'\\n            }\\n            AuditPolicySubcategory LogoffSuccess {\\n                Name      = 'Logoff'\\n                AuditFlag = 'Success'\\n                Ensure    = 'Present'\\n            }\\n            AuditPolicySubcategory Logoffailure {\\n                Name      = 'Logoff'\\n                AuditFlag = 'Failure'\\n                Ensure    = 'Absent'\\n            }\\n            AuditPolicySubcategory LogonSuccess {\\n                Name      = 'Logon'\\n                AuditFlag = 'Success'\\n                Ensure    = 'Present'\\n            }\\n            AuditPolicySubcategory LogonFailure {\\n                Name      = 'Logon'\\n                AuditFlag = 'Failure'\\n                Ensure    = 'Present'\\n            }\\n            AuditPolicySubcategory NetworkPolicyServerSuccess {\\n                Name      = 'Network Policy Server'\\n                AuditFlag = 'Success'\\n                Ensure    = 'Present'\\n            }\\n            AuditPolicySubcategory NetworkPolicyServerFailure {\\n                Name      = 'Network Policy Server'\\n                AuditFlag = 'Failure'\\n                Ensure    = 'Present'\\n            }\\n            AuditPolicySubcategory OtherLogonLogoffEventsSuccess {\\n                Name      = 'Other Logon/Logoff Events'\\n                AuditFlag = 'Success'\\n                Ensure    = 'Present'\\n            }\\n            AuditPolicySubcategory OtherLogonLogoffEventsFailure {\\n                Name      = 'Other Logon/Logoff Events'\\n                AuditFlag = 'Failure'\\n                Ensure    = 'Present'\\n            }\\n            AuditPolicySubcategory SpecialLogonSuccess {\\n                Name      = 'Special Logon'\\n                AuditFlag = 'Success'\\n                Ensure    = 'Present'\\n            }\\n            AuditPolicySubcategory SpecialLogonFailure {\\n                Name      = 'Special Logon'\\n                AuditFlag = 'Failure'\\n                Ensure    = 'Absent'\\n            }\\n            AuditPolicySubcategory ApplicationGeneratedSuccess {\\n                Name      = 'Application Generated'\\n                AuditFlag = 'Success'\\n                Ensure    = 'Absent'\\n            }\\n            AuditPolicySubcategory ApplicationGeneratedFailure {\\n                Name      = 'Application Generated'\\n                AuditFlag = 'Failure'\\n                Ensure    = 'Absent'\\n            }\\n            AuditPolicySubcategory DetailedFileShareFailure {\\n                Name      = 'Detailed File Share'\\n                AuditFlag = 'Failure'\\n                Ensure    = 'Present'\\n            }\\n            AuditPolicySubcategory FileShareSuccess {\\n                Name      = 'File Share'\\n                AuditFlag = 'Success'\\n                Ensure    = 'Present'\\n            }\\n            AuditPolicySubcategory FileShareFailure {\\n                Name      = 'File Share'\\n                AuditFlag = 'Failure'\\n                Ensure    = 'Present'\\n            }\\n            AuditPolicySubcategory FileSystemSuccess {\\n                Name      = 'File System'\\n                AuditFlag = 'Success'\\n                Ensure    = 'Present'\\n            }\\n            AuditPolicySubcategory FileSystemFailure {\\n                Name      = 'File System'\\n                AuditFlag = 'Failure'\\n                Ensure    = 'Present'\\n            }\\n            AuditPolicySubcategory FilteringPlatformConnectionSuccess {\\n                Name      = 'Filtering Platform Connection'\\n                AuditFlag = 'Success'\\n                Ensure    = 'Present'\\n            }\\n            AuditPolicySubcategory FilteringPlatformConnectionFailure {\\n                Name      = 'Filtering Platform Connection'\\n                AuditFlag = 'Failure'\\n                Ensure    = 'Present'\\n            }\\n            AuditPolicySubcategory FilteringPlatformPacketDropSuccess {\\n                Name      = 'Filtering Platform Packet Drop'\\n                AuditFlag = 'Success'\\n                Ensure    = 'Absent'\\n            }\\n            AuditPolicySubcategory FilteringPlatformPacketDropFailure {\\n                Name      = 'Filtering Platform Packet Drop'\\n                AuditFlag = 'Failure'\\n                Ensure    = 'Absent'\\n            }\\n            AuditPolicySubcategory HandleManipulationSuccess {\\n                Name      = 'Handle Manipulation'\\n                AuditFlag = 'Success'\\n                Ensure    = 'Absent'\\n            }\\n            AuditPolicySubcategory HandleManipulationFailure {\\n                Name      = 'Handle Manipulation'\\n                AuditFlag = 'Failure'\\n                Ensure    = 'Absent'\\n            }\\n            AuditPolicySubcategory KernelObjectSuccess {\\n                Name      = 'Kernel Object'\\n                AuditFlag = 'Success'\\n                Ensure    = 'Absent'\\n            }\\n            AuditPolicySubcategory KernelObjectFailure {\\n                Name      = 'Kernel Object'\\n                AuditFlag = 'Failure'\\n                Ensure    = 'Absent'\\n            }\\n            AuditPolicySubcategory OtherObjectAccessEventsSuccess {\\n                Name      = 'Other Object Access Events'\\n                AuditFlag = 'Success'\\n                Ensure    = 'Present'\\n            }\\n            AuditPolicySubcategory OtherObjectAccessEventsFailure {\\n                Name      = 'Other Object Access Events'\\n                AuditFlag = 'Failure'\\n                Ensure    = 'Present'\\n            }\\n            AuditPolicySubcategory RegistrySuccess {\\n                Name      = 'Registry'\\n                AuditFlag = 'Success'\\n                Ensure    = 'Present'\\n            }\\n            AuditPolicySubcategory RegistryFailure {\\n                Name      = 'Registry'\\n                AuditFlag = 'Failure'\\n                Ensure    = 'Present'\\n            }\\n            AuditPolicySubcategory RemovableStorageSuccess {\\n                Name      = 'Removable Storage'\\n                AuditFlag = 'Success'\\n                Ensure    = 'Present'\\n            }\\n            AuditPolicySubcategory RemovableStorageFailure {\\n                Name      = 'Removable Storage'\\n                AuditFlag = 'Failure'\\n                Ensure    = 'Present'\\n            }\\n            AuditPolicySubcategory CentralAccessPolicyStagingSuccess {\\n                Name      = 'Central Policy Staging'\\n                AuditFlag = 'Success'\\n                Ensure    = 'Absent'\\n            }\\n            AuditPolicySubcategory CentralAccessPolicyStagingFailure {\\n                Name      = 'Central Policy Staging'\\n                AuditFlag = 'Failure'\\n                Ensure    = 'Present'\\n            }\\n            AuditPolicySubcategory AuditPolicyChangeSuccess {\\n                Name      = 'Audit Policy Change'\\n                AuditFlag = 'Success'\\n                Ensure    = 'Present'\\n            }\\n            AuditPolicySubcategory AuditPolicyChangeFailure {\\n                Name      = 'Audit Policy Change'\\n                AuditFlag = 'Failure'\\n                Ensure    = 'Absent'\\n            }\\n            AuditPolicySubcategory AuthenticationPolicyChangeSuccess {\\n                Name      = 'Authentication Policy Change'\\n                AuditFlag = 'Success'\\n                Ensure    = 'Present'\\n            }\\n            AuditPolicySubcategory AuthenticationPolicyChangeFailure {\\n                Name      = 'Authentication Policy Change'\\n                AuditFlag = 'Failure'\\n                Ensure    = 'Absent'\\n            }\\n            AuditPolicySubcategory AuthorizationPolicyChangeSuccess {\\n                Name      = 'Authorization Policy Change'\\n                AuditFlag = 'Success'\\n                Ensure    = 'Present'\\n            }\\n            AuditPolicySubcategory AuthorizationPolicyChangeFailure {\\n                Name      = 'Authorization Policy Change'\\n                AuditFlag = 'Failure'\\n                Ensure    = 'Absent'\\n            }\\n            AuditPolicySubcategory MPSSVCRule-LevelPolicyChangeSuccess {\\n                Name      = 'MPSSVC Rule-Level Policy Change'\\n                AuditFlag = 'Success'\\n                Ensure    = 'Present'\\n            }\\n            AuditPolicySubcategory MPSSVCRule-LevelPolicyChangeFailure {\\n                Name      = 'MPSSVC Rule-Level Policy Change'\\n                AuditFlag = 'Failure'\\n                Ensure    = 'Present'\\n            }\\n            AuditPolicySubcategory OtherPolicyChangeEventsSuccess {\\n                Name      = 'Other Policy Change Events'\\n                AuditFlag = 'Success'\\n                Ensure    = 'Absent'\\n            }\\n            AuditPolicySubcategory OtherPolicyChangeEventsFailure {\\n                Name      = 'Other Policy Change Events'\\n                AuditFlag = 'Failure'\\n                Ensure    = 'Present'\\n            }\\n            AuditPolicySubcategory NonSensitivePrivilegeUseSuccess {\\n                Name      = 'Non Sensitive Privilege Use'\\n                AuditFlag = 'Success'\\n                Ensure    = 'Absent'\\n            }\\n            AuditPolicySubcategory NonSensitivePrivilegeUseFailure {\\n                Name      = 'Non Sensitive Privilege Use'\\n                AuditFlag = 'Failure'\\n                Ensure    = 'Absent'\\n            }\\n            AuditPolicySubcategory OtherPrivilegeUseEventsSuccess {\\n                Name      = 'Other Privilege Use Events'\\n                AuditFlag = 'Success'\\n                Ensure    = 'Absent'\\n            }\\n            AuditPolicySubcategory OtherPrivilegeUseEventsFailure {\\n                Name      = 'Other Privilege Use Events'\\n                AuditFlag = 'Failure'\\n                Ensure    = 'Absent'\\n            }\\n            AuditPolicySubcategory SensitivePrivilegeUseSuccess {\\n                Name      = 'Sensitive Privilege Use'\\n                AuditFlag = 'Success'\\n                Ensure    = 'Present'\\n            }\\n            AuditPolicySubcategory SensitivePrivilegeUseFailure {\\n                Name      = 'Sensitive Privilege Use'\\n                AuditFlag = 'Failure'\\n                Ensure    = 'Present'\\n            }\\n            AuditPolicySubcategory IPsecDriverSuccess {\\n                Name      = 'IPsec Driver'\\n                AuditFlag = 'Success'\\n                Ensure    = 'Present'\\n            }\\n            AuditPolicySubcategory IPsecDriverFailure {\\n                Name      = 'IPsec Driver'\\n                AuditFlag = 'Failure'\\n                Ensure    = 'Present'\\n            }\\n            AuditPolicySubcategory OtherSystemEventsSuccess {\\n                Name      = 'Other System Events'\\n                AuditFlag = 'Success'\\n                Ensure    = 'Present'\\n            }\\n            AuditPolicySubcategory OtherSystemEventsFailure {\\n                Name      = 'Other System Events'\\n                AuditFlag = 'Failure'\\n                Ensure    = 'Present'\\n            }\\n            AuditPolicySubcategory SecurityStateChangeSuccess {\\n                Name      = 'Security State Change'\\n                AuditFlag = 'Success'\\n                Ensure    = 'Present'\\n            }\\n            AuditPolicySubcategory SecurityStateChangeFailure {\\n                Name      = 'Security State Change'\\n                AuditFlag = 'Failure'\\n                Ensure    = 'Absent'\\n            }\\n            AuditPolicySubcategory SecuritySystemExtensionSuccess {\\n                Name      = 'Security System Extension'\\n                AuditFlag = 'Success'\\n                Ensure    = 'Present'\\n            }\\n            AuditPolicySubcategory SecuritySystemExtensionFailure {\\n                Name      = 'Security System Extension'\\n                AuditFlag = 'Failure'\\n                Ensure    = 'Absent'\\n            }\\n            AuditPolicySubcategory SystemIntegritySuccess {\\n                Name      = 'System Integrity'\\n                AuditFlag = 'Success'\\n                Ensure    = 'Present'\\n            }\\n            AuditPolicySubcategory SystemIntegrityFailure {\\n                Name      = 'System Integrity'\\n                AuditFlag = 'Failure'\\n                Ensure    = 'Present'\\n            }\\n            Protocol DisableSSLv3 {\\n                Protocol           = 'SSL 3.0'\\n                IncludeClientSide  = $true\\n                State              = 'Disabled'\\n                #RebootWhenRequired = $true\\n            }\\n            Protocol DisableTLS1 {\\n                Protocol           = 'TLS 1.0' \\n                IncludeClientSide  = $true\\n                State              = 'Disabled'\\n                #RebootWhenRequired = $true\\n            }\\n            Protocol DisableTLS11 {\\n                Protocol           = 'TLS 1.1'\\n                IncludeClientSide  = $true\\n                State              = 'Disabled'\\n                #RebootWhenRequired = $true\\n            }\\n            Protocol EnableTLS12 {\\n                Protocol           = 'TLS 1.2'\\n                IncludeClientSide  = $true\\n                State              = 'Enabled'\\n                #RebootWhenRequired = $true\\n            }\\n            Protocol EnableTLS13 {\\n                Protocol           = 'TLS 1.3'\\n                IncludeClientSide  = $true\\n                State              = 'Enabled'\\n                #RebootWhenRequired = $true\\n            }    \\n            Cipher DisableRC4-40 {\\n                Cipher             = 'RC4 40/128'\\n                State              = 'Disabled'\\n                #RebootWhenRequired = $true\\n            }\\n            Cipher DisableRC4-56 {\\n                Cipher             = 'RC4 56/128'\\n                State              = 'Disabled'\\n                #RebootWhenRequired = $true\\n            }\\n            Cipher DisableRC4-64 {\\n                Cipher             = 'RC4 64/128'\\n                State              = 'Disabled'\\n                #RebootWhenRequired = $true\\n            }\\n            Cipher DisableRC4-128 {\\n                Cipher             = 'RC4 128/128'\\n                State              = 'Disabled'\\n                #RebootWhenRequired = $true\\n            }\\n            Cipher Disable3Des {\\n                Cipher             = 'Triple DES 168'\\n                State              = 'Disabled'\\n                #RebootWhenRequired = $true\\n            }\\n            Cipher EnableAES128 {\\n                Cipher             = 'AES 128/128'\\n                State              = 'Enabled'\\n                #RebootWhenRequired = $true\\n            }\\n            Cipher EnableAES256 {\\n                Cipher             = 'AES 256/256'\\n                State              = 'Enabled'\\n                #RebootWhenRequired = $true\\n            }\\n            CipherSuites 3DESCipher {\\n                IsSingleInstance   = 'Yes'\\n                CipherSuitesOrder  = 'TLS_RSA_WITH_3DES_EDE_CBC_SHA'\\n                Ensure             = 'Absent'\\n                #RebootWhenRequired = $true\\n            }\\n            SChannelSettings 'ConfigureSChannel' {\\n                IsSingleInstance              = 'Yes'\\n                TLS12State                    = 'Enabled'\\n                WinHttpDefaultSecureProtocols = @('TLS1.2')\\n                #RebootWhenRequired            = $true\\n            }\\n            If ($ServerRole -eq 'DomainController') {\\n                AuditPolicySubcategory KerberosAuthenticationServiceSuccess {\\n                    Name = 'Kerberos Authentication Service'\\n                    AuditFlag = 'Success'\\n                    Ensure = 'Present'\\n                }\\n                AuditPolicySubcategory KerberosAuthenticationServiceFailure {\\n                    Name = 'Kerberos Authentication Service'\\n                    AuditFlag = 'Failure'\\n                    Ensure = 'Present'\\n                }\\n                AuditPolicySubcategory KerberosServiceTicketOperationsSuccess {\\n                    Name = 'Kerberos Service Ticket Operations'\\n                    AuditFlag = 'Success'\\n                    Ensure = 'Present'\\n                }\\n                AuditPolicySubcategory KerberosServiceTicketOperationsFailure {\\n                    Name = 'Kerberos Service Ticket Operations'\\n                    AuditFlag = 'Failure'\\n                    Ensure = 'Present'\\n                }\\n                AuditPolicySubcategory ComputerAccountManagementSuccess {\\n                    Name = 'Computer Account Management'\\n                    AuditFlag = 'Success'\\n                    Ensure = 'Present'\\n                }\\n                AuditPolicySubcategory DistributionGroupManagementSuccess {\\n                    Name = 'Distribution Group Management'\\n                    AuditFlag = 'Success'\\n                    Ensure = 'Present'\\n                }\\n                AuditPolicySubcategory DetailedDirectoryServiceReplicationSuccess {\\n                    Name = 'Detailed Directory Service Replication'\\n                    AuditFlag = 'Success'\\n                    Ensure = 'Present'\\n                }\\n                AuditPolicySubcategory DetailedDirectoryServiceReplicationFailure {\\n                    Name = 'Detailed Directory Service Replication'\\n                    AuditFlag = 'Failure'\\n                    Ensure = 'Present'\\n                }\\n                AuditPolicySubcategory DirectoryServiceAccessFailure {\\n                    Name = 'Directory Service Access'\\n                    AuditFlag = 'Failure'\\n                    Ensure = 'Present'\\n                }\\n                AuditPolicySubcategory DirectoryServiceChangesSuccess {\\n                    Name = 'Directory Service Changes'\\n                    AuditFlag = 'Success'\\n                    Ensure = 'Present'\\n                }\\n                AuditPolicySubcategory DirectoryServiceReplicationSuccess {\\n                    Name = 'Directory Service Replication'\\n                    AuditFlag = 'Success'\\n                    Ensure = 'Present'\\n                }\\n                AuditPolicySubcategory DirectoryServiceReplicationFailure {\\n                    Name = 'Directory Service Replication'\\n                    AuditFlag = 'Failure'\\n                    Ensure = 'Present'\\n                }\\n                \\n                AuditPolicySubcategory DetailedFileShareSuccess {\\n                    Name = 'Detailed File Share'\\n                    AuditFlag = 'Success'\\n                    Ensure = 'Absent'\\n                }\\n            } Else {\\n                AuditPolicySubcategory KerberosAuthenticationServiceSuccess {\\n                    Name = 'Kerberos Authentication Service'\\n                    AuditFlag = 'Success'\\n                    Ensure = 'Absent'\\n                }\\n                AuditPolicySubcategory KerberosAuthenticationServiceFailure {\\n                    Name = 'Kerberos Authentication Service'\\n                    AuditFlag = 'Failure'\\n                    Ensure = 'Absent'\\n                }\\n                AuditPolicySubcategory KerberosServiceTicketOperationsSuccess {\\n                    Name = 'Kerberos Service Ticket Operations'\\n                    AuditFlag = 'Success'\\n                    Ensure = 'Absent'\\n                }\\n                AuditPolicySubcategory KerberosServiceTicketOperationsFailure {\\n                    Name = 'Kerberos Service Ticket Operations'\\n                    AuditFlag = 'Failure'\\n                    Ensure = 'Absent'\\n                }\\n                AuditPolicySubcategory ComputerAccountManagementSuccess {\\n                    Name = 'Computer Account Management'\\n                    AuditFlag = 'Success'\\n                    Ensure = 'Absent'\\n                }\\n                AuditPolicySubcategory DistributionGroupManagementSuccess {\\n                    Name = 'Distribution Group Management'\\n                    AuditFlag = 'Success'\\n                    Ensure = 'Absent'\\n                }\\n                AuditPolicySubcategory DetailedDirectoryServiceReplicationSuccess {\\n                    Name = 'Detailed Directory Service Replication'\\n                    AuditFlag = 'Success'\\n                    Ensure = 'Absent'\\n                }\\n                AuditPolicySubcategory DetailedDirectoryServiceReplicationFailure {\\n                    Name = 'Detailed Directory Service Replication'\\n                    AuditFlag = 'Failure'\\n                    Ensure = 'Absent'\\n                }\\n                AuditPolicySubcategory DirectoryServiceAccessFailure {\\n                    Name = 'Directory Service Access'\\n                    AuditFlag = 'Failure'\\n                    Ensure = 'Absent'\\n                }\\n                AuditPolicySubcategory DirectoryServiceChangesSuccess {\\n                    Name = 'Directory Service Changes'\\n                    AuditFlag = 'Success'\\n                    Ensure = 'Absent'\\n                }\\n                AuditPolicySubcategory DirectoryServiceReplicationSuccess {\\n                    Name = 'Directory Service Replication'\\n                    AuditFlag = 'Success'\\n                    Ensure = 'Absent'\\n                }\\n                AuditPolicySubcategory DirectoryServiceReplicationFailure {\\n                    Name = 'Directory Service Replication'\\n                    AuditFlag = 'Failure'\\n                    Ensure = 'Absent'\\n                }\\n                AuditPolicySubcategory DetailedFileShareSuccess {\\n                    Name = 'Detailed File Share'\\n                    AuditFlag = 'Success'\\n                    Ensure = 'Present'\\n                }\\n            }\\n            If ($ServerRole -eq 'CertificateAuthority') {\\n                AuditPolicySubcategory CertificationServicesSuccess {\\n                    Name = 'Certification Services'\\n                    AuditFlag = 'Success'\\n                    Ensure = 'Present'\\n                }\\n                AuditPolicySubcategory CertificationServicesFailure {\\n                    Name = 'Certification Services'\\n                    AuditFlag = 'Failure'\\n                    Ensure = 'Present'\\n                }    \\n            } Else { \\n                AuditPolicySubcategory CertificationServicesSuccess {\\n                    Name = 'Certification Services'\\n                    AuditFlag = 'Success'\\n                    Ensure = 'Absent'\\n                }\\n                AuditPolicySubcategory CertificationServicesFailure {\\n                    Name = 'Certification Services'\\n                    AuditFlag = 'Failure'\\n                    Ensure = 'Absent'\\n                }\\n            }\\n        }\\n    }\\n    Write-Output 'Generating MOF file'\\n    $Null = ConfigInstance -OutputPath 'C:\\\\Temp\\\\AuditConfigInstance' -ConfigurationData $ConfigurationData\\n}\\n\\nFunction Invoke-DscStatusCheck {\\n    $LCMState = Get-DscLocalConfigurationManager -ErrorAction SilentlyContinue | Select-Object -ExpandProperty 'LCMState'\\n    If ($LCMState -eq 'PendingConfiguration' -Or $LCMState -eq 'PendingReboot') {\\n        Exit 3010\\n    } Else {\\n        Write-Output 'DSC Config Completed'\\n    }\\n}\\n\\n$AuditConfigPresent = Test-Path -Path 'C:\\\\Temp\\\\AuditConfigInstance'\\nSet-DscConfiguration -ServerRole '{{ServerRole}}'\\n\\nIf ($AuditConfigPresent) {\\n    Start-DscConfiguration -UseExisting -Wait -Verbose -Force\\n} Else {\\n    Start-DscConfiguration 'C:\\\\Temp\\\\AuditConfigInstance' -Wait -Verbose -Force\\n}\\n\\nInvoke-DscStatusCheck\\n\\nTry {\\n    $Version = (Invoke-WebRequest 'https://s3-us-west-2.amazonaws.com/kinesis-agent-windows/downloads/packages.json' -Headers @{\\\"Accept\\\"=\\\"application/json\\\"} -UseBasicParsing | Select-Object -ExpandProperty 'Content' | ConvertFrom-Json | Select-Object -ExpandProperty 'Packages').Version[0]\\n} Catch [System.Exception] {\\n    Write-Output \\\"Failed to get latest KTAP version $_\\\"\\n    Exit 1\\n}\\n\\n(New-Object -TypeName 'System.Net.WebClient').DownloadFile(\\\"https://s3-us-west-2.amazonaws.com/kinesis-agent-windows/downloads/AWSKinesisTap.$Version.msi\\\", 'C:\\\\Temp\\\\AWSKinesisTap.msi')\\n\\nWrite-Output 'Installing KinesisTap'\\n$Process = Start-Process -FilePath 'msiexec.exe' -ArgumentList '/I C:\\\\Temp\\\\AWSKinesisTap.msi /quiet /l C:\\\\Temp\\\\ktap-install-log.txt' -NoNewWindow -PassThru -Wait -ErrorAction Stop\\n\\nIf ($Process.ExitCode -ne 0) {\\n    Write-Output \\\"Error installing KinesisTap -exit code $($Process.ExitCode)\\\"\\n    Exit 1\\n}\\n\\nIf ($ServerRole -eq 'DomainController') {\\n    $DcCategories = @(\\n        @{\\n            'Category' = 'ADWS'\\n            'Counters' = @(\\n                @{\\n                    'Counter' = 'Active Web Service Sessions'\\n                    'Unit'    = 'Count'\\n                },\\n                @{\\n                    'Counter' = 'ChangePassword Operations Per Second'\\n                    'Unit'    = 'Count/Second'\\n                }\\n                @{\\n                    'Counter' = 'Delete Operations Per Second'\\n                    'Unit'    = 'Count/Second'\\n                },\\n                @{\\n                    'Counter' = 'SetPassword Operations Per Second'\\n                    'Unit'    = 'Count/Second'\\n                }\\n            )\\n        },\\n        @{\\n            'Category'  = 'Database ==\u003e Instances'\\n            'Instances' = 'NTDSA'\\n            'Counters'  = @(\\n                @{\\n                    'Counter' = 'Database Cache % Hit'\\n                    'Unit'    = 'Percent'\\n                },\\n                @{\\n                    'Counter' = 'Database Cache Size (MB)'\\n                    'Unit'    = 'Megabytes'\\n                },\\n                @{\\n                    'Counter' = 'I/O Database Reads Average Latency'\\n                    'Unit'    = 'Milliseconds'\\n                },\\n                @{\\n                    'Counter' = 'I/O Database Reads/sec'\\n                    'Unit'    = 'Count/Second'\\n                },\\n                @{\\n                    'Counter' = 'I/O Log Writes Average Latency'\\n                    'Unit'    = 'Milliseconds'\\n                },\\n                @{\\n                    'Counter' = 'I/O Database Writes/sec'\\n                    'Unit'    = 'Count/Second'\\n                }\\n            )\\n        },\\n        @{\\n            'Category'  = 'DFS Replication Service Volumes'\\n            'Instances' = '*'\\n            'Counters'  = @(\\n                @{\\n                    'Counter' = 'USN Journal Unread Percentage'\\n                    'Unit'    = 'Percent'\\n                }\\n            )\\n        },\\n        @{\\n            'Category' = 'DNS'\\n            'Counters' = @(\\n                @{\\n                    'Counter' = 'Dynamic Update Rejected'\\n                    'Unit'    = 'Count'\\n                },\\n                @{\\n                    'Counter' = 'Recursive Queries/sec'\\n                    'Unit'    = 'Count/Second'\\n                },\\n                @{\\n                    'Counter' = 'Recursive Query Failure/sec'\\n                    'Unit'    = 'Count/Second'\\n                },\\n                @{\\n                    'Counter' = 'Secure Update Failure'\\n                    'Unit'    = 'Count'\\n                },\\n                @{\\n                    'Counter' = 'TCP Query Received/sec'\\n                    'Unit'    = 'Count/Second'\\n                },\\n                @{\\n                    'Counter' = 'Total Query Received/sec'\\n                    'Unit'    = 'Count/Second'\\n                },\\n                @{\\n                    'Counter' = 'Total Response Sent/sec'\\n                    'Unit'    = 'Count/Second'\\n                },\\n                @{\\n                    'Counter' = 'UDP Query Received/sec'\\n                    'Unit'    = 'Count/Second'\\n                }\\n            )\\n        },\\n        @{\\n            'Category' = 'NTDS'\\n            'Counters' = @(\\n                @{\\n                    'Counter' = 'ATQ Estimated Queue Delay'\\n                    'Unit'    = 'Milliseconds'\\n                },\\n                @{\\n                    'Counter' = 'ATQ Request Latency'\\n                    'Unit'    = 'Milliseconds'\\n                },\\n                @{\\n                    'Counter' = 'DRA Pending Replication Operations'\\n                    'Unit'    = 'Count'\\n                },\\n                @{\\n                    'Counter' = 'DRA Pending Replication Synchronizations'\\n                    'Unit'    = 'Count'\\n                },\\n                @{\\n                    'Counter' = 'DS Directory Reads/Sec'\\n                    'Unit'    = 'Count/Second'\\n                },\\n                @{\\n                    'Counter' = 'DS Directory Searches/Sec'\\n                    'Unit'    = 'Count/Second'\\n                },\\n                @{\\n                    'Counter' = 'DS Directory Writes/Sec'\\n                    'Unit'    = 'Count/Second'\\n                },\\n                @{\\n                    'Counter' = 'LDAP Bind Time'\\n                    'Unit'    = 'Milliseconds'\\n                },\\n                @{\\n                    'Counter' = 'LDAP Client Sessions'\\n                    'Unit'    = 'Count'\\n                },\\n                @{\\n                    'Counter' = 'LDAP Searches/sec'\\n                    'Unit'    = 'Count/Second'\\n                },\\n                @{\\n                    'Counter' = 'LDAP Successful Binds/sec'\\n                    'Unit'    = 'Count/Second'\\n                }\\n            )\\n        },\\n        @{\\n            'Category' = 'Security System-Wide Statistics'\\n            'Counters' = @(\\n                @{\\n                    'Counter' = 'Kerberos Authentications'\\n                    'Unit'    = 'Count/Second'\\n                },\\n                @{\\n                    'Counter' = 'NTLM Authentications'\\n                    'Unit'    = 'Count/Second'\\n                }\\n            )\\n        }\\n    )\\n\\n    $DcSources = @(\\n        @{\\n            'Id'         = 'DFSReplicationLog'\\n            'SourceType' = 'WindowsEventLogSource'\\n            'LogName'    = 'DFS Replication'\\n        },\\n        @{\\n            'Id'         = 'DirectoryServiceLog'\\n            'SourceType' = 'WindowsEventLogSource'\\n            'LogName'    = 'Directory Service'\\n        },\\n        @{\\n            'Id'         = 'DNSServerLog'\\n            'SourceType' = 'WindowsEventLogSource'\\n            'LogName'    = 'DNS Server'\\n        },\\n        @{\\n            'Id'         = 'DNSServerAuditLog'\\n            'SourceType' = 'WindowsEventLogSource'\\n            'LogName'    = 'Microsoft-Windows-DNSServer/Audit'\\n        },\\n        @{\\n            'Id'         = 'KerberosOperationalLog'\\n            'SourceType' = 'WindowsEventLogSource'\\n            'LogName'    = 'Microsoft-Windows-Kerberos/Operational'\\n        },\\n        @{\\n            'Id'         = 'Kerberos-Key-Distribution-CenterOperationalLog'\\n            'SourceType' = 'WindowsEventLogSource'\\n            'LogName'    = 'Microsoft-Windows-Kerberos-Key-Distribution-Center/Operational'\\n        },\\n        @{\\n            'Id'         = 'NTLMOperationalLog'\\n            'SourceType' = 'WindowsEventLogSource'\\n            'LogName'    = 'Microsoft-Windows-NTLM/Operational'\\n        },\\n        @{\\n            'Id'         = 'Security-NetlogonOperationalLog'\\n            'SourceType' = 'WindowsEventLogSource'\\n            'LogName'    = 'Microsoft-Windows-Security-Netlogon/Operational'\\n        },\\n        @{\\n            'Id'             = 'DNSLogs'\\n            'SourceType'     = 'DirectorySource'\\n            'Directory'      = 'C:\\\\DnsLogs'\\n            'FileNameFilter' = '*.log|*.txt'\\n            'RecordParser'   = 'SingleLine'\\n        }\\n    )\\n\\n    $DcSinks = @(\\n        @{\\n            'Id'             = 'DFSReplicationLog-CloudWatchLogsSink'\\n            'SinkType'       = 'CloudWatchLogs'\\n            'BufferInterval' = '60'\\n            'LogGroup'       = '{ComputerName}-Log-Group'\\n            'LogStream'      = 'DFSReplicationLog-Stream'\\n            'Region'         = 'ReplaceMe'\\n            'Format'         = 'json'\\n        },\\n        @{\\n            'Id'             = 'DirectoryServiceLog-CloudWatchLogsSink'\\n            'SinkType'       = 'CloudWatchLogs'\\n            'BufferInterval' = '60'\\n            'LogGroup'       = '{ComputerName}-Log-Group'\\n            'LogStream'      = 'DirectoryServiceLog-Stream'\\n            'Region'         = 'ReplaceMe'\\n            'Format'         = 'json'\\n        },\\n        @{\\n            'Id'             = 'DNSServerLog-CloudWatchLogsSink'\\n            'SinkType'       = 'CloudWatchLogs'\\n            'BufferInterval' = '60'\\n            'LogGroup'       = '{ComputerName}-Log-Group'\\n            'LogStream'      = 'DNSServerLog-Stream'\\n            'Region'         = 'ReplaceMe'\\n            'Format'         = 'json'\\n        },\\n        @{\\n            'Id'             = 'DNSServerAuditLog-CloudWatchLogsSink'\\n            'SinkType'       = 'CloudWatchLogs'\\n            'BufferInterval' = '60'\\n            'LogGroup'       = '{ComputerName}-Log-Group'\\n            'LogStream'      = 'DNSServerAuditLog-Stream'\\n            'Region'         = 'ReplaceMe'\\n            'Format'         = 'json'\\n        },\\n        @{\\n            'Id'             = 'KerberosOperationalLog-CloudWatchLogsSink'\\n            'SinkType'       = 'CloudWatchLogs'\\n            'BufferInterval' = '60'\\n            'LogGroup'       = '{ComputerName}-Log-Group'\\n            'LogStream'      = 'KerberosOperationalLog-Stream'\\n            'Region'         = 'ReplaceMe'\\n            'Format'         = 'json'\\n        },\\n        @{\\n            'Id'             = 'Kerberos-Key-Distribution-CenterOperationalLog-CloudWatchLogsSink'\\n            'SinkType'       = 'CloudWatchLogs'\\n            'BufferInterval' = '60'\\n            'LogGroup'       = '{ComputerName}-Log-Group'\\n            'LogStream'      = 'Kerberos-Key-Distribution-CenterOperationalLog-Stream'\\n            'Region'         = 'ReplaceMe'\\n            'Format'         = 'json'\\n        },\\n        @{\\n            'Id'             = 'NTLMOperationalLog-CloudWatchLogsSink'\\n            'SinkType'       = 'CloudWatchLogs'\\n            'BufferInterval' = '60'\\n            'LogGroup'       = '{ComputerName}-Log-Group'\\n            'LogStream'      = 'NTLMOperationalLog-Stream'\\n            'Region'         = 'ReplaceMe'\\n            'Format'         = 'json'\\n        },\\n        @{\\n            'Id'             = 'Security-NetlogonOperationalLog-CloudWatchLogsSink'\\n            'SinkType'       = 'CloudWatchLogs'\\n            'BufferInterval' = '60'\\n            'LogGroup'       = '{ComputerName}-Log-Group'\\n            'LogStream'      = 'Security-NetlogonOperationalLog-Stream'\\n            'Region'         = 'ReplaceMe'\\n            'Format'         = 'json'\\n        },\\n        @{\\n            'Id'             = 'DNSLogs-CloudWatchLogsSink'\\n            'SinkType'       = 'CloudWatchLogs'\\n            'BufferInterval' = '60'\\n            'LogGroup'       = '{ComputerName}-Log-Group'\\n            'LogStream'      = 'DNSLogs-Stream'\\n            'Region'         = 'ReplaceMe'\\n            'Format'         = 'json'\\n        }\\n    )\\n\\n    $DcPipes = @(\\n        @{\\n            'Id'        = 'DFSReplicationLogToCloudWatch'\\n            'SourceRef' = 'DFSReplicationLog'\\n            'SinkRef'   = 'DFSReplicationLog-CloudWatchLogsSink'\\n        },\\n        @{\\n            'Id'        = 'DirectoryServiceLogToCloudWatch'\\n            'SourceRef' = 'DirectoryServiceLog'\\n            'SinkRef'   = 'DirectoryServiceLog-CloudWatchLogsSink'\\n        },\\n        @{\\n            'Id'        = 'DNSServerLogToCloudWatch'\\n            'SourceRef' = 'DNSServerLog'\\n            'SinkRef'   = 'DNSServerLog-CloudWatchLogsSink'\\n        },\\n        @{\\n            'Id'        = 'DNSServerAuditLogToCloudWatch'\\n            'SourceRef' = 'DNSServerAuditLog'\\n            'SinkRef'   = 'DNSServerAuditLog-CloudWatchLogsSink'\\n        },\\n        @{\\n            'Id'        = 'KerberosOperationalLogToCloudWatch'\\n            'SourceRef' = 'KerberosOperationalLog'\\n            'SinkRef'   = 'KerberosOperationalLog-CloudWatchLogsSink'\\n        },\\n        @{\\n            'Id'        = 'Kerberos-Key-Distribution-CenterOperationalLogToCloudWatch'\\n            'SourceRef' = 'Kerberos-Key-Distribution-CenterOperationalLog'\\n            'SinkRef'   = 'Kerberos-Key-Distribution-CenterOperationalLog-CloudWatchLogsSink'\\n        },\\n        @{\\n            'Id'        = 'NTLMOperationalLogToCloudWatch'\\n            'SourceRef' = 'NTLMOperationalLog'\\n            'SinkRef'   = 'NTLMOperationalLog-CloudWatchLogsSink'\\n        },\\n        @{\\n            'Id'        = 'Security-NetlogonOperationalLogToCloudWatch'\\n            'SourceRef' = 'Security-NetlogonOperationalLog'\\n            'SinkRef'   = 'Security-NetlogonOperationalLog-CloudWatchLogsSink'\\n        },\\n        @{\\n            'Id'        = 'DNSLogsToCloudWatch'\\n            'SourceRef' = 'DNSLogs'\\n            'SinkRef'   = 'DNSLogs-CloudWatchLogsSink'\\n        }\\n    )\\n}\\n\\nIf ($ServerRole -eq 'CertificateAuthority') {\\n    $CaCategories = @(\\n        @{\\n            'Category'  = 'Certification Authority'\\n            'Instances' = '*'\\n            'Counters'  = @(\\n                @{\\n                    'Counter' = 'Failed Request/sec'\\n                    'Unit'    = 'Count/Second'\\n                },\\n                @{\\n                    'Counter' = 'Request/sec'\\n                    'Unit'    = 'Count/Second'\\n                },\\n                @{\\n                    'Counter' = 'Request processing time (ms)'\\n                    'Unit'    = 'Milliseconds'\\n                }\\n            )\\n        },\\n        @{\\n            'Category'  = 'Certification Authority Connections'\\n            'Instances' = '*'\\n            'Counters'  = @(\\n                @{\\n                    'Counter' = 'Active connections'\\n                    'Unit'    = 'Count'\\n                }\\n            )\\n        }\\n    )\\n}\\n\\n$KenesisAgentSettings = @{\\n    'Sources'    = @(\\n        @{\\n            'Id'         = 'PerformanceCounter'\\n            'SourceType' = 'WindowsPerformanceCounterSource'\\n            'Categories' = @(\\n                @{\\n                    'Category'  = 'ENA Packets Shaping'\\n                    'Instances' = 'ENA #1'\\n                    'Counters'  = @(\\n                        @{\\n                            'Counter' = 'Aggregate inbound BW allowance exceeded'\\n                            'Unit'    = 'Count'\\n                        },\\n                        @{\\n                            'Counter' = 'Aggregate outbound BW allowance exceeded'\\n                            'Unit'    = 'Count'\\n                        },\\n                        @{\\n                            'Counter' = 'Connection tracking allowance exceeded'\\n                            'Unit'    = 'Count'\\n                        },\\n                        @{\\n                            'Counter' = 'Link local packet rate allowance exceeded'\\n                            'Unit'    = 'Count'\\n                        },\\n                        @{\\n                            'Counter' = 'PPS allowance exceeded'\\n                            'Unit'    = 'Count'\\n                        }\\n                    )\\n                },\\n                @{\\n                    'Category'  = 'LogicalDisk'\\n                    'Instances' = 'D:'\\n                    'Counters'  = @(\\n                        @{\\n                            'Counter' = '% Free Space'\\n                            'Unit'    = 'Percent'\\n                        },\\n                        @{\\n                            'Counter' = 'Avg. Disk Queue Length'\\n                            'Unit'    = 'Count'\\n                        }\\n                    )\\n                },\\n                @{\\n                    'Category'  = 'LogicalDisk'\\n                    'Instances' = 'C:'\\n                    'Counters'  = @(\\n                        @{\\n                            'Counter' = '% Free Space'\\n                            'Unit'    = 'Percent'\\n                        },\\n                        @{\\n                            'Counter' = 'Avg. Disk Queue Length'\\n                            'Unit'    = 'Count'\\n                        }\\n                    )\\n                },\\n                @{\\n                    'Category' = 'Memory'\\n                    'Counters' = @(\\n                        @{\\n                            'Counter' = '% Committed Bytes in Use'\\n                            'Unit'    = 'Percent'\\n                        },\\n                        @{\\n                            'Counter' = 'Available MBytes'\\n                            'Unit'    = 'Megabytes'\\n                        },\\n                        @{\\n                            'Counter' = 'Long-Term Average Standby Cache Lifetime (s)'\\n                            'Unit'    = 'Seconds'\\n                        }\\n                    )\\n                },\\n                @{\\n                    'Category'  = 'Network Interface'\\n                    'Instances' = 'Amazon Elastic Network Adapter'\\n                    'Counters'  = @(\\n                        @{\\n                            'Counter' = 'Bytes Received/sec'\\n                            'Unit'    = 'Count/Second'\\n                        },\\n                        @{\\n                            'Counter' = 'Bytes Sent/sec'\\n                            'Unit'    = 'Count/Second'\\n                        },\\n                        @{\\n                            'Counter' = 'Current Bandwidth'\\n                            'Unit'    = 'Bits/Second'\\n                        }\\n                    )\\n                },\\n                @{\\n                    'Category'  = 'PhysicalDisk'\\n                    'Instances' = '0 C:'\\n                    'Counters'  = @(\\n                        @{\\n                            'Counter' = 'Avg. Disk Queue Length'\\n                            'Unit'    = 'Count'\\n                        }\\n                    )\\n                },\\n                @{\\n                    'Category'  = 'PhysicalDisk'\\n                    'Instances' = '1 D:'\\n                    'Counters'  = @(\\n                        @{\\n                            'Counter' = 'Avg. Disk Queue Length'\\n                            'Unit'    = 'Count'\\n                        }\\n                    )\\n                },\\n                @{\\n                    'Category'  = 'Processor'\\n                    'Instances' = '*'\\n                    'Counters'  = @(\\n                        @{\\n                            'Counter' = '% Processor Time'\\n                            'Unit'    = 'Percent'\\n                        }\\n                    )\\n                }\\n                $DcCategories\\n                $CaCategories\\n            )\\n        },\\n        @{\\n            'Id'         = 'ApplicationLog'\\n            'SourceType' = 'WindowsEventLogSource'\\n            'LogName'    = 'Application'\\n        },\\n        @{\\n            'Id'         = 'SecurityLog'\\n            'SourceType' = 'WindowsEventLogSource'\\n            'LogName'    = 'Security'\\n        },\\n        @{\\n            'Id'         = 'SystemLog'\\n            'SourceType' = 'WindowsEventLogSource'\\n            'LogName'    = 'System'\\n        },\\n        @{\\n            'Id'         = 'CertificateServicesClient-Lifecycle-SystemOperationalLog'\\n            'SourceType' = 'WindowsEventLogSource'\\n            'LogName'    = 'Microsoft-Windows-CertificateServicesClient-Lifecycle-System/Operational'\\n        }\\n        $DcSources\\n    )\\n    'Sinks'      = @(\\n        @{\\n            'Namespace' = 'EC2-Domain-Member-Metrics'\\n            'Region'    = 'ReplaceMe'\\n            'Id'        = 'CloudWatchSink'\\n            'Interval'  = '60'\\n            'SinkType'  = 'CloudWatch'\\n        },\\n        @{\\n            'Id'             = 'ApplicationLog-CloudWatchLogsSink'\\n            'SinkType'       = 'CloudWatchLogs'\\n            'BufferInterval' = '60'\\n            'LogGroup'       = '{ComputerName}-Log-Group'\\n            'LogStream'      = 'ApplicationLog-Stream'\\n            'Region'         = 'ReplaceMe'\\n            'Format'         = 'json'\\n        },\\n        @{\\n            'Id'             = 'SecurityLog-CloudWatchLogsSink'\\n            'SinkType'       = 'CloudWatchLogs'\\n            'BufferInterval' = '60'\\n            'LogGroup'       = '{ComputerName}-Log-Group'\\n            'LogStream'      = 'SecurityLog-Stream'\\n            'Region'         = 'ReplaceMe'\\n            'Format'         = 'json'\\n        },\\n        @{\\n            'Id'             = 'SystemLog-CloudWatchLogsSink'\\n            'SinkType'       = 'CloudWatchLogs'\\n            'BufferInterval' = '60'\\n            'LogGroup'       = '{ComputerName}-Log-Group'\\n            'LogStream'      = 'SystemLog-Stream'\\n            'Region'         = 'ReplaceMe'\\n            'Format'         = 'json'\\n        },\\n        @{\\n            'Id'             = 'CertificateServicesClient-Lifecycle-SystemOperationalLog-CloudWatchLogsSink'\\n            'SinkType'       = 'CloudWatchLogs'\\n            'BufferInterval' = '60'\\n            'LogGroup'       = '{ComputerName}-Log-Group'\\n            'LogStream'      = 'CertificateServicesClient-Lifecycle-SystemOperationalLog-Stream'\\n            'Region'         = 'ReplaceMe'\\n            'Format'         = 'json'\\n        }\\n        $DcSinks\\n    )\\n    'Pipes'      = @(\\n        @{\\n            'Id'        = 'PerformanceCounterToCloudWatch'\\n            'SourceRef' = 'PerformanceCounter'\\n            'SinkRef'   = 'CloudWatchSink'\\n        },\\n        @{\\n            'Id'        = 'ApplicationLogToCloudWatch'\\n            'SourceRef' = 'ApplicationLog'\\n            'SinkRef'   = 'ApplicationLog-CloudWatchLogsSink'\\n        },\\n        @{\\n            'Id'        = 'SecurityLogToCloudWatch'\\n            'SourceRef' = 'SecurityLog'\\n            'SinkRef'   = 'SecurityLog-CloudWatchLogsSink'\\n        },\\n        @{\\n            'Id'        = 'SystemLogToCloudWatch'\\n            'SourceRef' = 'SystemLog'\\n            'SinkRef'   = 'SystemLog-CloudWatchLogsSink'\\n        },\\n        @{\\n            'Id'        = 'CertificateServicesClient-Lifecycle-SystemOperationalLogToCloudWatch'\\n            'SourceRef' = 'CertificateServicesClient-Lifecycle-SystemOperationalLog'\\n            'SinkRef'   = 'CertificateServicesClient-Lifecycle-SystemOperationalLog-CloudWatchLogsSink'\\n        }\\n        $DcPipes\\n    )\\n    'SelfUpdate' = 0\\n}\\n\\nWrite-Output 'Getting region'\\nTry {\\n    [string]$Token = Invoke-RestMethod -Headers @{'X-aws-ec2-metadata-token-ttl-seconds' = '3600' } -Method 'PUT' -Uri 'http://169.254.169.254/latest/api/token' -UseBasicParsing -ErrorAction Stop\\n    $Region = (Invoke-RestMethod -Headers @{'X-aws-ec2-metadata-token' = $Token } -Method 'GET' -Uri 'http://169.254.169.254/latest/dynamic/instance-identity/document' -UseBasicParsing -ErrorAction Stop | Select-Object -ExpandProperty 'Region').ToUpper()\\n} Catch [System.Exception] {\\n    Write-Output \\\"Failed to get region $_\\\"\\n    Exit 1\\n}\\n\\n$KenesisAgentSettings.Sinks | Where-Object { $_.Region -eq 'ReplaceMe' } | ForEach-Object { $_.Region = $Region }\\n\\nWrite-Output 'Exporting appsettings.json content'\\nTry {\\n    $KenesisAgentSettings | ConvertTo-Json -Depth 10 -ErrorAction Stop | Out-File 'C:\\\\Program Files\\\\Amazon\\\\AWSKinesisTap\\\\appsettings.json' -Encoding 'ascii' -ErrorAction Stop\\n} Catch [System.Exception] {\\n    Write-Output \\\"Unable to export appsettings.json $_\\\"\\n    Exit 1\\n}\\n\\nWrite-Output 'Restarting AWSKinesisTap service'\\nTry {\\n    Restart-Service 'AWSKinesisTap' -Force\\n} Catch [System.Exception] {\\n    Write-Output \\\"Unable to restart AWSKinesisTap $_\\\"\\n    Exit 1\\n}\\n\\nInvoke-Cleanup -VPCCIDR '{{VPCCIDR}}'\"\r\n      },\r\n      \"CloudWatchOutputConfig\" : {\r\n        \"CloudWatchOutputEnabled\" : true,\r\n        \"CloudWatchLogGroupName\" : \"/aws/Demo/{{StackName}}\"\r\n      },\r\n      \"InstanceIds\" : [ \"{{InstanceId.InstanceId}}\" ],\r\n      \"DocumentName\" : \"AWS-RunPowerShellScript\"\r\n    },\r\n    \"name\" : \"configureInstance\",\r\n    \"action\" : \"aws:runCommand\"\r\n  } ]\r\n}\r\n",
            "created_date": "2022-07-12T02:29:26Z",
            "default_version": "1",
            "description": "Configure Kinesis Agent for Windows, Windows Auditing Policy, and deployment cleanup using SSM Automation",
            "document_format": "JSON",
            "document_type": "Automation",
            "document_version": "1",
            "hash": "2c27bcbd24559647790ac87d16eaeb85ff629c114c42e5d7bd94c701cd10dd18",
            "hash_type": "Sha256",
            "id": "SSM-AuditPol-dnb6z912",
            "latest_version": "1",
            "name": "SSM-AuditPol-dnb6z912",
            "owner": "156285977455",
            "parameter": [
              {
                "default_value": "",
                "description": "NetBIOS name of the first Active Directory Domain Controller (up to 15 characters)",
                "name": "ServerNetBIOSName",
                "type": "String"
              },
              {
                "default_value": "",
                "description": "Role server will be (DomainController or CertificateAuthority)",
                "name": "ServerRole",
                "type": "String"
              },
              {
                "default_value": "",
                "description": "CIDR Block for the VPC",
                "name": "VPCCIDR",
                "type": "String"
              },
              {
                "default_value": "",
                "description": "Stack Name Input for cfn resource signal",
                "name": "StackName",
                "type": "String"
              }
            ],
            "permissions": null,
            "platform_types": [
              "Windows",
              "Linux",
              "MacOS"
            ],
            "schema_version": "0.3",
            "status": "Active",
            "tags": null,
            "tags_all": {},
            "target_type": "",
            "version_name": ""
          },
          "sensitive_attributes": [],
          "private": "bnVsbA==",
          "dependencies": [
            "random_string.random_string"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_ssm_document",
      "name": "ssm_baseline",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "arn": "arn:aws:ssm:us-east-2:156285977455:document/SSM-Baseline-dnb6z912",
            "attachments_source": [],
            "content": "{\r\n  \"schemaVersion\" : \"0.3\",\r\n  \"description\" : \"Deploy AD with SSM Automation\",\r\n  \"parameters\" : {\r\n    \"ServerRole\" : {\r\n      \"description\" : \"Role server will be (DomainController or CertificateAuthority)\",\r\n      \"type\" : \"String\"\r\n    },\r\n    \"TrustDirection\" : {\r\n      \"default\" : \"placeholder\",\r\n      \"description\" : \"Trust Direction from AWS Managed Microsoft AD to on-premises domain.\",\r\n      \"type\" : \"String\"\r\n    },\r\n    \"DomainDNSName\" : {\r\n      \"description\" : \"Fully qualified domain name (FQDN) of the forest root domain e.g. onpremises.local\",\r\n      \"type\" : \"String\"\r\n    },\r\n    \"MadDirectoryID\" : {\r\n      \"default\" : \"placeholder\",\r\n      \"description\" : \"Directory ID of MAD domain\",\r\n      \"type\" : \"String\"\r\n    },\r\n    \"DomainNetBIOSName\" : {\r\n      \"description\" : \"NetBIOS name of the domain (up to 15 characters) for users of earlier versions of Windows e.g. ONPREMISES\",\r\n      \"type\" : \"String\"\r\n    },\r\n    \"FsxOnpremParentOu\" : {\r\n      \"default\" : \"placeholder\",\r\n      \"description\" : \"Parent OU DN for Amazon FSX for Windows deployment with On-Premises AD\",\r\n      \"type\" : \"String\"\r\n    },\r\n    \"DeploymentType\" : {\r\n      \"description\" : \"Type of workload being deployed\",\r\n      \"type\" : \"String\"\r\n    },\r\n    \"TrustSecretName\" : {\r\n      \"default\" : \"placeholder\",\r\n      \"description\" : \"AWS Secrets Parameter Name\",\r\n      \"type\" : \"String\"\r\n    },\r\n    \"ServerNetBIOSName\" : {\r\n      \"description\" : \"NetBIOS name of the first Active Directory Domain Controller (up to 15 characters)\",\r\n      \"type\" : \"String\"\r\n    },\r\n    \"LogicalResourceId\" : {\r\n      \"description\" : \"CloudFormation Resource ID\",\r\n      \"type\" : \"String\"\r\n    },\r\n    \"DomainType\" : {\r\n      \"default\" : \"placeholder\",\r\n      \"description\" : \"Type of domain PKI will be integrated with\",\r\n      \"type\" : \"String\"\r\n    },\r\n    \"MadDNSName\" : {\r\n      \"default\" : \"placeholder\",\r\n      \"description\" : \"Fully qualified domain name (FQDN) of the MAD domain e.g. corp.example.com\",\r\n      \"type\" : \"String\"\r\n    },\r\n    \"VPCCIDR\" : {\r\n      \"description\" : \"CIDR Block for the VPC\",\r\n      \"type\" : \"String\"\r\n    },\r\n    \"ParentDomainDNSName\" : {\r\n      \"default\" : \"placeholder\",\r\n      \"description\" : \"Fully qualified domain name (FQDN) of the forest root domain e.g. onpremises.local\",\r\n      \"type\" : \"String\"\r\n    },\r\n    \"AdministratorSecretName\" : {\r\n      \"description\" : \"AWS Secrets Parameter Name\",\r\n      \"type\" : \"String\"\r\n    },\r\n    \"IntegrateFsxOnprem\" : {\r\n      \"default\" : \"placeholder\",\r\n      \"description\" : \"Deploy \u0026 Integrate Amazon FSX for Windows with On-Premises AD\",\r\n      \"type\" : \"String\"\r\n    },\r\n    \"DeployPki\" : {\r\n      \"description\" : \"Deploy an Enterprise CA\",\r\n      \"type\" : \"String\"\r\n    },\r\n    \"OnpremDomainDNSName\" : {\r\n      \"default\" : \"placeholder\",\r\n      \"description\" : \"Fully qualified domain name (FQDN) of the forest root domain e.g. example.com\",\r\n      \"type\" : \"String\"\r\n    },\r\n    \"StackName\" : {\r\n      \"description\" : \"Stack Name Input for cfn resource signal\",\r\n      \"type\" : \"String\"\r\n    },\r\n    \"ParentInstanceIP\" : {\r\n      \"default\" : \"placeholder\",\r\n      \"description\" : \"IP Address of the forest root domain controller\",\r\n      \"type\" : \"String\"\r\n    }\r\n  },\r\n  \"mainSteps\" : [ {\r\n    \"outputs\" : [ {\r\n      \"Type\" : \"String\",\r\n      \"Name\" : \"InstanceId\",\r\n      \"Selector\" : \"$.Reservations[0].Instances[0].InstanceId\"\r\n    } ],\r\n    \"inputs\" : {\r\n      \"Filters\" : [ {\r\n        \"Values\" : [ \"{{ServerNetBIOSName}}\" ],\r\n        \"Name\" : \"tag:Name\"\r\n      }, {\r\n        \"Values\" : [ \"{{StackName}}\" ],\r\n        \"Name\" : \"tag:aws:cloudformation:stack-name\"\r\n      }, {\r\n        \"Values\" : [ \"running\" ],\r\n        \"Name\" : \"instance-state-name\"\r\n      } ],\r\n      \"Service\" : \"ec2\",\r\n      \"Api\" : \"DescribeInstances\"\r\n    },\r\n    \"name\" : \"InstanceId\",\r\n    \"action\" : \"aws:executeAwsApi\",\r\n    \"onFailure\" : \"step:signalFailure\",\r\n    \"nextStep\" : \"intializeInstance\"\r\n  }, {\r\n    \"inputs\" : {\r\n      \"Parameters\" : {\r\n        \"commands\" : \"[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12\\n\\n$RegistryItems = @(\\n    @{\\n        Name         = 'SchUseStrongCrypto'\\n        Path         = 'Registry::HKEY_LOCAL_MACHINE\\\\SOFTWARE\\\\Microsoft\\\\.NETFramework\\\\v4.0.30319'\\n        Value        = '1'\\n        PropertyType = 'DWORD'\\n    },\\n    @{\\n        Name         = 'SchUseStrongCrypto'\\n        Path         = 'Registry::HKEY_LOCAL_MACHINE\\\\SOFTWARE\\\\Wow6432Node\\\\Microsoft\\\\.NETFramework\\\\v4.0.30319'\\n        Value        = '1'\\n        PropertyType = 'DWORD'\\n    }\\n)\\n\\nForeach ($RegistryItem in $RegistryItems) {\\n    Try {\\n        $Null = New-ItemProperty @RegistryItem -Force -ErrorAction Stop\\n    } Catch [System.Exception] {\\n        Write-Output \\\"Failed to create Registry key named $($RegistryItem.Name) at $($RegistryItem.Path) $_\\\"\\n        Exit 1\\n    }\\n}\\n\\n$Modules = @(\\n    @{\\n        Name    = 'NetworkingDsc'\\n        Version = '9.0.0'\\n    },\\n    @{\\n        Name    = 'ActiveDirectoryDsc'\\n        Version = '6.2.0'\\n    },\\n    @{\\n        Name    = 'ComputerManagementDsc'\\n        Version = '8.5.0'\\n    },\\n    @{\\n        Name    = 'DnsServerDsc'\\n        Version = '3.0.0'\\n    },\\n    @{\\n        Name    = 'AuditPolicyDsc'\\n        Version = '1.4.0.0'\\n    },\\n    @{\\n        Name    = 'SChannelDsc'\\n        Version = '1.4.0'\\n    }\\n)\\n\\nFunction New-VolumeFromRawDisk {\\n    Write-Output 'Finding RAW Disk'\\n    $Counter = 0\\n    Do {\\n        Try {\\n            $BlankDisks = Get-Disk -ErrorAction Stop | Where-Object { $_.PartitionStyle -eq 'RAW' } | Select-Object -ExpandProperty 'Number'\\n        } Catch [System.Exception] {\\n            Write-Output \\\"Failed to get disk $_\\\"\\n            $BlankDisks = $Null\\n        }\\n        If (-not $BlankDisks) {\\n            $Counter ++\\n            Write-Output 'RAW Disk not found sleeping 10 seconds and will try again.'\\n            Start-Sleep -Seconds 10\\n        }\\n    } Until ($BlankDisks -or $Counter -eq 12)\\n\\n    If ($Counter -ge 12) {\\n        Write-Output 'RAW Disk not found exiting'\\n        Return\\n    }\\n\\n    Foreach ($BlankDisk in $BlankDisks) {\\n        Write-Output 'Data Volume not initialized attempting to bring online'\\n        Try {\\n            Initialize-Disk -Number $BlankDisk -PartitionStyle 'GPT' -ErrorAction Stop\\n        } Catch [System.Exception] {\\n            Write-Output \\\"Failed attempting to bring online Data Volume $_\\\"\\n            Exit 1\\n        }\\n\\n        Start-Sleep -Seconds 5\\n\\n        Write-Output 'Data Volume creating new partition'\\n        Try {\\n            $DriveLetter = New-Partition -Alignment '4096000' -DiskNumber $BlankDisk -AssignDriveLetter -UseMaximumSize -ErrorAction Stop | Select-Object -ExpandProperty 'DriveLetter'\\n        } Catch [System.Exception] {\\n            Write-Output \\\"Failed creating new partition $_\\\"\\n            Exit 1\\n        }\\n\\n        Start-Sleep -Seconds 5\\n\\n        Write-Output 'Data Volume formatting partition'\\n        Try {\\n            $Null = Format-Volume -DriveLetter $DriveLetter -FileSystem 'NTFS' -NewFileSystemLabel 'Data' -Confirm:$false -Force -ErrorAction Stop\\n        } Catch [System.Exception] {\\n            Write-Output \\\"Failed formatting partition $_\\\"\\n            Exit 1\\n        }\\n\\n        Try {\\n            $Null = Get-CimInstance -ClassName 'Win32_Volume' -Filter \\\"DriveLetter='$($DriveLetter):'\\\" -ErrorAction Stop | Set-CimInstance -Arguments @{ IndexingEnabled = $False }\\n        } Catch [System.Exception] {\\n            Write-Output \\\"Failed to turn off indexing $_\\\"\\n            Exit 1\\n        }\\n    }\\n}\\n\\nFunction Invoke-PreConfig {\\n    Write-Output 'Temporarily disabling Windows Firewall'\\n    Try {\\n        Get-NetFirewallProfile -ErrorAction Stop | Set-NetFirewallProfile -Enabled False -ErrorAction Stop\\n    } Catch [System.Exception] {\\n        Write-Output \\\"Failed to disable Windows Firewall $_\\\"\\n        Exit 1\\n    }\\n\\n    $Dirs = @(\\n        'C:\\\\Temp\\\\publickeys',\\n        'C:\\\\DnsLogs'\\n    )\\n\\n    Foreach ($Dir in $Dirs) {\\n        Write-Output \\\"Creating file directory $Dir\\\"\\n        Try {\\n            $Null = New-Item -Path $Dir -ItemType 'Directory' -ErrorAction Stop\\n        } Catch [System.Exception] {\\n            Write-Output \\\"Failed to create directory $Dir $_\\\"\\n            Exit 1\\n        }\\n    }\\n\\n    Write-Output 'Creating certificate to encrypt credentials in MOF file'\\n    Try {\\n        $cert = New-SelfSignedCertificate -Type 'DocumentEncryptionCertLegacyCsp' -DnsName 'DscEncryptCert' -HashAlgorithm 'SHA256' -ErrorAction Stop\\n    } Catch [System.Exception] {\\n        Write-Output \\\"Failed to create self signed cert $_\\\"\\n        Exit 1\\n    }\\n\\n    Write-Output 'Exporting the self signed public key certificate'\\n    Try {\\n        $Null = $cert | Export-Certificate -FilePath 'C:\\\\Temp\\\\publickeys\\\\DscPublicKey.cer' -Force -ErrorAction Stop\\n    } Catch [System.Exception] {\\n        Write-Output \\\"Failed to copy self signed cert to publickeys directory $_\\\"\\n        Exit 1\\n    }\\n}\\n\\nFunction Invoke-LcmConfig {\\n    Write-Output 'Getting the DSC cert thumbprint to secure the MOF file'\\n    Try {\\n        $DscCertThumbprint = Get-ChildItem -Path 'cert:\\\\LocalMachine\\\\My' -ErrorAction Stop | Where-Object { $_.Subject -eq 'CN=DscEncryptCert' } | Select-Object -ExpandProperty 'Thumbprint'\\n    } Catch [System.Exception] {\\n        Write-Output \\\"Failed to get DSC cert thumbprint $_\\\"\\n        Exit 1\\n    }\\n\\n    [DSCLocalConfigurationManager()]\\n    Configuration LCMConfig\\n    {\\n        Node 'localhost' {\\n            Settings {\\n                RefreshMode                    = 'Push'\\n                ConfigurationModeFrequencyMins = 15\\n                ActionAfterReboot              = 'StopConfiguration'\\n                RebootNodeIfNeeded             = $false\\n                ConfigurationMode              = 'ApplyAndAutoCorrect'\\n                CertificateId                  = $DscCertThumbprint\\n            }\\n        }\\n    }\\n\\n    Write-Output 'Generating MOF file for LCM'\\n    $Null = LCMConfig -OutputPath 'C:\\\\Temp\\\\LCMConfig'\\n\\n    Write-Output 'Sets LCM configuration to MOF generated in previous command'\\n    Try {\\n        Set-DscLocalConfigurationManager -Path 'C:\\\\Temp\\\\LCMConfig' -ErrorAction Stop\\n    } Catch [System.Exception] {\\n        Write-Output \\\"Failed to set LCM configuration $_\\\"\\n        Exit 1\\n    }\\n}\\n\\nWrite-Output 'Installing NuGet Package Provider'\\nTry {\\n    $Null = Install-PackageProvider -Name 'NuGet' -MinimumVersion '2.8.5' -Force -ErrorAction Stop\\n} Catch [System.Exception] {\\n    Write-Output \\\"Failed to install NuGet Package Provider $_\\\"\\n    Exit 1\\n}\\n\\nWrite-Output 'Setting PSGallery Respository to trusted'\\nTry {\\n    Set-PSRepository -Name 'PSGallery' -InstallationPolicy 'Trusted' -ErrorAction Stop\\n} Catch [System.Exception] {\\n    Write-Output \\\"Failed to set PSGallery Respository to trusted $_\\\"\\n    Exit 1\\n}\\n\\nWrite-Output 'Installing the needed Powershell DSC modules'\\nForeach ($Module in $Modules) {\\n    Try {\\n        Install-Module -Name $Module.Name -RequiredVersion $Module.Version -ErrorAction Stop\\n    } Catch [System.Exception] {\\n        Write-Output \\\"Failed to Import Modules $_\\\"\\n        #Exit 1\\n    }\\n}\\n\\nWrite-Output 'Getting certificate AutoEnrollment policy'\\nTry {\\n    $CertEnrollmentActive = Get-CertificateAutoEnrollmentPolicy -context 'Machine' -Scope 'Local' | Select-Object -ExpandProperty 'PolicyState' -ErrorAction Stop\\n} Catch [System.Exception] {\\n    Write-Output \\\"Failed to get certificate AutoEnrollment policy $_\\\"\\n    Exit 1\\n}\\n\\nIf ($CertEnrollmentActive -ne 'Enabled') {\\n    Write-Output 'Setting certificate AutoEnrollment policy'\\n    Try {\\n        Set-CertificateAutoEnrollmentPolicy -ExpirationPercentage 10 -PolicyState 'Enabled' -EnableTemplateCheck -EnableMyStoreManagement -StoreName 'MY' -context 'Machine' -ErrorAction Stop\\n    } Catch [System.Exception] {\\n        Write-Output \\\"Failed to set certificate AutoEnrollment policy $_\\\"\\n        Exit 1\\n    }\\n}\\n\\nNew-VolumeFromRawDisk\\nInvoke-PreConfig\\nInvoke-LcmConfig\\n\\nIf ('{{DeploymentType}}' -eq 'Management') {\\n    Write-Output 'Installing SQL Server Management Studio'\\n(New-Object -TypeName 'System.Net.WebClient').DownloadFile('https://aka.ms/ssmsfullsetup', 'C:\\\\Temp\\\\SSMS-Setup.exe')\\n    $ArgumentList = '/Quiet'\\n    Try {\\n        $Process = Start-Process -FilePath 'C:\\\\Temp\\\\SSMS-Setup.exe' -ArgumentList $ArgumentList -NoNewWindow -PassThru -Wait -ErrorAction Stop\\n    } Catch [System.Exception] {\\n        Write-Output \\\"Failed to install SQL Server Management Studio $_\\\"\\n        #Exit 1\\n    }\\n}\"\r\n      },\r\n      \"CloudWatchOutputConfig\" : {\r\n        \"CloudWatchOutputEnabled\" : true,\r\n        \"CloudWatchLogGroupName\" : \"/aws/Demo/{{StackName}}\"\r\n      },\r\n      \"InstanceIds\" : [ \"{{InstanceId.InstanceId}}\" ],\r\n      \"DocumentName\" : \"AWS-RunPowerShellScript\"\r\n    },\r\n    \"name\" : \"intializeInstance\",\r\n    \"action\" : \"aws:runCommand\",\r\n    \"onFailure\" : \"step:signalFailure\",\r\n    \"nextStep\" : \"configureInstance\"\r\n  }, {\r\n    \"inputs\" : {\r\n      \"Parameters\" : {\r\n        \"commands\" : \"Function Get-SecretInfo {\\n    [CmdletBinding()]\\n    Param (\\n        [Parameter(Mandatory = $True)][String]$Domain,\\n        [Parameter(Mandatory = $True)][String]$SecretArn\\n    )\\n\\n    Write-Output \\\"Getting $SecretArn Secret\\\"\\n    Try {\\n        $SecretContent = Get-SECSecretValue -SecretId $SecretArn -ErrorAction Stop | Select-Object -ExpandProperty 'SecretString' | ConvertFrom-Json -ErrorAction Stop\\n    } Catch [System.Exception] {\\n        Write-Output \\\"Failed to get $SecretArn Secret $_\\\"\\n        Exit 1\\n    }\\n\\n    Write-Output 'Creating PSCredential object from Secret'\\n    $Username = $SecretContent.username\\n    $UserPassword = ConvertTo-SecureString ($SecretContent.password) -AsPlainText -Force\\n    $DomainCredentials = New-Object -TypeName 'System.Management.Automation.PSCredential' (\\\"$Domain\\\\$Username\\\", $UserPassword)\\n    $Credentials = New-Object -TypeName 'System.Management.Automation.PSCredential' ($Username, $UserPassword)\\n\\n    $Output = [PSCustomObject][Ordered]@{\\n        'Credentials'       = $Credentials\\n        'DomainCredentials' = $DomainCredentials\\n        'Username'          = $Username\\n        'UserPassword'      = $UserPassword\\n    }\\n\\n    Return $Output\\n}\\n\\nFunction Get-EniConfig {\\n    Write-Output 'Getting network configuration'\\n    Try {\\n        $NetIpConfig = Get-NetIPConfiguration -ErrorAction Stop\\n    } Catch [System.Exception] {\\n        Write-Output \\\"Failed to get network configuration $_\\\"\\n        Exit 1\\n    }\\n\\n    Write-Output 'Grabbing the current gateway address in order to static IP correctly'\\n    $GatewayAddress = $NetIpConfig | Select-Object -ExpandProperty 'IPv4DefaultGateway' | Select-Object -ExpandProperty 'NextHop'\\n\\n    Write-Output 'Formatting IP address in format needed for IPAdress DSC resource'\\n    $IpAddress = $NetIpConfig | Select-Object -ExpandProperty 'IPv4Address' | Select-Object -ExpandProperty 'IpAddress'\\n    $Prefix = $NetIpConfig | Select-Object -ExpandProperty 'IPv4Address' | Select-Object -ExpandProperty 'PrefixLength'\\n    $InterfaceAlias = $NetIpConfig | Select-Object -ExpandProperty 'InterfaceAlias'\\n    $IpAddr = 'IP/CIDR' -replace 'IP', $IpAddress -replace 'CIDR', $Prefix\\n\\n    Write-Output 'Getting MAC address'\\n    Try {\\n        $MacAddress = Get-NetAdapter -ErrorAction Stop | Select-Object -ExpandProperty 'MacAddress'\\n    } Catch [System.Exception] {\\n        Write-Output \\\"Failed to get MAC address $_\\\"\\n        Exit 1\\n    }\\n\\n    $Output = [PSCustomObject][Ordered]@{\\n        'GatewayAddress' = $GatewayAddress\\n        'IpAddress'      = $IpAddr\\n        'DnsIpAddress'   = $IpAddress\\n        'MacAddress'     = $MacAddress\\n        'InterfaceAlias' = $InterfaceAlias\\n    }\\n\\n    Return $Output\\n}\\n\\nFunction Set-DscConfiguration {\\n    [CmdletBinding()]\\n    param(\\n        [Parameter(Mandatory = $true)][PSCredential]$DaCredentials,\\n        [Parameter(Mandatory = $false)][PSCredential]$EaCredentials,\\n        [Parameter(Mandatory = $true)][string]$DeploymentType,\\n        [Parameter(Mandatory = $false)][string]$DnsInstanceIP,\\n        [Parameter(Mandatory = $true)][string]$DomainDNSName,\\n        [Parameter(Mandatory = $true)][string]$DomainNetBIOSName,\\n        [Parameter(Mandatory = $false)][string]$DomainType,\\n        [Parameter(Mandatory = $true)][string]$GatewayAddress,\\n        [Parameter(Mandatory = $false)][string]$InterfaceAlias,\\n        [Parameter(Mandatory = $true)][string]$InstanceIP,\\n        [Parameter(Mandatory = $true)][string]$InstanceNetBIOSName,\\n        [Parameter(Mandatory = $false)][PSCredential]$LaCredentials,\\n        [Parameter(Mandatory = $true)][string]$MacAddress,\\n        [Parameter(Mandatory = $false)][string]$MadDNSName,\\n        [Parameter(Mandatory = $false)][string]$ParentDomainDNSName,\\n        [Parameter(Mandatory = $false)][string]$ParentInstanceIP,\\n        [Parameter(Mandatory = $false)][PSCredential]$RestoreModeCredentials,\\n        [Parameter(Mandatory = $false)][string]$SiteName,\\n        [Parameter(Mandatory = $false)][string]$VPCCIDR\\n    )\\n\\n    $VPCDNS = '169.254.169.253'\\n\\n    If ($DeploymentType -eq 'RootDomainController') {\\n        $AClass = 0..8\\n        $BClass = 9..16\\n        $CClass = 17..24\\n        $DClass = 25..32\\n        $IP = $VPCCIDR.Split('/')[0]\\n        [System.Collections.ArrayList]$IPArray = $IP -Split \\\"\\\\.\\\"\\n        $Range = $VPCCIDR.Split('/')[1]\\n        If ($AClass -contains $Range) {\\n            [System.Array]$Number = $IPArray[0]\\n        } Elseif ($BClass -contains $Range) {\\n            [System.Array]$Number = $IPArray[0, 1]\\n        } Elseif ($CClass -contains $Range) {\\n            [System.Array]$Number = $IPArray[0, 1, 2]\\n        } Elseif ($DClass -contains $Range) {\\n            [System.Array]$Number = $IPArray[0, 1, 2, 3]\\n        }\\n        [System.Array]::Reverse($Number)\\n        $IpRev = $Number -Join \\\".\\\"\\n        $ZoneName = $IpRev + '.in-addr.arpa'\\n    }\\n\\n    Write-Output 'Getting the DSC encryption thumbprint to secure the MOF file'\\n    Try {\\n        $DscCertThumbprint = Get-ChildItem -Path 'cert:\\\\LocalMachine\\\\My' -ErrorAction Stop | Where-Object { $_.Subject -eq 'CN=DscEncryptCert' } | Select-Object -ExpandProperty 'Thumbprint'\\n    } Catch [System.Exception] {\\n        Write-Output \\\"Failed to get DSC cert thumbprint $_\\\"\\n        Exit 1\\n    }\\n\\n    If ($DeploymentType -eq 'RootDomainController' -or $DeploymentType -eq 'ChildDomainController') {\\n        Write-Output \\\"Setting DNS client $_\\\"\\n        Try {\\n            Set-DnsClientServerAddress -InterfaceAlias $InterfaceAlias -ServerAddresses ($VPCDNS) -ErrorAction Stop\\n        } Catch [System.Exception] {\\n            Write-Output \\\"Failed to set DNS client $_\\\"\\n            Exit 1\\n        }\\n    }\\n\\n    Write-Output 'Creating configuration data block that has the certificate information for DSC configuration processing'\\n    $ConfigurationData = @{\\n        AllNodes = @(\\n            @{\\n                NodeName             = '*'\\n                #CertificateFile      = 'C:\\\\Temp\\\\publickeys\\\\DscPublicKey.cer'\\n                #Thumbprint           = $DscCertThumbprint\\n                PSDscAllowDomainUser = $true\\n                PsDscAllowPlainTextPassword = $true\\n            },\\n            @{\\n                NodeName = 'localhost'\\n            }\\n        )\\n    }\\n\\n    Switch ($DeploymentType) {\\n        'RootDomainController' {\\n            $Address = @(\\n                $DnsInstanceIP,\\n                '127.0.0.1',\\n                $VPCDNS\\n            )\\n        }\\n        'ChildDomainController' {\\n            $Address = @(\\n                $ParentInstanceIP,\\n                '127.0.0.1',\\n                $VPCDNS\\n            )\\n        }\\n        Default {\\n            $Address = @(\\n                $VPCDNS\\n            )\\n        }\\n    }\\n\\n    Configuration ConfigInstance {\\n        Import-DscResource -ModuleName 'PSDesiredStateConfiguration', 'NetworkingDsc', 'ComputerManagementDsc', 'DnsServerDsc', 'ActiveDirectoryDsc', 'AuditPolicyDsc', 'SChannelDsc'\\n        Node LocalHost {\\n            NetAdapterName RenameNetAdapterPrimary {\\n                NewName    = 'Primary'\\n                MacAddress = $MacAddress\\n            }\\n            PowerPlan SetPlanHighPerformance {\\n                IsSingleInstance = 'Yes'\\n                Name             = 'High performance'\\n            }\\n            NetAdapterAdvancedProperty JumboPacket {\\n                NetworkAdapterName = 'Primary'\\n                RegistryKeyword    = '*JumboPacket'\\n                RegistryValue      = 9015\\n                DependsOn          = '[NetAdapterName]RenameNetAdapterPrimary'\\n            }\\n            NetAdapterAdvancedProperty ReceiveBuffers {\\n                NetworkAdapterName = 'Primary'\\n                RegistryKeyword    = '*ReceiveBuffers'\\n                RegistryValue      = 8192\\n                DependsOn          = '[NetAdapterName]RenameNetAdapterPrimary'\\n            }\\n            NetAdapterAdvancedProperty TransmitBuffers {\\n                NetworkAdapterName = 'Primary'\\n                RegistryKeyword    = '*TransmitBuffers'\\n                RegistryValue      = 1024\\n                DependsOn          = '[NetAdapterName]RenameNetAdapterPrimary'\\n            }\\n            NetBios DisableNetBios {\\n                InterfaceAlias = 'Primary'\\n                Setting        = 'Disable'\\n            }\\n            NetIPInterface DisableDhcp {\\n                Dhcp           = 'Disabled'\\n                InterfaceAlias = 'Primary'\\n                AddressFamily  = 'IPv4'\\n                DependsOn      = '[NetAdapterName]RenameNetAdapterPrimary'\\n            }\\n            IPAddress SetIP {\\n                IPAddress      = $InstanceIP\\n                InterfaceAlias = 'Primary'\\n                AddressFamily  = 'IPv4'\\n                DependsOn      = '[NetIPInterface]DisableDhcp'\\n            }\\n            DefaultGatewayAddress SetDefaultGateway {\\n                Address        = $GatewayAddress\\n                InterfaceAlias = 'Primary'\\n                AddressFamily  = 'IPv4'\\n                DependsOn      = '[IPAddress]SetIP'\\n            }\\n            DnsServerAddress DnsServerAddress {\\n                Address        = $Address\\n                InterfaceAlias = 'Primary'\\n                AddressFamily  = 'IPv4'\\n                DependsOn      = '[DefaultGatewayAddress]SetDefaultGateway'\\n            }\\n            DnsConnectionSuffix DnsConnectionSuffix {\\n                InterfaceAlias                 = 'Primary'\\n                ConnectionSpecificSuffix       = $DomainDNSName\\n                RegisterThisConnectionsAddress = $True\\n                UseSuffixWhenRegistering       = $False\\n                DependsOn                      = '[DnsServerAddress]DnsServerAddress'\\n            }\\n            WindowsFeature DnsTools {\\n                Ensure    = 'Present'\\n                Name      = 'RSAT-DNS-Server'\\n                DependsOn = '[DnsConnectionSuffix]DnsConnectionSuffix'\\n            }\\n            WindowsFeature RSAT-AD-Tools {\\n                Ensure    = 'Present'\\n                Name      = 'RSAT-AD-Tools'\\n                DependsOn = '[WindowsFeature]DnsTools'\\n            }\\n            WindowsFeature RSAT-ADDS {\\n                Ensure    = 'Present'\\n                Name      = 'RSAT-ADDS'\\n                DependsOn = '[WindowsFeature]RSAT-AD-Tools'\\n            }\\n            WindowsFeature GPMC {\\n                Ensure    = 'Present'\\n                Name      = 'GPMC'\\n                DependsOn = '[WindowsFeature]RSAT-ADDS'\\n            }\\n            If ($DeploymentType -eq 'RootDomainController' -or $DeploymentType -eq 'ChildDomainController') {\\n                WindowsFeature DNS {\\n                    Ensure    = 'Present'\\n                    Name      = 'DNS'\\n                    DependsOn = '[WindowsFeature]GPMC'\\n                }\\n                WindowsFeature AD-Domain-Services {\\n                    Ensure    = 'Present'\\n                    Name      = 'AD-Domain-Services'\\n                    DependsOn = '[WindowsFeature]DNS'\\n                }\\n                Service ActiveDirectoryWebServices {\\n                    Name        = 'ADWS'\\n                    StartupType = 'Automatic'\\n                    State       = 'Running'\\n                    DependsOn   = '[WindowsFeature]AD-Domain-Services'\\n                }\\n                Computer Rename {\\n                    Name      = $InstanceNetBIOSName\\n                    DependsOn = '[WindowsFeature]AD-Domain-Services'\\n                }\\n                User AdministratorPassword {\\n                    UserName  = 'Administrator'\\n                    Password  = $LaCredentials\\n                    DependsOn = '[Computer]Rename'\\n                }\\n                Switch ($DeploymentType) {\\n                    'RootDomainController' {\\n                        ADDomain PrimaryDC {\\n                            DomainName                    = $DomainDnsName\\n                            DomainNetBIOSName             = $DomainNetBIOSName\\n                            Credential                    = $DaCredentials\\n                            SafemodeAdministratorPassword = $RestoreModeCredentials\\n                            DatabasePath                  = 'D:\\\\NTDS'\\n                            LogPath                       = 'D:\\\\NTDS'\\n                            SysvolPath                    = 'D:\\\\SYSVOL'\\n                            DependsOn                     = '[User]AdministratorPassword'\\n                        }\\n                    }    \\n                    'ChildDomainController' {\\n                        ADDomain PrimaryDC {\\n                            DomainName                    = $DomainNetBIOSName.ToLower()\\n                            DomainNetBIOSName             = $DomainNetBIOSName\\n                            ParentDomainName              = $ParentDomainDNSName\\n                            Credential                    = $EaCredentials\\n                            SafemodeAdministratorPassword = $RestoreModeCredentials\\n                            DatabasePath                  = 'D:\\\\NTDS'\\n                            LogPath                       = 'D:\\\\NTDS'\\n                            SysvolPath                    = 'D:\\\\SYSVOL'\\n                            DependsOn                     = '[User]AdministratorPassword'\\n                        }\\n                    }\\n                }\\n                WaitForADDomain WaitForPrimaryDC {\\n                    DomainName  = $DomainDnsName\\n                    WaitTimeout = 600\\n                    DependsOn   = '[ADDomain]PrimaryDC'\\n                }\\n                ADGroup AddAdminToDomainAdminsGroup {\\n                    Ensure           = 'Present'\\n                    GroupName        = 'Domain Admins'\\n                    GroupScope       = 'Global'\\n                    Category         = 'Security'\\n                    MembersToInclude = @('Administrator')\\n                    Credential       = $DaCredentials\\n                    DependsOn        = '[WaitForADDomain]WaitForPrimaryDC'\\n                }\\n                If ($DeploymentType -eq 'RootDomainController') {\\n                    ADForestProperties TSL {\\n                        ForestName        = $DomainDnsName\\n                        TombStoneLifetime = 60\\n                        DependsOn         = '[WaitForADDomain]WaitForPrimaryDC'\\n                    }\\n                    ADReplicationSite RegionSite {\\n                        Name                       = $SiteName\\n                        RenameDefaultFirstSiteName = $true\\n                        DependsOn                  = '[WaitForADDomain]WaitForPrimaryDC', '[Service]ActiveDirectoryWebServices'\\n                    }\\n                    ADReplicationSubnet VPCCIDR {\\n                        Name      = $VPCCIDR\\n                        Site      = $SiteName\\n                        DependsOn = '[ADReplicationSite]RegionSite'\\n                    }                    \\n                    ADGroup AddAdminToEnterpriseAdminsGroup {\\n                        Ensure           = 'Present'\\n                        GroupName        = 'Enterprise Admins'\\n                        GroupScope       = 'Universal'\\n                        Category         = 'Security'\\n                        MembersToInclude = @('Administrator')\\n                        Credential       = $DaCredentials\\n                        DependsOn        = '[WaitForADDomain]WaitForPrimaryDC'\\n                    }\\n                    ADGroup AddAdminToSchemaAdminsGroup {\\n                        Ensure           = 'Present'\\n                        GroupName        = 'Schema Admins'\\n                        GroupScope       = 'Universal'\\n                        Category         = 'Security'\\n                        MembersToExclude = @('Administrator')\\n                        Credential       = $DaCredentials\\n                        DependsOn        = '[WaitForADDomain]WaitForPrimaryDC'\\n                    }\\n                    ADOptionalFeature RecycleBin {\\n                        FeatureName                       = 'Recycle Bin Feature'\\n                        EnterpriseAdministratorCredential = $DaCredentials\\n                        ForestFQDN                        = $DomainDnsName\\n                        DependsOn                         = '[WaitForADDomain]WaitForPrimaryDC'\\n                    }\\n                    DnsServerConditionalForwarder MADForwarder {\\n                        Name             = $MadDNSName \\n                        MasterServers    = @($VPCDNS)\\n                        ReplicationScope = 'Forest'\\n                        Ensure           = 'Present'\\n                        DependsOn        = '[WaitForADDomain]WaitForPrimaryDC'\\n                    }\\n                    DnsServerADZone CreateReverseLookupZone {\\n                        Ensure           = 'Present'\\n                        Name             = $ZoneName\\n                        DynamicUpdate    = 'Secure'\\n                        ReplicationScope = 'Forest'\\n                        DependsOn        = '[WaitForADDomain]WaitForPrimaryDC'\\n                    }\\n                    DnsServerZoneAging DnsServerZoneAging-FL {\\n                        Name              = $DomainDnsName\\n                        Enabled           = $true\\n                        RefreshInterval   = 168\\n                        NoRefreshInterval = 168\\n                        DependsOn         = '[WaitForADDomain]WaitForPrimaryDC'\\n                    }\\n                    DnsServerZoneAging DnsServerZoneAging-RL {\\n                        Name              = $ZoneName\\n                        Enabled           = $true\\n                        RefreshInterval   = 168\\n                        NoRefreshInterval = 168\\n                        DependsOn         = '[DnsServerADZone]CreateReverseLookupZone'\\n                    }                                     \\n                }\\n                DnsServerForwarder ForwardtoVPCDNS {\\n                    IsSingleInstance = 'Yes'\\n                    IPAddresses      = $VPCDNS\\n                    DependsOn        = '[WaitForADDomain]WaitForPrimaryDC'\\n                }\\n                ADKDSKey KdsKey {\\n                    Ensure                   = 'Present'\\n                    EffectiveTime            = ((Get-Date).addhours(-10))\\n                    AllowUnsafeEffectiveTime = $True\\n                    DependsOn                = '[WaitForADDomain]WaitForPrimaryDC'\\n                }\\n                ADServicePrincipalName WSMAN-FQDN {\\n                    ServicePrincipalName = \\\"WSMAN/$InstanceNetBIOSName.$DomainDnsName\\\"\\n                    Account              = \\\"$InstanceNetBIOSName$\\\"\\n                    DependsOn            = '[WaitForADDomain]WaitForPrimaryDC'\\n                }\\n                ADServicePrincipalName WSMAN-SN {\\n                    ServicePrincipalName = \\\"WSMAN/$InstanceNetBIOSName\\\"\\n                    Account              = \\\"$InstanceNetBIOSName$\\\"\\n                    DependsOn            = '[WaitForADDomain]WaitForPrimaryDC'\\n                }\\n                DnsServerScavenging SetServerScavenging {\\n                    DnsServer          = 'localhost'\\n                    ScavengingState    = $true\\n                    ScavengingInterval = '7.00:00:00'\\n                    RefreshInterval    = '7.00:00:00'\\n                    NoRefreshInterval  = '7.00:00:00'\\n                    DependsOn          = '[WaitForADDomain]WaitForPrimaryDC'\\n                }\\n                DnsServerDiagnostics Diagnostics {\\n                    DnsServer                            = 'localhost'\\n                    Answers                              = $true\\n                    EnableLogFileRollover                = $true\\n                    EnableLoggingForLocalLookupEvent     = $true\\n                    EnableLoggingForPluginDllEvent       = $true\\n                    EnableLoggingForRecursiveLookupEvent = $true\\n                    EnableLoggingForRemoteServerEvent    = $true\\n                    EnableLoggingForServerStartStopEvent = $true\\n                    EnableLoggingForTombstoneEvent       = $true\\n                    EnableLoggingForZoneDataWriteEvent   = $true\\n                    EnableLoggingForZoneLoadingEvent     = $true\\n                    EnableLoggingToFile                  = $true\\n                    EventLogLevel                        = 7\\n                    FullPackets                          = $true\\n                    LogFilePath                          = 'C:\\\\DnsLogs\\\\dns.log'\\n                    MaxMBFileSize                        = 500000000\\n                    Notifications                        = $true\\n                    Queries                              = $true\\n                    QuestionTransactions                 = $true\\n                    ReceivePackets                       = $true\\n                    SaveLogsToPersistentStorage          = $true\\n                    SendPackets                          = $true\\n                    TcpPackets                           = $true\\n                    UdpPackets                           = $true\\n                    UnmatchedResponse                    = $true\\n                    Update                               = $true\\n                    UseSystemEventLog                    = $true\\n                    WriteThrough                         = $true\\n                }\\n            } Else {\\n                Computer JoinDomain {\\n                    Name       = $InstanceNetBIOSName\\n                    DomainName = $DomainDnsName\\n                    Credential = $DaCredentials\\n                    DependsOn  = '[WindowsFeature]GPMC'\\n                }\\n            }\\n        }\\n    }\\n    Write-Output 'Generating MOF file'\\n    $Null = ConfigInstance -OutputPath 'C:\\\\Temp\\\\ConfigInstance' -ConfigurationData $ConfigurationData\\n}\\n\\nFunction Invoke-DscStatusCheck {\\n    $LCMState = Get-DscLocalConfigurationManager -ErrorAction SilentlyContinue | Select-Object -ExpandProperty 'LCMState'\\n    If ($LCMState -eq 'PendingConfiguration' -Or $LCMState -eq 'PendingReboot') {\\n        Exit 3010\\n    } Else {\\n        Write-Output 'DSC Config Completed'\\n    }\\n}\\n\\n$Secret = Get-SecretInfo -Domain '{{DomainNetBIOSName}}' -SecretArn '{{AdministratorSecretName}}'\\n$EniConfig = Get-EniConfig\\n$DeploymentType = '{{DeploymentType}}'\\n\\nSwitch ($DeploymentType) {\\n    'RootDomainController' {\\n        Set-DscConfiguration -DaCredentials $Secret.DomainCredentials -DeploymentType 'RootDomainController' -DnsInstanceIP $EniConfig.DnsIpAddress -DomainDNSName '{{DomainDNSName}}' -DomainNetBIOSName '{{DomainNetBIOSName}}' -GatewayAddress $EniConfig.GatewayAddress -InterfaceAlias $EniConfig.InterfaceAlias -InstanceIP $EniConfig.IpAddress -InstanceNetBIOSName '{{ServerNetBIOSName}}' -LaCredentials $Secret.Credentials -MacAddress $EniConfig.MacAddress -MadDNSName '{{MadDNSName}}'-RestoreModeCredentials $Secret.Credentials -SiteName '{{global:REGION}}' -VPCCIDR '{{VPCCIDR}}'\\n    }\\n    'ChildDomainController' {\\n        $EaSecret = Get-SecretInfo -Domain '{{ParentDomainDNSName}}' -SecretArn '{{AdministratorSecretName}}'\\n        Set-DscConfiguration -DaCredentials $Secret.DomainCredentials -DeploymentType 'ChildDomainController' -DomainDNSName '{{DomainDNSName}}' -DomainNetBIOSName '{{DomainNetBIOSName}}' -EaCredentials $EaSecret.DomainCredentials -GatewayAddress $EniConfig.GatewayAddress -InterfaceAlias $EniConfig.InterfaceAlias -InstanceIP $EniConfig.IpAddress -InstanceNetBIOSName '{{ServerNetBIOSName}}' -LaCredentials $Secret.Credentials -MacAddress $EniConfig.MacAddress -ParentDomainDNSName '{{ParentDomainDNSName}}' -ParentInstanceIP '{{ParentInstanceIP}}' -RestoreModeCredentials $Secret.Credentials -VPCCIDR '{{VPCCIDR}}'\\n    } \\n    default {\\n        Set-DscConfiguration -DaCredentials $Secret.DomainCredentials -DeploymentType 'Member' -DomainDNSName '{{DomainDNSName}}' -DomainNetBIOSName '{{DomainNetBIOSName}}' -GatewayAddress $EniConfig.GatewayAddress -InstanceIP $EniConfig.IpAddress -InstanceNetBIOSName '{{ServerNetBIOSName}}' -MacAddress $EniConfig.MacAddress\\n    }\\n}\\n\\nStart-DscConfiguration 'C:\\\\Temp\\\\ConfigInstance' -Wait -Verbose -Force\\nInvoke-DscStatusCheck\\n\\nIf ($DeploymentType -eq 'RootDomainController') {\\n    Function Get-SecretInfo {\\n        [CmdletBinding()]\\n        Param (\\n            [Parameter(Mandatory = $True)][String]$Domain,\\n            [Parameter(Mandatory = $True)][String]$SecretArn\\n        )\\n\\n        Write-Output \\\"Getting $SecretArn Secret\\\"\\n        Try {\\n            $SecretContent = Get-SECSecretValue -SecretId $SecretArn -ErrorAction Stop | Select-Object -ExpandProperty 'SecretString' | ConvertFrom-Json -ErrorAction Stop\\n        } Catch [System.Exception] {\\n            Write-Output \\\"Failed to get $SecretArn Secret $_\\\"\\n            Exit 1\\n        }\\n\\n        Write-Output 'Creating PSCredential object from Secret'\\n        $Username = $SecretContent.username\\n        $UserPassword = ConvertTo-SecureString ($SecretContent.password) -AsPlainText -Force\\n        $DomainCredentials = New-Object -TypeName 'System.Management.Automation.PSCredential' (\\\"$Domain\\\\$Username\\\", $UserPassword)\\n        $Credentials = New-Object -TypeName 'System.Management.Automation.PSCredential' ($Username, $UserPassword)\\n\\n        $Output = [PSCustomObject][Ordered]@{\\n            'Credentials'       = $Credentials\\n            'DomainCredentials' = $DomainCredentials\\n            'Username'          = $Username\\n            'UserPassword'      = $UserPassword\\n        }\\n\\n        Return $Output\\n    }\\n\\n    Function Invoke-TrustAction {\\n        [CmdletBinding()]\\n        Param(\\n            [parameter(Mandatory = $true)][String]$RemoteFQDN,\\n            [parameter(Mandatory = $true)][String]$TrustDirection,\\n            [parameter(Mandatory = $true)][String]$TrustPassword\\n        )\\n\\n        $LocalForest = [System.DirectoryServices.ActiveDirectory.Forest]::GetCurrentForest() \\n        $AdTrustDir = [System.DirectoryServices.ActiveDirectory.TrustDirection]::$TrustDirection\\n        $Null = Clear-DnsServerCache -Force -ErrorAction SilentlyContinue\\n        $Null = Clear-DnsClientCache -ErrorAction SilentlyContinue\\n        $LocalForest.CreateLocalSideOfTrustRelationship($RemoteFQDN, $AdTrustDir, $TrustPassword)\\n        $LocalForest.VerifyOutboundTrustRelationship($RemoteFQDN)\\n        \u0026 ksetup.exe /SetEncTypeAttr $RemoteFQDN 'RC4-HMAC-MD5' 'AES128-CTS-HMAC-SHA1-96' 'AES256-CTS-HMAC-SHA1-96'\\n    }\\n\\n    Function Add-FSxOuAcl {\\n        [CmdletBinding()]\\n        param(\\n            [Parameter(Mandatory = $true)][string]$AclPath,\\n            [Parameter(Mandatory = $true)][Security.Principal.SecurityIdentifier]$IdentityReference,\\n            [Parameter(Mandatory = $true)][System.DirectoryServices.ActiveDirectoryRights]$ActiveDirectoryRights,\\n            [Parameter(Mandatory = $true)][System.Security.AccessControl.AccessControlType]$AccessControlType,\\n            [Parameter(Mandatory = $false)][Guid]$ObjectGuid,\\n            [Parameter(Mandatory = $false)][System.DirectoryServices.ActiveDirectorySecurityInheritance]$ActiveDirectorySecurityInheritance,\\n            [Parameter(Mandatory = $false)][Guid]$InheritedObjectGuid\\n        )\\n\\n        Import-Module -Name 'ActiveDirectory' -Force\\n\\n        [Security.Principal.SecurityIdentifier]$IdentityReference = $IdentityReference | Select-Object -ExpandProperty 'Value'\\n\\n        $ArgumentList = $IdentityReference, $ActiveDirectoryRights, $AccessControlType, $ObjectGuid, $ActiveDirectorySecurityInheritance, $InheritedObjectGuid\\n        $ArgumentList = $ArgumentList.Where({ $_ -ne $Null })\\n\\n        Write-Output 'Creating ACL object'\\n        Try {\\n            $Rule = New-Object -TypeName 'System.DirectoryServices.ActiveDirectoryAccessRule' -ArgumentList $ArgumentList -ErrorAction Stop\\n        } Catch [System.Exception] {\\n            Write-Output \\\"Failed to create ACL object $_\\\"\\n            Exit 1\\n        }\\n\\n        Write-Output \\\"Getting ACL for $AclPath\\\"\\n        Try {\\n            $ObjectAcl = Get-Acl -Path \\\"AD:\\\\$AclPath\\\" -ErrorAction Stop\\n        } Catch [System.Exception] {\\n            Write-Output \\\"Failed to get ACL for $AclPath $_\\\"\\n            Exit 1\\n        }\\n\\n        $ObjectAcl.AddAccessRule($Rule) \\n\\n        Write-Output \\\"Setting ACL for $AclPath\\\"\\n        Try {\\n            Set-Acl -AclObject $ObjectAcl -Path \\\"AD:\\\\$AclPath\\\" -ErrorAction Stop\\n        } Catch [System.Exception] {\\n            Write-Output \\\"Failed to set ACL for $AclPath $_\\\"\\n            Exit 1\\n        }\\n    }\\n\\n    If ('{{IntegrateFsxOnprem}}' -eq 'Yes') {\\n        Write-Output 'Getting domain information'\\n        Try {\\n            $Domain = Get-ADDomain -ErrorAction Stop\\n        } Catch [System.Exception] {\\n            Write-Output \\\"Failed to get domain information $_\\\"\\n            Exit 1\\n        }\\n\\n        $FQDN = $Domain | Select-Object -ExpandProperty 'DNSRoot'\\n\\n        $FsxOU = \\\"OU=FSx,{{FsxOnpremParentOu}}\\\"\\n\\n        Write-Output 'Creating OU FSx'\\n        Try {\\n            New-ADOrganizationalUnit -Name 'FSx' -Path '{{FsxOnpremParentOu}}' -ProtectedFromAccidentalDeletion $True -ErrorAction Stop\\n        } Catch [System.Exception] {\\n            Write-Output \\\"Failed to create OU FSx $_\\\"\\n            Exit 1\\n        }\\n\\n        $UserPassword = (Get-SecretInfo -Domain '{{DomainNetBIOSName}}' -SecretArn '{{AdministratorSecretName}}').UserPassword\\n\\n        $User = @{\\n            AccountPassword        = $UserPassword\\n            Name                   = 'FSxServiceAccount'\\n            DisplayName            = 'FSxServiceAccount'\\n            SamAccountName         = 'FSxServiceAccount'\\n            UserPrincipalName      = \\\"FSxServiceAccount@$FQDN\\\"\\n            KerberosEncryptionType = 'AES128', 'AES256'\\n            PasswordNeverExpires   = $True\\n            Enabled                = $True\\n            Path                   = $FsxOU \\n        }\\n\\n        Write-Output 'Creating FSxServiceAccount'\\n        Try {\\n            New-ADUser @User\\n        } Catch [System.Exception] {\\n            Write-Output \\\"Failed to create FSxServiceAccount $_\\\"\\n            Exit 1\\n        }\\n\\n        Write-Output 'Creating FSx Admins Group'\\n        Try {\\n            New-ADGroup -DisplayName 'FSxAdmins' -GroupCategory 'Security' -GroupScope 'DomainLocal' -Name 'FSxAdmins' -Path $FsxOU -SamAccountName 'FSxAdmins'\\n        } Catch [System.Exception] {\\n            Write-Output \\\"Failed to create FSx Admins Group $_\\\"\\n            Exit 1\\n        }\\n\\n        Write-Output 'Getting RootDSE information'\\n        Try {\\n            $RootDse = Get-ADRootDSE -ErrorAction Stop\\n        } Catch [System.Exception] {\\n            Write-Output \\\"Failed to get RootDSE information $_\\\"\\n            Exit 1\\n        }\\n\\n        Write-Output 'Getting computer SchemaNamingContext'\\n        Try {\\n            [System.GUID]$ComputerNameGuid = (Get-ADObject -SearchBase $RootDse.SchemaNamingContext -Filter { lDAPDisplayName -eq 'computer' } -Properties 'schemaIDGUID' -ErrorAction Stop).schemaIDGUID\\n        } Catch [System.Exception] {\\n            Write-Output \\\"Failed to get computer SchemaNamingContext $_\\\"\\n            Exit 1\\n        }\\n\\n        $ExtendedRightsMap = @{ }\\n\\n        Write-Output 'Getting ExtendedRightsMap'\\n        Try {\\n            $ErNamingContexts = Get-ADObject -SearchBase $RootDse.ConfigurationNamingContext -LDAPFilter '(\u0026(objectclass=controlAccessRight)(rightsguid=*))' -Properties displayName, rightsGuid -ErrorAction Stop\\n        } Catch [System.Exception] {\\n            Write-Output \\\"Failed to get ExtendedRightsMap $_\\\"\\n            Exit 1\\n        }\\n\\n        ForEach ($ErNamingContext in $ErNamingContexts) {\\n            $ExtendedRightsMap[$ErNamingContext.displayName] = [System.GUID]$ErNamingContext.rightsGuid\\n        }\\n\\n        $NullGuid = [guid]'00000000-0000-0000-0000-000000000000'\\n\\n        $AclRules = @(\\n            @{\\n                ActiveDirectoryRights              = 'CreateChild, DeleteChild'\\n                AccessControlType                  = 'Allow'\\n                ObjectGUID                         = $ComputerNameGuid\\n                ActiveDirectorySecurityInheritance = 'All'\\n                InheritedObjectGuid                = $NullGuid\\n            },\\n            @{\\n                ActiveDirectoryRights              = 'ExtendedRight'\\n                AccessControlType                  = 'Allow'\\n                ObjectGUID                         = $ExtendedRightsMap['Validated write to service principal name']\\n                ActiveDirectorySecurityInheritance = 'Descendents'\\n                InheritedObjectGuid                = $ComputerNameGuid\\n            },\\n            @{\\n                ActiveDirectoryRights              = 'ExtendedRight'\\n                AccessControlType                  = 'Allow'\\n                ObjectGUID                         = $ExtendedRightsMap['Account Restrictions']\\n                ActiveDirectorySecurityInheritance = 'Descendents'\\n                InheritedObjectGuid                = $ComputerNameGuid\\n            },\\n            @{\\n                ActiveDirectoryRights              = 'ExtendedRight'\\n                AccessControlType                  = 'Allow'\\n                ObjectGUID                         = $ExtendedRightsMap['Reset Password']\\n                ActiveDirectorySecurityInheritance = 'Descendents'\\n                InheritedObjectGuid                = $ComputerNameGuid\\n            },\\n            @{\\n                ActiveDirectoryRights              = 'ExtendedRight'\\n                AccessControlType                  = 'Allow'\\n                ObjectGUID                         = $ExtendedRightsMap['Validated write to DNS host name']\\n                ActiveDirectorySecurityInheritance = 'Descendents'\\n                InheritedObjectGuid                = $ComputerNameGuid\\n            }\\n        )\\n\\n        Write-Output 'Getting FSxServiceAccount SID'\\n        Try {\\n            $IdentityReference = Get-ADUser -Identity 'FSxServiceAccount' -ErrorAction Stop | Select-Object -ExpandProperty 'SID'\\n        } Catch [System.Exception] {\\n            Write-Output \\\"Failed to get FSxServiceAccount SID $_\\\"\\n            Exit 1\\n        }\\n\\n        Foreach ($AclRule in $AclRules) {\\n            Add-FSxOuAcl -AclPath $FsxOU -IdentityReference $IdentityReference -ActiveDirectoryRights $AclRule.ActiveDirectoryRights -AccessControlType $AclRule.AccessControlType -ObjectGUID $AclRule.ObjectGUID -ActiveDirectorySecurityInheritance $AclRule.ActiveDirectorySecurityInheritance -InheritedObjectGuid $AclRule.InheritedObjectGuid\\n        }\\n    }\\n\\n    $TrustDirection = '{{TrustDirection}}'\\n    Switch ($TrustDirection) {\\n        'Two-Way' {\\n            $TrustDirOnprem = 'Bidirectional'\\n        }\\n        'One-Way: Outgoing' {\\n            $TrustDirOnprem = 'Inbound'\\n        }\\n        'One-Way: Incoming' {\\n            $TrustDirOnprem = 'Outbound'\\n        }\\n        Default { Throw 'InvalidArgument: Invalid value is passed for parameter TrustDirection' }\\n    }\\n\\n    $TrustPassword = (Get-SecretInfo -Domain '{{DomainNetBIOSName}}' -SecretArn '{{TrustSecretName}}').UserPassword\\n\\n    Write-Output 'Creating Onprem side of trust.'\\n    Invoke-TrustAction -RemoteFQDN '{{MadDNSName}}' -TrustPassword $TrustPassword $TrustDirOnprem\\n}\\n\\nIf ($DeploymentType -eq 'EnterpriseCAManagementInstance' -or $DeploymentType -eq 'ManagementInstance') {\\n    $IP = '{{VPCCIDR}}'.Split('/')[0]\\n\\n    [System.Collections.ArrayList]$IPArray = $IP -Split \\\"\\\\.\\\"\\n\\n    $VPCDNS = $IPArray[0, 1, 2] + 2 -Join \\\".\\\"\\n\\n    $TrustDirection = '{{TrustDirection}}'\\n    Switch ($TrustDirection) {\\n        'Two-Way' {\\n            $TrustDirMAD = 'Two-Way'\\n        }\\n        'One-Way: Outgoing' {\\n            $TrustDirMAD = 'One-Way: Outgoing'\\n        }\\n        'One-Way: Incoming' {\\n            $TrustDirMAD = 'One-Way: Incoming'\\n        }\\n        Default { Throw 'InvalidArgument: Invalid value is passed for parameter TrustDirection' }\\n    }\\n\\n    $TrustTypeForest = New-Object -TypeName 'Amazon.DirectoryService.TrustType' -ArgumentList 'Forest'\\n    $TrustDir = New-Object -TypeName 'Amazon.DirectoryService.TrustDirection' -ArgumentList $TrustDirMAD\\n    $SelectiveAuthDis = New-Object -TypeName 'Amazon.DirectoryService.SelectiveAuth' -ArgumentList 'Disabled'\\n    $TrustPassword = (Get-SecretInfo -Domain '{{DomainNetBIOSName}}' -SecretArn '{{AdministratorSecretName}}').UserPassword\\n\\n    Write-Output 'Creating trust between MAD and Onprem.'\\n    Try {\\n        $Trust = New-DSTrust -DirectoryId '{{MadDirectoryID}}' -ConditionalForwarderIpAddr $VPCDNS -RemoteDomainName '{{OnpremDomainDNSName}}' -SelectiveAuth $SelectiveAuthDis -TrustDirection $TrustDir -TrustType $TrustTypeForest -TrustPassword $TrustPassword\\n    } Catch [System.Exception] {\\n        Write-Output \\\"Failed to create trust between MAD and Onprem. $_\\\"\\n        Exit 1\\n    }\\n\\n    $Counter = 0\\n    Do {\\n        Try {\\n            $Truststate = Get-DSTrust -DirectoryId '{{MadDirectoryID}}' -TrustId $Trust -ErrorAction SilentlyContinue | Select-Object -ExpandProperty 'TrustState' | Select-Object -ExpandProperty 'Value'\\n        } Catch [System.Exception] {\\n            Write-Output \\\"Failed to get trust state $_\\\"\\n            $Truststate = $Null\\n        }\\n        If ($Truststate -ne 'Verified' -or $Truststate -eq 'Failed') {\\n            $Counter ++\\n            Write-Output 'Trust not Verified, sleeping 10 seconds and will try again.'\\n            Start-Sleep -Seconds 10\\n        }\\n    } Until ($Truststate -eq 'Verified' -or $Truststate -eq 'Failed' -or $Counter -eq 30)\\n\\n    If ($Truststate -eq 'Failed' -or $Counter -eq 30) {\\n        Write-Output 'Trust failed to create or never went Verified in 5 minutes'\\n        Exit 1\\n    }\\n}\"\r\n      },\r\n      \"CloudWatchOutputConfig\" : {\r\n        \"CloudWatchOutputEnabled\" : true,\r\n        \"CloudWatchLogGroupName\" : \"/aws/Demo/{{StackName}}\"\r\n      },\r\n      \"InstanceIds\" : [ \"{{InstanceId.InstanceId}}\" ],\r\n      \"DocumentName\" : \"AWS-RunPowerShellScript\"\r\n    },\r\n    \"name\" : \"configureInstance\",\r\n    \"action\" : \"aws:runCommand\",\r\n    \"onFailure\" : \"step:signalFailure\",\r\n    \"nextStep\" : \"DeployPKI\"\r\n  }, {\r\n    \"inputs\" : {\r\n      \"Choices\" : [ {\r\n        \"StringEquals\" : \"Yes\",\r\n        \"Variable\" : \"{{DeployPki}}\",\r\n        \"NextStep\" : \"runPkiSsmAuto\"\r\n      }, {\r\n        \"StringEquals\" : \"No\",\r\n        \"Variable\" : \"{{DeployPki}}\",\r\n        \"NextStep\" : \"runAuditPolSsmAuto\"\r\n      } ]\r\n    },\r\n    \"name\" : \"DeployPKI\",\r\n    \"action\" : \"aws:branch\"\r\n  }, {\r\n    \"inputs\" : {\r\n      \"RuntimeParameters\" : {\r\n        \"ServerNetBIOSName\" : [ \"{{ServerNetBIOSName}}\" ],\r\n        \"DomainType\" : [ \"{{DomainType}}\" ],\r\n        \"DomainNetBIOSName\" : [ \"{{DomainNetBIOSName}}\" ],\r\n        \"VPCCIDR\" : [ \"{{VPCCIDR}}\" ],\r\n        \"AdministratorSecretName\" : [ \"{{AdministratorSecretName}}\" ],\r\n        \"DeploymentType\" : [ \"{{DeploymentType}}\" ],\r\n        \"StackName\" : [ \"{{StackName}}\" ]\r\n      },\r\n      \"DocumentName\" : \"SSM-Pki-dnb6z912\"\r\n    },\r\n    \"name\" : \"runPkiSsmAuto\",\r\n    \"action\" : \"aws:executeAutomation\",\r\n    \"onFailure\" : \"step:signalFailure\",\r\n    \"nextStep\" : \"runAuditPolSsmAuto\"\r\n  }, {\r\n    \"inputs\" : {\r\n      \"RuntimeParameters\" : {\r\n        \"ServerNetBIOSName\" : [ \"{{ServerNetBIOSName}}\" ],\r\n        \"ServerRole\" : [ \"{{ServerRole}}\" ],\r\n        \"VPCCIDR\" : [ \"{{VPCCIDR}}\" ],\r\n        \"StackName\" : [ \"{{StackName}}\" ]\r\n      },\r\n      \"DocumentName\" : \"SSM-AuditPol-dnb6z912\"\r\n    },\r\n    \"name\" : \"runAuditPolSsmAuto\",\r\n    \"action\" : \"aws:executeAutomation\",\r\n    \"onFailure\" : \"step:signalFailure\"\r\n  }, {\r\n    \"inputs\" : {\r\n      \"Choices\" : [ {\r\n        \"Not\" : {\r\n          \"StringEquals\" : \"\",\r\n          \"Variable\" : \"{{StackName}}\"\r\n        },\r\n        \"NextStep\" : \"signalSuccess\"\r\n      }, {\r\n        \"StringEquals\" : \"\",\r\n        \"Variable\" : \"{{StackName}}\",\r\n        \"NextStep\" : \"sleepEnd\"\r\n      } ]\r\n    },\r\n    \"name\" : \"cfnSignalEnd\",\r\n    \"action\" : \"aws:branch\"\r\n  }, {\r\n    \"inputs\" : {\r\n      \"Status\" : \"SUCCESS\",\r\n      \"UniqueId\" : \"{{InstanceId.InstanceId}}\",\r\n      \"LogicalResourceId\" : \"{{LogicalResourceId}}\",\r\n      \"Service\" : \"cloudformation\",\r\n      \"Api\" : \"SignalResource\",\r\n      \"StackName\" : \"{{StackName}}\"\r\n    },\r\n    \"name\" : \"signalSuccess\",\r\n    \"action\" : \"aws:executeAwsApi\",\r\n    \"isEnd\" : true\r\n  }, {\r\n    \"inputs\" : {\r\n      \"Duration\" : \"PT1S\"\r\n    },\r\n    \"name\" : \"sleepEnd\",\r\n    \"action\" : \"aws:sleep\",\r\n    \"isEnd\" : true\r\n  }, {\r\n    \"inputs\" : {\r\n      \"Status\" : \"FAILURE\",\r\n      \"UniqueId\" : \"{{InstanceId.InstanceId}}\",\r\n      \"LogicalResourceId\" : \"{{LogicalResourceId}}\",\r\n      \"Service\" : \"cloudformation\",\r\n      \"Api\" : \"SignalResource\",\r\n      \"StackName\" : \"{{StackName}}\"\r\n    },\r\n    \"name\" : \"signalFailure\",\r\n    \"action\" : \"aws:executeAwsApi\"\r\n  } ]\r\n}\r\n",
            "created_date": "2022-07-12T02:29:27Z",
            "default_version": "1",
            "description": "Deploy AD with SSM Automation",
            "document_format": "JSON",
            "document_type": "Automation",
            "document_version": "1",
            "hash": "743229c72e70e2cbb831a7b214ef98f2096aa2650ac88f04bcd21bdc01f920e7",
            "hash_type": "Sha256",
            "id": "SSM-Baseline-dnb6z912",
            "latest_version": "1",
            "name": "SSM-Baseline-dnb6z912",
            "owner": "156285977455",
            "parameter": [
              {
                "default_value": "",
                "description": "Role server will be (DomainController or CertificateAuthority)",
                "name": "ServerRole",
                "type": "String"
              },
              {
                "default_value": "placeholder",
                "description": "Trust Direction from AWS Managed Microsoft AD to on-premises domain.",
                "name": "TrustDirection",
                "type": "String"
              },
              {
                "default_value": "",
                "description": "Fully qualified domain name (FQDN) of the forest root domain e.g. onpremises.local",
                "name": "DomainDNSName",
                "type": "String"
              },
              {
                "default_value": "placeholder",
                "description": "Directory ID of MAD domain",
                "name": "MadDirectoryID",
                "type": "String"
              },
              {
                "default_value": "",
                "description": "NetBIOS name of the domain (up to 15 characters) for users of earlier versions of Windows e.g. ONPREMISES",
                "name": "DomainNetBIOSName",
                "type": "String"
              },
              {
                "default_value": "placeholder",
                "description": "Parent OU DN for Amazon FSX for Windows deployment with On-Premises AD",
                "name": "FsxOnpremParentOu",
                "type": "String"
              },
              {
                "default_value": "",
                "description": "Type of workload being deployed",
                "name": "DeploymentType",
                "type": "String"
              },
              {
                "default_value": "placeholder",
                "description": "AWS Secrets Parameter Name",
                "name": "TrustSecretName",
                "type": "String"
              },
              {
                "default_value": "",
                "description": "NetBIOS name of the first Active Directory Domain Controller (up to 15 characters)",
                "name": "ServerNetBIOSName",
                "type": "String"
              },
              {
                "default_value": "",
                "description": "CloudFormation Resource ID",
                "name": "LogicalResourceId",
                "type": "String"
              },
              {
                "default_value": "placeholder",
                "description": "Type of domain PKI will be integrated with",
                "name": "DomainType",
                "type": "String"
              },
              {
                "default_value": "placeholder",
                "description": "Fully qualified domain name (FQDN) of the MAD domain e.g. corp.example.com",
                "name": "MadDNSName",
                "type": "String"
              },
              {
                "default_value": "",
                "description": "CIDR Block for the VPC",
                "name": "VPCCIDR",
                "type": "String"
              },
              {
                "default_value": "placeholder",
                "description": "Fully qualified domain name (FQDN) of the forest root domain e.g. onpremises.local",
                "name": "ParentDomainDNSName",
                "type": "String"
              },
              {
                "default_value": "",
                "description": "AWS Secrets Parameter Name",
                "name": "AdministratorSecretName",
                "type": "String"
              },
              {
                "default_value": "placeholder",
                "description": "Deploy \u0026 Integrate Amazon FSX for Windows with On-Premises AD",
                "name": "IntegrateFsxOnprem",
                "type": "String"
              },
              {
                "default_value": "",
                "description": "Deploy an Enterprise CA",
                "name": "DeployPki",
                "type": "String"
              },
              {
                "default_value": "placeholder",
                "description": "Fully qualified domain name (FQDN) of the forest root domain e.g. example.com",
                "name": "OnpremDomainDNSName",
                "type": "String"
              },
              {
                "default_value": "",
                "description": "Stack Name Input for cfn resource signal",
                "name": "StackName",
                "type": "String"
              },
              {
                "default_value": "placeholder",
                "description": "IP Address of the forest root domain controller",
                "name": "ParentInstanceIP",
                "type": "String"
              }
            ],
            "permissions": null,
            "platform_types": [
              "Windows",
              "Linux",
              "MacOS"
            ],
            "schema_version": "0.3",
            "status": "Active",
            "tags": null,
            "tags_all": {},
            "target_type": "",
            "version_name": ""
          },
          "sensitive_attributes": [],
          "private": "bnVsbA==",
          "dependencies": [
            "aws_ssm_document.ssm_auditpol",
            "aws_ssm_document.ssm_pki",
            "random_string.random_string"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_ssm_document",
      "name": "ssm_pki",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "arn": "arn:aws:ssm:us-east-2:156285977455:document/SSM-Pki-dnb6z912",
            "attachments_source": [],
            "content": "{\r\n  \"schemaVersion\" : \"0.3\",\r\n  \"description\" : \"Deploy Enterpise CA\",\r\n  \"parameters\" : {\r\n    \"ServerNetBIOSName\" : {\r\n      \"description\" : \"NetBIOS name of the first Active Directory Domain Controller (up to 15 characters)\",\r\n      \"type\" : \"String\"\r\n    },\r\n    \"DomainType\" : {\r\n      \"description\" : \"Type of domain PKI will be integrated with\",\r\n      \"type\" : \"String\"\r\n    },\r\n    \"DomainNetBIOSName\" : {\r\n      \"description\" : \"NetBIOS name of the domain (up to 15 characters) for users of earlier versions of Windows e.g. ONPREMISES\",\r\n      \"type\" : \"String\"\r\n    },\r\n    \"VPCCIDR\" : {\r\n      \"description\" : \"CIDR Block for the VPC\",\r\n      \"type\" : \"String\"\r\n    },\r\n    \"AdministratorSecretName\" : {\r\n      \"description\" : \"AWS Secrets Parameter Name\",\r\n      \"type\" : \"String\"\r\n    },\r\n    \"DeploymentType\" : {\r\n      \"description\" : \"Type of workload being deployed\",\r\n      \"type\" : \"String\"\r\n    },\r\n    \"StackName\" : {\r\n      \"description\" : \"Stack Name Input for cfn resource signal\",\r\n      \"type\" : \"String\"\r\n    }\r\n  },\r\n  \"mainSteps\" : [ {\r\n    \"outputs\" : [ {\r\n      \"Type\" : \"String\",\r\n      \"Name\" : \"InstanceId\",\r\n      \"Selector\" : \"$.Reservations[0].Instances[0].InstanceId\"\r\n    } ],\r\n    \"inputs\" : {\r\n      \"Filters\" : [ {\r\n        \"Values\" : [ \"{{ServerNetBIOSName}}\" ],\r\n        \"Name\" : \"tag:Name\"\r\n      }, {\r\n        \"Values\" : [ \"{{StackName}}\" ],\r\n        \"Name\" : \"tag:aws:cloudformation:stack-name\"\r\n      }, {\r\n        \"Values\" : [ \"running\" ],\r\n        \"Name\" : \"instance-state-name\"\r\n      } ],\r\n      \"Service\" : \"ec2\",\r\n      \"Api\" : \"DescribeInstances\"\r\n    },\r\n    \"name\" : \"InstanceId\",\r\n    \"action\" : \"aws:executeAwsApi\",\r\n    \"nextStep\" : \"configureInstance\"\r\n  }, {\r\n    \"inputs\" : {\r\n      \"Parameters\" : {\r\n        \"commands\" : \"Function Get-SecretInfo {\\n    [CmdletBinding()]\\n    Param (\\n        [Parameter(Mandatory = $True)][String]$Domain,\\n        [Parameter(Mandatory = $True)][String]$SecretArn\\n    )\\n\\n    Write-Output \\\"Getting $SecretArn Secret\\\"\\n    Try {\\n        $SecretContent = Get-SECSecretValue -SecretId $SecretArn -ErrorAction Stop | Select-Object -ExpandProperty 'SecretString' | ConvertFrom-Json -ErrorAction Stop\\n    } Catch [System.Exception] {\\n        Write-Output \\\"Failed to get $SecretArn Secret $_\\\"\\n        Exit 1\\n    }\\n\\n    Write-Output 'Creating PSCredential object from Secret'\\n    $Username = $SecretContent.username\\n    $UserPassword = ConvertTo-SecureString ($SecretContent.password) -AsPlainText -Force\\n    $DomainCredentials = New-Object -TypeName 'System.Management.Automation.PSCredential' (\\\"$Domain\\\\$Username\\\", $UserPassword)\\n    $Credentials = New-Object -TypeName 'System.Management.Automation.PSCredential' ($Username, $UserPassword)\\n\\n    $Output = [PSCustomObject][Ordered]@{\\n        'Credentials'       = $Credentials\\n        'DomainCredentials' = $DomainCredentials\\n        'Username'          = $Username\\n        'UserPassword'      = $UserPassword\\n    }\\n\\n    Return $Output\\n}\\n\\nFunction Invoke-EnterpriseCaConfig {\\n    [CmdletBinding()]\\n    Param (\\n        [Parameter(Mandatory = $true)][System.Management.Automation.PSCredential]$Credentials,\\n        [Parameter(Mandatory = $true)][String]$DomainType,\\n        [Parameter(Mandatory = $true)][String]$EntCaCommonName,\\n        [Parameter(Mandatory = $true)][ValidateSet('SHA256', 'SHA384', 'SHA512')][String]$EntCaHashAlgorithm,\\n        [Parameter(Mandatory = $true)][ValidateSet('2048', '4096')][String]$EntCaKeyLength,\\n        [Parameter(Mandatory = $true)][String]$EntCaValidityPeriodUnits,\\n        [Parameter(Mandatory = $true)][String]$VPCCIDR\\n    )\\n\\n    $CompName = $env:COMPUTERNAME\\n    $Folders = @(\\n        'D:\\\\Pki\\\\Req',\\n        'D:\\\\ADCS\\\\DB',\\n        'D:\\\\ADCS\\\\Log'\\n    )\\n    $FilePath = 'D:\\\\Pki'\\n    $Principals = @(\\n        'ANONYMOUS LOGON',\\n        'EVERYONE'\\n    )\\n\\n    Write-Output 'Installing Windows Features'\\n    Try {\\n        Install-WindowsFeature -Name 'Adcs-Cert-Authority', 'RSAT-AD-Tools', 'RSAT-DNS-Server', 'Web-WebServer' -IncludeManagementTools -ErrorAction Stop\\n    } Catch [System.Exception] {\\n        Write-Output \\\"Failed to install Windows Features $_\\\"\\n        Exit 1\\n    }\\n\\n    Write-Output 'Getting AD domain'\\n    Try {\\n        $Domain = Get-ADDomain -ErrorAction Stop\\n    } Catch [System.Exception] {\\n        Write-Output \\\"Failed to get AD domain $_\\\"\\n        Exit 1\\n    }\\n    $BaseDn = $Domain | Select-Object -ExpandProperty 'DistinguishedName'\\n    $FQDN = $Domain | Select-Object -ExpandProperty 'DNSRoot'\\n    $Netbios = $Domain | Select-Object -ExpandProperty 'NetBIOSName'\\n\\n    Write-Output 'Getting a domain controller to perform actions against'\\n    Try {\\n        $DC = Get-ADDomainController -Discover -ForceDiscover -ErrorAction Stop | Select-Object -ExpandProperty 'HostName'\\n    } Catch [System.Exception] {\\n        Write-Output \\\"Failed to get a domain controller $_\\\"\\n        Exit 1\\n    }\\n\\n    $Counter = 0\\n    Do {\\n        $ARecordPresent = Resolve-DnsName -Name \\\"$CompName.$FQDN\\\" -DnsOnly -Server $DC -ErrorAction SilentlyContinue\\n        If (-not $ARecordPresent) {\\n            $Counter ++\\n            Write-Output 'A record missing, registering it.'\\n            Register-DnsClient\\n            If ($Counter -gt '1') {\\n                Start-Sleep -Seconds 10\\n            }\\n        }\\n    } Until ($ARecordPresent -or $Counter -eq 12)\\n\\n    If ($Counter -ge 12) {\\n        Write-Output 'A record never created'\\n        Exit 1\\n    }\\n\\n    If ($DomainType -eq 'AWSManagedAD') {\\n        Set-CredSSP -Action 'Enable'\\n    }\\n\\n    Write-Output 'Creating PKI CNAME record'\\n    $Counter = 0\\n    Do {\\n        $CnameRecordPresent = Resolve-DnsName -Name \\\"PKI.$FQDN\\\" -DnsOnly -Server $DC -ErrorAction SilentlyContinue\\n        If (-not $CnameRecordPresent) {\\n            $Counter ++\\n            Write-Output 'CNAME record missing, creating it'\\n            $HostNameAlias = \\\"$CompName.$FQDN\\\"\\n            If ($DomainType -eq 'AWSManagedAD') {\\n                Invoke-Command -Authentication 'CredSSP' -ComputerName $env:COMPUTERNAME -Credential $Credentials -ScriptBlock { Add-DnsServerResourceRecordCName -Name 'PKI' -ComputerName $using:DC -HostNameAlias $using:HostNameAlias -ZoneName $using:FQDN }\\n            } Else {\\n                Invoke-Command -ComputerName $DC -Credential $Credentials -ScriptBlock { Add-DnsServerResourceRecordCName -Name 'PKI' -HostNameAlias $using:HostNameAlias -ZoneName $using:FQDN }\\n            }\\n\\n            If ($Counter -gt '1') {\\n                Start-Sleep -Seconds 10\\n            }\\n        }\\n    } Until ($CnameRecordPresent -or $Counter -eq 12)\\n\\n    If ($DomainType -eq 'AWSManagedAD') {  \\n        Set-CredSSP -Action 'Disable'\\n    }\\n\\n    If ($Counter -ge 12) {\\n        Write-Output 'CNAME record never created'\\n        Exit 1\\n    }\\n\\n    Write-Output 'Creating PKI folders'\\n    Foreach ($Folder in $Folders) {\\n        $PathPresent = Test-Path -Path $Folder -ErrorAction SilentlyContinue\\n        If (-not $PathPresent) {\\n            Try {\\n                $Null = New-Item -Path $Folder -Type 'Directory' -ErrorAction Stop\\n            } Catch [System.Exception] {\\n                Write-Output \\\"Failed to create $Folder directory $_\\\"\\n                Exit 1\\n            }\\n        } \\n    }\\n\\n    Write-Output 'Example CPS statement' | Out-File 'D:\\\\Pki\\\\cps.txt'\\n\\n    Write-Output 'Sharing PKI folder'\\n    $SharePresent = Get-SmbShare -Name 'Pki' -ErrorAction SilentlyContinue\\n    If (-not $SharePresent) {\\n        Try {\\n            $Null = New-SmbShare -Name 'Pki' -Path 'D:\\\\Pki' -FullAccess 'SYSTEM', \\\"$Netbios\\\\Domain Admins\\\" -ChangeAccess \\\"$Netbios\\\\Cert Publishers\\\" -ErrorAction Stop\\n        } Catch [System.Exception] {\\n            Write-Output \\\"Failed to create PKI SMB Share $_\\\"\\n            Exit 1\\n        }\\n    }\\n\\n    Write-Output 'Creating PKI IIS virtual directory'\\n    $VdPresent = Get-WebVirtualDirectory -Name 'Pki'\\n    If (-not $VdPresent) {\\n        Try {\\n            $Null = New-WebVirtualDirectory -Site 'Default Web Site' -Name 'Pki' -PhysicalPath 'D:\\\\Pki' -ErrorAction Stop\\n        } Catch [System.Exception] {\\n            Write-Output \\\"Failed to create PKI IIS virtual directory $_\\\"\\n            Exit 1\\n        }\\n    }\\n\\n    Write-Output 'Setting PKI IIS virtual directory requestFiltering'\\n    Try {\\n        Set-WebConfigurationProperty -Filter '/system.webServer/security/requestFiltering' -Name 'allowDoubleEscaping' -Value 'true' -PSPath 'IIS:\\\\Sites\\\\Default Web Site\\\\Pki' -ErrorAction Stop\\n    } Catch [System.Exception] {\\n        Write-Output \\\"Failed to set PKI IIS virtual directory requestFiltering $_\\\"\\n        Exit 1\\n    }\\n\\n    Write-Output 'Setting PKI IIS virtual directory directoryBrowse'\\n    Try {\\n        Set-WebConfigurationProperty -Filter '/system.webServer/directoryBrowse' -Name 'enabled' -Value 'true' -PSPath 'IIS:\\\\Sites\\\\Default Web Site\\\\Pki' -ErrorAction Stop\\n    } Catch [System.Exception] {\\n        Write-Output \\\"Failed to set PKI IIS virtual directory directoryBrowse $_\\\"\\n        Exit 1\\n    }\\n\\n    Write-Output 'Setting PKI folder file system ACLs'\\n    Foreach ($Princ in $Principals) {\\n        $Principal = New-Object -TypeName 'System.Security.Principal.NTAccount'($Princ)\\n        $Perms = [System.Security.AccessControl.FileSystemRights]'Read, ReadAndExecute, ListDirectory'\\n        $Inheritance = [System.Security.AccessControl.InheritanceFlags]::'ContainerInherit', 'ObjectInherit'\\n        $Propagation = [System.Security.AccessControl.PropagationFlags]::'None'\\n        $Access = [System.Security.AccessControl.AccessControlType]::'Allow'\\n        $AccessRule = New-Object -TypeName 'System.Security.AccessControl.FileSystemAccessRule'($Principal, $Perms, $Inheritance, $Propagation, $Access) \\n        Try {\\n            $Acl = Get-Acl -Path $FilePath -ErrorAction Stop\\n        } Catch [System.Exception] {\\n            Write-Output \\\"Failed to get ACL for PKI directory $_\\\"\\n            Exit 1\\n        }\\n        $Acl.AddAccessRule($AccessRule)\\n        Try {\\n            Set-Acl -Path $FilePath -AclObject $Acl -ErrorAction Stop\\n        } Catch [System.Exception] {\\n            Write-Output \\\"Failed to set ACL for PKI directory $_\\\"\\n            Exit 1\\n        }\\n    }\\n\\n    Write-Output 'Resetting IIS service'\\n    Try {\\n        \u0026 iisreset.exe \u003e $null\\n    } Catch [System.Exception] {\\n        Write-Output \\\"Failed to reset IIS service $_\\\"\\n        Exit 1\\n    }\\n\\n    $URL = \\\"URL=http://$CompName.$FQDN/pki/cps.txt\\\"\\n\\n    $Inf = @(\\n        '[Version]',\\n        'Signature=\\\"$Windows NT$\\\"',\\n        '[PolicyStatementExtension]',\\n        'Policies=InternalPolicy',\\n        '[InternalPolicy]',\\n        'OID=1.2.3.4.1455.67.89.5', \\n        'Notice=\\\"Legal Policy Statement\\\"',\\n        $URL\\n        '[Certsrv_Server]',\\n        \\\"RenewalKeyLength=$EntCaKeyLength\\\",\\n        'RenewalValidityPeriod=Years',\\n        \\\"RenewalValidityPeriodUnits=$EntCaValidityPeriodUnits\\\",\\n        'CRLPeriod=Weeks',\\n        'CRLPeriodUnits=1',\\n        'CRLDeltaPeriod=Days',  \\n        'CRLDeltaPeriodUnits=0',\\n        'LoadDefaultTemplates=0',\\n        'AlternateSignatureAlgorithm=0',\\n        '[CRLDistributionPoint]',\\n        '[AuthorityInformationAccess]'\\n    )\\n\\n    Write-Output 'Creating CAPolicy.inf'\\n    Try {\\n        $Inf | Out-File -FilePath 'C:\\\\Windows\\\\CAPolicy.inf' -Encoding 'ascii'\\n    } Catch [System.Exception] {\\n        Write-Output \\\"Failed to create CAPolicy.inf $_\\\"\\n        Exit 1\\n    }\\n\\n    Write-Output 'Installing Enterprise Root CA'\\n    Try {\\n        $Null = Install-AdcsCertificationAuthority -CAType 'EnterpriseRootCA' -CACommonName $EntCaCommonName -KeyLength $EntCaKeyLength -HashAlgorithm $EntCaHashAlgorithm -CryptoProviderName 'RSA#Microsoft Software Key Storage Provider' -ValidityPeriod 'Years' -ValidityPeriodUnits $EntCaValidityPeriodUnits -DatabaseDirectory 'D:\\\\ADCS\\\\DB' -LogDirectory 'D:\\\\ADCS\\\\Log' -Force -ErrorAction Stop -Credential $Credentials\\n    } Catch [System.Exception] {\\n        Write-Output \\\"Failed to install Enterprise Root CA $_\\\"\\n        Exit 1\\n    }\\n\\n    $CDP = \\\"http://$CompName.$FQDN/pki/\u003cCaName\u003e\u003cCRLNameSuffix\u003e\u003cDeltaCRLAllowed\u003e.crl\\\"\\n    $AIA = \\\"http://$CompName.$FQDN/pki/\u003cServerDNSName\u003e_\u003cCaName\u003e\u003cCertificateName\u003e.crt\\\"\\n\\n    Write-Output 'Configuring CRL distro points'\\n    Try {\\n        $Null = Get-CACRLDistributionPoint | Where-Object { $_.Uri -like '*ldap*' -or $_.Uri -like '*http*' -or $_.Uri -like '*file*' } -ErrorAction Stop | Remove-CACRLDistributionPoint -Force -ErrorAction Stop\\n        $Null = Add-CACRLDistributionPoint -Uri $CDP -AddToCertificateCDP -Force -ErrorAction Stop\\n    } Catch [System.Exception] {\\n        Write-Output \\\"Failed to configure CRL Distro $_\\\"\\n        Exit 1\\n    }\\n\\n    Write-Output 'Configuring AIA distro points'\\n    Try {\\n        $Null = Get-CAAuthorityInformationAccess | Where-Object { $_.Uri -like '*ldap*' -or $_.Uri -like '*http*' -or $_.Uri -like '*file*' } -ErrorAction Stop | Remove-CAAuthorityInformationAccess -Force -ErrorAction Stop\\n        $Null = Add-CAAuthorityInformationAccess -AddToCertificateAia -Uri $AIA -Force -ErrorAction Stop\\n    } Catch [System.Exception] {\\n        Write-Output \\\"Failed to configure AIA Distro $_\\\"\\n        Exit 1\\n    }\\n\\n    Write-Output 'Configuring Enterprise CA'\\n    \u0026 certutil.exe -setreg CA\\\\CRLOverlapPeriodUnits '12' \u003e $null\\n    \u0026 certutil.exe -setreg CA\\\\CRLOverlapPeriod 'Hours' \u003e $null\\n    \u0026 certutil.exe -setreg CA\\\\ValidityPeriodUnits '5' \u003e $null\\n    \u0026 certutil.exe -setreg CA\\\\ValidityPeriod 'Years' \u003e $null\\n    \u0026 certutil.exe -setreg CA\\\\AuditFilter '127' \u003e $null\\n    \u0026 auditpol.exe /set /subcategory:'Certification Services' /failure:enable /success:enable \u003e $null\\n\\n    Write-Output 'Restarting CA service'\\n    Try {\\n        Restart-Service -Name 'certsvc' -ErrorAction Stop\\n    } Catch [System.Exception] {\\n        Write-Output \\\"Failed to restart CA service $_\\\"\\n        Exit 1\\n    }\\n\\n    Start-Sleep -Seconds 10\\n\\n    Write-Output 'Publishing CRL'\\n    \u0026 certutil.exe -crl \u003e $null\\n\\n    Write-Output 'Copying CRL to PKI folder'\\n    Try {\\n        Copy-Item -Path 'C:\\\\Windows\\\\System32\\\\CertSrv\\\\CertEnroll\\\\*.cr*' -Destination 'D:\\\\Pki\\\\' -ErrorAction Stop\\n    } Catch [System.Exception] {\\n        Write-Output \\\"Failed to copy CRL to PKI folder  $_\\\"\\n        Exit 1\\n    }\\n\\n    Write-Output 'Restarting CA service'\\n    Try {\\n        Restart-Service -Name 'certsvc' -ErrorAction Stop\\n    } Catch [System.Exception] {\\n        Write-Output \\\"Failed to restart CA service $_\\\"\\n    }\\n\\n    Write-Output 'Creating LdapOverSSL certificate template'\\n    New-KerbCertTemplate -BaseDn $BaseDn -Credential $Credentials -Server $DC\\n\\n    If ($DomainType -eq 'SelfManagedAD') {  \\n        Write-Output 'Getting domain controllers'\\n        Try {\\n            $DomainControllers = Get-ADComputer -SearchBase \\\"OU=Domain Controllers,$BaseDn\\\" -Filter * | Select-Object -ExpandProperty 'DNSHostName'\\n        } Catch [System.Exception] {\\n            Write-Output \\\"Failed to get domain controllers $_\\\"\\n        }\\n\\n        Write-Output 'Running Group Policy update on all domain controllers'\\n        Foreach ($DomainController in $DomainControllers) {\\n            Invoke-Command -ComputerName $DomainController -Credential $Credentials -ScriptBlock { Invoke-GPUpdate -RandomDelayInMinutes '0' -Force }\\n        }\\n    }\\n\\n    Write-Output 'Creating Update CRL scheduled task'\\n    Try {\\n        $ScheduledTaskAction = New-ScheduledTaskAction -Execute 'PowerShell.exe' -Argument '\u0026 certutil.exe -crl; Copy-Item -Path C:\\\\Windows\\\\System32\\\\CertSrv\\\\CertEnroll\\\\*.cr* -Destination D:\\\\Pki\\\\'\\n        $ScheduledTaskTrigger = New-ScheduledTaskTrigger -Daily -DaysInterval '5' -At '12am' -ErrorAction Stop\\n        $ScheduledTaskPrincipal = New-ScheduledTaskPrincipal -UserId 'SYSTEM' -LogonType 'ServiceAccount' -RunLevel 'Highest' -ErrorAction Stop\\n        $ScheduledTaskSettingsSet = New-ScheduledTaskSettingsSet -AllowStartIfOnBatteries -Compatibility 'Win8' -ExecutionTimeLimit (New-TimeSpan -Hours '1') -ErrorAction Stop\\n        $ScheduledTask = New-ScheduledTask -Action $ScheduledTaskAction -Principal $ScheduledTaskPrincipal -Trigger $ScheduledTaskTrigger -Settings $ScheduledTaskSettingsSet -Description 'Updates CRL to Local Pki Folder' -ErrorAction Stop\\n        $Null = Register-ScheduledTask 'Update CRL' -InputObject $ScheduledTask -ErrorAction Stop\\n    } Catch [System.Exception] {\\n        Write-Output \\\"Failed to register Update CRL scheduled task $_\\\"\\n    }\\n\\n    Write-Output 'Running CRL scheduled task'\\n    Try {\\n        Start-ScheduledTask -TaskName 'Update CRL' -ErrorAction Stop\\n    } Catch [System.Exception] {\\n        Write-Output \\\"Failed to run CRL scheduled task $_\\\"\\n    }\\n\\n    Write-Output 'Restarting CA service'\\n    Try {\\n        Restart-Service -Name 'certsvc' -ErrorAction Stop\\n    } Catch [System.Exception] {\\n        Write-Output \\\"Failed to restart CA service $_\\\"\\n    }\\n\\n    Write-Output 'Setting Windows Firewall WinRM Public rule to allow VPC CIDR traffic'\\n    Try {\\n        Set-NetFirewallRule -Name 'WINRM-HTTP-In-TCP-PUBLIC' -RemoteAddress $VPCCIDR -ErrorAction Stop\\n    } Catch [System.Exception] {\\n        Write-Output \\\"Failed to allow WinRM traffic from VPC CIDR $_\\\"\\n    }\\n}\\n\\nFunction Set-CredSSP {\\n    [CmdletBinding()]\\n    param(\\n        [Parameter(Mandatory = $true)][ValidateSet('Enable', 'Disable')][string]$Action\\n    )\\n\\n    $RootKey = 'HKEY_LOCAL_MACHINE\\\\SOFTWARE\\\\Policies\\\\Microsoft\\\\Windows'\\n    $CredDelKey = 'CredentialsDelegation'\\n    $FreshCredKey = 'AllowFreshCredentials'\\n    $FreshCredKeyNTLM = 'AllowFreshCredentialsWhenNTLMOnly'\\n\\n    Switch ($Action) {\\n        'Enable' {\\n            Write-Output 'Enabling CredSSP'\\n            $CredDelKeyPresent = Test-Path -Path (Join-Path -Path \\\"Registry::$RootKey\\\" -ChildPath $CredDelKey) -ErrorAction SilentlyContinue\\n            If (-not $CredDelKeyPresent) {\\n                Write-Output \\\"Setting CredSSP registry entry $CredDelKey\\\"\\n                Try {\\n                    $CredDelPath = New-Item -Path \\\"Registry::$RootKey\\\" -Name $CredDelKey -ErrorAction Stop | Select-Object -ExpandProperty 'Name'\\n                } Catch [System.Exception] {\\n                    Write-Output \\\"Failed to create CredSSP registry entry $CredDelKey $_\\\"\\n                    Remove-Item -Path (Join-Path -Path \\\"Registry::$RootKey\\\" -ChildPath $CredDelKey) -Force -Recurse\\n                    Exit 1\\n                }\\n            } Else {\\n                $CredDelPath = Join-Path -Path $RootKey -ChildPath $CredDelKey\\n            }\\n\\n            $FreshCredKeyPresent = Test-Path -Path (Join-Path -Path \\\"Registry::$CredDelPath\\\" -ChildPath $FreshCredKey) -ErrorAction SilentlyContinue\\n            If (-not $FreshCredKeyPresent) {\\n                Write-Output \\\"Setting CredSSP registry entry $FreshCredKey\\\"\\n                Try {\\n                    $FreshCredKeyPath = New-Item -Path \\\"Registry::$CredDelPath\\\" -Name $FreshCredKey -ErrorAction Stop | Select-Object -ExpandProperty 'Name'\\n                } Catch [System.Exception] {\\n                    Write-Output \\\"Failed to create CredSSP registry entry $FreshCredKey $_\\\"\\n                    Remove-Item -Path (Join-Path -Path \\\"Registry::$RootKey\\\" -ChildPath $CredDelKey) -Force -Recurse\\n                    Exit 1\\n                }\\n            } Else {\\n                $FreshCredKeyPath = Join-Path -Path $CredDelPath -ChildPath $FreshCredKey\\n            }\\n\\n            $FreshCredKeyNTLMPresent = Test-Path -Path (Join-Path -Path \\\"Registry::$CredDelPath\\\" -ChildPath $FreshCredKeyNTLM) -ErrorAction SilentlyContinue\\n            If (-not $FreshCredKeyNTLMPresent) {\\n                Write-Output \\\"Setting CredSSP registry entry $FreshCredKeyNTLM\\\"\\n                Try {\\n                    $FreshCredKeyNTLMPath = New-Item -Path \\\"Registry::$CredDelPath\\\" -Name $FreshCredKeyNTLM -ErrorAction Stop | Select-Object -ExpandProperty 'Name'\\n                } Catch [System.Exception] {\\n                    Write-Output \\\"Failed to create CredSSP registry entry $FreshCredKeyNTLM $_\\\"\\n                    Remove-Item -Path (Join-Path -Path \\\"Registry::$RootKey\\\" -ChildPath $CredDelKey) -Force -Recurse\\n                    Exit 1\\n                }\\n            } Else {\\n                $FreshCredKeyNTLMPath = Join-Path -Path $CredDelPath -ChildPath $FreshCredKeyNTLM\\n            }\\n\\n            Try {\\n                $Null = Set-ItemProperty -Path \\\"Registry::$CredDelPath\\\" -Name 'AllowFreshCredentials' -Value '1' -Type 'Dword' -Force -ErrorAction Stop\\n                $Null = Set-ItemProperty -Path \\\"Registry::$CredDelPath\\\" -Name 'ConcatenateDefaults_AllowFresh' -Value '1' -Type 'Dword' -Force -ErrorAction Stop\\n                $Null = Set-ItemProperty -Path \\\"Registry::$CredDelPath\\\" -Name 'AllowFreshCredentialsWhenNTLMOnly' -Value '1' -Type 'Dword' -Force -ErrorAction Stop\\n                $Null = Set-ItemProperty -Path \\\"Registry::$CredDelPath\\\" -Name 'ConcatenateDefaults_AllowFreshNTLMOnly' -Value '1' -Type 'Dword' -Force -ErrorAction Stop\\n                $Null = Set-ItemProperty -Path \\\"Registry::$FreshCredKeyPath\\\" -Name '1' -Value 'WSMAN/*' -Type 'String' -Force -ErrorAction Stop\\n                $Null = Set-ItemProperty -Path \\\"Registry::$FreshCredKeyNTLMPath\\\" -Name '1' -Value 'WSMAN/*' -Type 'String' -Force -ErrorAction Stop\\n            } Catch [System.Exception] {\\n                Write-Output \\\"Failed to create CredSSP registry properties $_\\\"\\n                Remove-Item -Path (Join-Path -Path \\\"Registry::$RootKey\\\" -ChildPath $CredDelKey) -Force -Recurse\\n                Exit 1\\n            }\\n\\n            Try {\\n                $Null = Enable-WSManCredSSP -Role 'Client' -DelegateComputer '*' -Force -ErrorAction Stop\\n                $Null = Enable-WSManCredSSP -Role 'Server' -Force -ErrorAction Stop\\n            } Catch [System.Exception] {\\n                Write-Output \\\"Failed to enable CredSSP $_\\\"\\n                $Null = Disable-WSManCredSSP -Role 'Client' -ErrorAction SilentlyContinue\\n                $Null = Disable-WSManCredSSP -Role 'Server' -ErrorAction SilentlyContinue\\n                Exit 1\\n            }\\n        }\\n        'Disable' {\\n            Write-Output 'Disabling CredSSP'\\n            Try {\\n                Disable-WSManCredSSP -Role 'Client' -ErrorAction Continue\\n                Disable-WSManCredSSP -Role 'Server' -ErrorAction Stop\\n            } Catch [System.Exception] {\\n                Write-Output \\\"Failed to disable CredSSP $_\\\"\\n                Exit 1\\n            }\\n\\n            Write-Output 'Removing CredSSP registry entries'\\n            Try {\\n                Remove-Item -Path (Join-Path -Path \\\"Registry::$RootKey\\\" -ChildPath $CredDelKey) -Force -Recurse -ErrorAction Stop\\n            } Catch [System.Exception] {\\n                Write-Output \\\"Failed to remove CredSSP registry entries $_\\\"\\n                Exit 1\\n            }\\n        }\\n        Default { \\n            Write-Output 'InvalidArgument: Invalid value is passed for parameter Action'\\n            Exit 1\\n        }\\n    }\\n}\\n\\nFunction New-TemplateOID {\\n    [CmdletBinding()]\\n    param(\\n        [Parameter(Mandatory = $true)][string]$Server,\\n        [Parameter(Mandatory = $true)][string]$ConfigNC\\n    )\\n\\n    $Hex = '0123456789ABCDEF'\\n\\n    Do {\\n        [string]$RandomHex = $null\\n        For ($i = 1; $i -le 32; $i++) {\\n            $RandomHex += $Hex.Substring((Get-Random -Minimum 0 -Maximum 16), 1)\\n        }\\n\\n        $OID_Part_1 = Get-Random -Minimum 1000000 -Maximum 99999999\\n        $OID_Part_2 = Get-Random -Minimum 10000000 -Maximum 99999999\\n        $OID_Part_3 = $RandomHex\\n        $OID_Forest = Get-ADObject -Server $Server -Identity \\\"CN=OID,CN=Public Key Services,CN=Services,$ConfigNC\\\" -Properties msPKI-Cert-Template-OID | Select-Object -ExpandProperty msPKI-Cert-Template-OID -ErrorAction SilentlyContinue\\n        $msPKICertTemplateOID = \\\"$OID_Forest.$OID_Part_1.$OID_Part_2\\\"\\n        $Name = \\\"$OID_Part_2.$OID_Part_3\\\"\\n        $Search = Get-ADObject -Server $Server -SearchBase \\\"CN=OID,CN=Public Key Services,CN=Services,$ConfigNC\\\" -Filter { cn -eq $Name -and msPKI-Cert-Template-OID -eq $msPKICertTemplateOID } -ErrorAction SilentlyContinue\\n        If ($Search) { \\n            $Unique = 'False'\\n        } Else { \\n            $Unique = 'True'\\n        }\\n    } Until ($Unique = 'True')\\n    Return @{\\n        TemplateOID  = $msPKICertTemplateOID\\n        TemplateName = $Name\\n    }\\n}\\n\\nFunction New-KerbCertTemplate {\\n    [CmdletBinding()]\\n    param(\\n        [Parameter(Mandatory = $true)][string]$BaseDn,\\n        [Parameter(Mandatory = $true)][PSCredential]$Credential,\\n        [Parameter(Mandatory = $true)][string]$Server\\n    )\\n\\n    $CA = $env:COMPUTERNAME\\n\\n    $OID = New-TemplateOID -Server $Server -ConfigNC \\\"CN=Configuration,$BaseDn\\\"\\n\\n    $TemplateOIDPath = \\\"CN=OID,CN=Public Key Services,CN=Services,CN=Configuration,$BaseDn\\\"\\n    $OidOtherAttributes = @{\\n        'DisplayName'             = 'LdapOverSSL'\\n        'flags'                   = [System.Int32]'1'\\n        'msPKI-Cert-Template-OID' = $OID.TemplateOID\\n    }\\n\\n    $OtherAttributes = @{\\n        'flags'                                = [System.Int32]'131168'\\n        'msPKI-Certificate-Application-Policy' = [Microsoft.ActiveDirectory.Management.ADPropertyValueCollection]@('1.3.6.1.5.2.3.5', '1.3.6.1.4.1.311.20.2.2', '1.3.6.1.5.5.7.3.1', '1.3.6.1.5.5.7.3.2')\\n        'msPKI-Certificate-Name-Flag'          = [System.Int32]'138412032'\\n        'msPKI-Enrollment-Flag'                = [System.Int32]'40'\\n        'msPKI-Minimal-Key-Size'               = [System.Int32]'2048'\\n        'msPKI-Private-Key-Flag'               = [System.Int32]'84279552'\\n        'msPKI-Template-Minor-Revision'        = [System.Int32]'1'\\n        'msPKI-Template-Schema-Version'        = [System.Int32]'4'\\n        'msPKI-RA-Signature'                   = [System.Int32]'0'\\n        'pKIMaxIssuingDepth'                   = [System.Int32]'0'\\n        'ObjectClass'                          = [System.String]'pKICertificateTemplate'\\n        'pKICriticalExtensions'                = [Microsoft.ActiveDirectory.Management.ADPropertyValueCollection]@('2.5.29.17', '2.5.29.15')\\n        'pKIDefaultCSPs'                       = [Microsoft.ActiveDirectory.Management.ADPropertyValueCollection]@('1,Microsoft RSA SChannel Cryptographic Provider')\\n        'pKIDefaultKeySpec'                    = [System.Int32]'1'\\n        'pKIExpirationPeriod'                  = [System.Byte[]]@('0', '64', '57', '135', '46', '225', '254', '255')\\n        'pKIExtendedKeyUsage'                  = [Microsoft.ActiveDirectory.Management.ADPropertyValueCollection]@('1.3.6.1.5.2.3.5', '1.3.6.1.4.1.311.20.2.2', '1.3.6.1.5.5.7.3.1', '1.3.6.1.5.5.7.3.2')\\n        'pKIKeyUsage'                          = [System.Byte[]]@('160', '0')\\n        'pKIOverlapPeriod'                     = [System.Byte[]]@('0', '128', '166', '10', '255', '222', '255', '255')\\n        'revision'                             = [System.Int32]'100'\\n        'msPKI-Cert-Template-OID'              = $OID.TemplateOID\\n    }\\n\\n    Write-Output \\\"Creating new LdapOverSSL certificate template OID $_\\\"\\n    Try {\\n        New-ADObject -Path $TemplateOIDPath -OtherAttributes $OidOtherAttributes -Name $OID.TemplateName -Type 'msPKI-Enterprise-Oid' -Server $Server -Credential $Credential -ErrorAction Stop\\n    } Catch [System.Exception] {\\n        Write-Output \\\"Failed to create new LdapOverSSL certificate template OID $_\\\"\\n        Exit 1\\n    }\\n\\n    $TemplatePath = \\\"CN=Certificate Templates,CN=Public Key Services,CN=Services,CN=Configuration,$BaseDn\\\"\\n\\n    Write-Output \\\"Creating new LdapOverSSL certificate template $_\\\"\\n    Try {\\n        New-ADObject -Path $TemplatePath -OtherAttributes $OtherAttributes -Name 'LdapOverSSL' -DisplayName 'LdapOverSSL' -Type 'pKICertificateTemplate' -Server $Server -Credential $Credential -ErrorAction Stop\\n    } Catch [System.Exception] {\\n        Write-Output \\\"Failed to create new LdapOverSSL certificate template $_\\\"\\n        Exit 1\\n    }\\n\\n    $SidsToAdd = @(\\n        [Security.Principal.SecurityIdentifier]'S-1-5-9'\\n        (Get-ADGroup -Identity 'Domain Controllers' | Select-Object -ExpandProperty 'SID')\\n    )\\n\\n    $SidsToRemove = @(\\n        [Security.Principal.SecurityIdentifier]'S-1-5-18',\\n        (Get-ADGroup -Identity 'Domain Admins' | Select-Object -ExpandProperty 'SID')\\n    )\\n\\n    Set-CredSSP -Action 'Enable'\\n\\n    Write-Output 'Sleeping to ensure replication of certificate template has completed'\\n    Start-Sleep -Seconds 60\\n\\n    Write-Output 'Cleaning up ACLs on LdapOverSSL certificate template'\\n    $ExtendedRightGuids = @(\\n        [GUID]'0e10c968-78fb-11d2-90d4-00c04f79dc55',\\n        [GUID]'a05b8cc2-17bc-4802-a710-e7c15ab866a2'\\n    )\\n    Foreach ($SidToAdd in $SidsToAdd) {\\n        Add-CertTemplateAcl -Credential $Credential -Path \\\"CN=LdapOverSSL,CN=Certificate Templates,CN=Public Key Services,CN=Services,CN=Configuration,$BaseDn\\\" -IdentityReference $SidToAdd -ActiveDirectoryRights 'GenericRead,GenericWrite,WriteDacl,WriteOwner,Delete' -AccessControlType 'Allow' -ActiveDirectorySecurityInheritance 'None'\\n\\n        Foreach ($ExtendedRightGuid in $ExtendedRightGuids) {\\n            Add-CertTemplateAcl -Credential $Credential -Path \\\"CN=LdapOverSSL,CN=Certificate Templates,CN=Public Key Services,CN=Services,CN=Configuration,$BaseDn\\\" -IdentityReference $SidToAdd -ActiveDirectoryRights 'ExtendedRight' -AccessControlType 'Allow' -ObjectGuid $ExtendedRightGuid -ActiveDirectorySecurityInheritance 'None'\\n        }\\n    }\\n\\n    Set-CertTemplateAclInheritance -Credential $Credential -Path \\\"CN=LdapOverSSL,CN=Certificate Templates,CN=Public Key Services,CN=Services,CN=Configuration,$BaseDn\\\"\\n\\n    Foreach ($SidToRemove in $SidsToRemove) {\\n        Remove-CertTemplateAcl -Credential $Credential -Path \\\"CN=LdapOverSSL,CN=Certificate Templates,CN=Public Key Services,CN=Services,CN=Configuration,$BaseDn\\\" -IdentityReference $SidToRemove -AccessControlType 'Allow'\\n    }\\n\\n    Write-Output \\\"Publishing LdapOverSSL template to allow enrollment\\\"\\n    $Counter = 0\\n    Do {\\n        $TempPresent = $Null\\n        Try {\\n            $TempPresent = Invoke-Command -Authentication 'Credssp' -ComputerName $env:COMPUTERNAME -Credential $Credential -ScriptBlock { \\n                Get-ADObject \\\"CN=$Using:CA,CN=Enrollment Services,CN=Public Key Services,CN=Services,CN=Configuration,$Using:BaseDn\\\" -Partition \\\"CN=Configuration,$Using:BaseDn\\\" -Properties 'certificateTemplates' | Select-Object -ExpandProperty 'certificateTemplates' | Where-Object { $_ -contains 'LdapOverSSL' }\\n            }\\n        } Catch [System.Exception] {\\n            Write-Output \\\"LdapOverSSL Template missing\\\"\\n            $TempPresent = $Null\\n        }\\n        If (-not $TempPresent) {\\n            $Counter ++\\n            Write-Output \\\"LdapOverSSL Template missing adding it.\\\"\\n            Try {\\n                Invoke-Command -Authentication 'Credssp' -ComputerName $env:COMPUTERNAME -Credential $Credential -ScriptBlock {\\n                    Set-ADObject \\\"CN=$Using:CA,CN=Enrollment Services,CN=Public Key Services,CN=Services,CN=Configuration,$Using:BaseDn\\\" -Partition \\\"CN=Configuration,$Using:BaseDn\\\" -Add @{ 'certificateTemplates' = 'LdapOverSSL' } \\n                }\\n            } Catch [System.Exception] {\\n                Write-Output \\\"Failed to add publish LdapOverSSL template $_\\\"\\n            }\\n            If ($Counter -gt '1') {\\n                Start-Sleep -Seconds 10\\n            }\\n        }\\n    } Until ($TempPresent -or $Counter -eq 12)\\n\\n    Write-Output 'Sleeping to ensure replication of certificate template publish has completed'\\n    Start-Sleep -Seconds 60\\n\\n    Set-CredSSP -Action 'Disable'\\n}\\n\\nFunction Add-CertTemplateAcl {\\n    [CmdletBinding()]\\n    param(\\n        [Parameter(Mandatory = $true)][PSCredential]$Credential,\\n        [Parameter(Mandatory = $true)][string]$Path,\\n        [Parameter(Mandatory = $true)][Security.Principal.SecurityIdentifier]$IdentityReference,\\n        [Parameter(Mandatory = $true)][System.DirectoryServices.ActiveDirectoryRights]$ActiveDirectoryRights,\\n        [Parameter(Mandatory = $true)][System.Security.AccessControl.AccessControlType]$AccessControlType,\\n        [Parameter(Mandatory = $false)][Guid]$ObjectGuid,\\n        [Parameter(Mandatory = $false)][System.DirectoryServices.ActiveDirectorySecurityInheritance]$ActiveDirectorySecurityInheritance,\\n        [Parameter(Mandatory = $false)][Guid]$InheritedObjectGuid\\n    )\\n\\n    Invoke-Command -Authentication 'Credssp' -ComputerName $env:COMPUTERNAME -Credential $Credential -ScriptBlock {\\n        Import-Module -Name 'ActiveDirectory' -Force\\n\\n        [Security.Principal.SecurityIdentifier]$IdentityReference = $Using:IdentityReference | Select-Object -ExpandProperty 'Value'\\n\\n        $ArgumentList = $IdentityReference, $Using:ActiveDirectoryRights, $Using:AccessControlType, $Using:ObjectGuid, $Using:ActiveDirectorySecurityInheritance, $Using:InheritedObjectGuid\\n        $ArgumentList = $ArgumentList.Where({ $_ -ne $Null })\\n\\n        Write-Output 'Creating ACL object'\\n        Try {\\n            $Rule = New-Object -TypeName 'System.DirectoryServices.ActiveDirectoryAccessRule' -ArgumentList $ArgumentList -ErrorAction Stop\\n        } Catch [System.Exception] {\\n            Write-Output \\\"Failed to create ACL object $_\\\"\\n            Exit 1\\n        }\\n\\n        Write-Output \\\"Getting ACL for $Using:Path\\\"\\n        Try {\\n            $ObjectAcl = Get-Acl -Path \\\"AD:\\\\$Using:Path\\\" -ErrorAction Stop\\n        } Catch [System.Exception] {\\n            Write-Output \\\"Failed to get ACL for $Using:Path $_\\\"\\n            Exit 1\\n        }\\n\\n        $ObjectAcl.AddAccessRule($Rule) \\n\\n        Write-Output \\\"Setting ACL for $Using:Path\\\"\\n        Try {\\n            Set-Acl -AclObject $ObjectAcl -Path \\\"AD:\\\\$Using:Path\\\" -ErrorAction Stop\\n        } Catch [System.Exception] {\\n            Write-Output \\\"Failed to set ACL for $Using:Path $_\\\"\\n            Exit 1\\n        }\\n    }\\n}\\n\\nFunction Set-CertTemplateAclInheritance {\\n    [CmdletBinding()]\\n    param(\\n        [Parameter(Mandatory = $true)][PSCredential]$Credential,\\n        [Parameter(Mandatory = $true)][string]$Path\\n    )\\n\\n    Invoke-Command -Authentication 'Credssp' -ComputerName $env:COMPUTERNAME -Credential $Credential -ScriptBlock {\\n        Import-Module -Name 'ActiveDirectory' -Force -ErrorAction Stop\\n\\n        Write-Output \\\"Getting ACL for $Using:Path\\\"\\n        Try {\\n            $ObjectAcl = Get-Acl -Path \\\"AD:\\\\$Using:Path\\\" -ErrorAction Stop\\n        } Catch [System.Exception] {\\n            Write-Output \\\"Failed to get ACL for $Using:Path $_\\\"\\n            Exit 1\\n        }\\n\\n        $ObjectAcl.SetAccessRuleProtection($true, $false)\\n\\n        Write-Output \\\"Setting ACL for $Using:Path\\\"\\n        Try {\\n            Set-Acl -AclObject $ObjectAcl -Path \\\"AD:\\\\$Using:Path\\\" -ErrorAction Stop\\n        } Catch [System.Exception] {\\n            Write-Output \\\"Failed to set ACL for $Using:Path $_\\\"\\n            Exit 1\\n        }\\n    }\\n}\\n\\nFunction Remove-CertTemplateAcl {\\n    [CmdletBinding()]\\n    param(\\n        [Parameter(Mandatory = $true)][PSCredential]$Credential,\\n        [Parameter(Mandatory = $true)][string]$Path,\\n        [Parameter(Mandatory = $true)][Security.Principal.SecurityIdentifier]$IdentityReference,\\n        [Parameter(Mandatory = $true)][System.Security.AccessControl.AccessControlType]$AccessControlType\\n    )\\n\\n    Invoke-Command -Authentication 'Credssp' -ComputerName $env:COMPUTERNAME -Credential $Credential -ScriptBlock {\\n        Import-Module -Name 'ActiveDirectory' -Force -ErrorAction Stop\\n\\n        Write-Output \\\"Getting ACL for $Using:Path\\\"\\n        Try {\\n            $ObjectAcl = Get-Acl -Path \\\"AD:\\\\$Using:Path\\\" -ErrorAction Stop\\n        } Catch [System.Exception] {\\n            Write-Output \\\"Failed to get ACL for $Using:Path $_\\\"\\n            Exit 1\\n        }\\n\\n        [Security.Principal.SecurityIdentifier]$IdentityReference = $Using:IdentityReference | Select-Object -ExpandProperty 'Value'\\n\\n        $ObjectAcl.RemoveAccess($IdentityReference, $Using:AccessControlType)\\n\\n        Write-Output \\\"Removing ACL for $Using:Path\\\"\\n        Try {\\n            Set-Acl -AclObject $ObjectAcl -Path \\\"AD:\\\\$Using:Path\\\" -ErrorAction Stop\\n        } Catch [System.Exception] {\\n            Write-Output \\\"Failed to remove ACL for $Using:Path $_\\\"\\n            Exit 1\\n        }\\n    }\\n}\\n\\n$Secret = Get-SecretInfo -Domain '{{DomainNetBIOSName}}' -SecretArn '{{AdministratorSecretName}}'\\n$DeploymentType = '{{DeploymentType}}'\\n\\nIf ($DeploymentType -eq 'EnterpriseCA' -or $DeploymentType -eq 'EnterpriseCAManagementInstance') {\\n    Invoke-EnterpriseCaConfig -Credentials $Secret.DomainCredentials -DomainType '{{DomainType}}' -EntCaCommonName '{{ServerNetBIOSName}}' -EntCaHashAlgorithm 'SHA256' -EntCaKeyLength '2048' -EntCaValidityPeriodUnits '5' -VPCCIDR '{{VPCCIDR}}'\\n}\"\r\n      },\r\n      \"CloudWatchOutputConfig\" : {\r\n        \"CloudWatchOutputEnabled\" : true,\r\n        \"CloudWatchLogGroupName\" : \"/aws/Demo/{{StackName}}\"\r\n      },\r\n      \"InstanceIds\" : [ \"{{InstanceId.InstanceId}}\" ],\r\n      \"DocumentName\" : \"AWS-RunPowerShellScript\"\r\n    },\r\n    \"name\" : \"configureInstance\",\r\n    \"action\" : \"aws:runCommand\"\r\n  } ]\r\n}\r\n",
            "created_date": "2022-07-12T02:29:26Z",
            "default_version": "1",
            "description": "Deploy Enterpise CA",
            "document_format": "YAML",
            "document_type": "Automation",
            "document_version": "1",
            "hash": "da6e63ecc76b90f1af88eb0d3d2121060598856244fc614938a4f1b7fde87bf7",
            "hash_type": "Sha256",
            "id": "SSM-Pki-dnb6z912",
            "latest_version": "1",
            "name": "SSM-Pki-dnb6z912",
            "owner": "156285977455",
            "parameter": [
              {
                "default_value": "",
                "description": "NetBIOS name of the first Active Directory Domain Controller (up to 15 characters)",
                "name": "ServerNetBIOSName",
                "type": "String"
              },
              {
                "default_value": "",
                "description": "Type of domain PKI will be integrated with",
                "name": "DomainType",
                "type": "String"
              },
              {
                "default_value": "",
                "description": "NetBIOS name of the domain (up to 15 characters) for users of earlier versions of Windows e.g. ONPREMISES",
                "name": "DomainNetBIOSName",
                "type": "String"
              },
              {
                "default_value": "",
                "description": "CIDR Block for the VPC",
                "name": "VPCCIDR",
                "type": "String"
              },
              {
                "default_value": "",
                "description": "AWS Secrets Parameter Name",
                "name": "AdministratorSecretName",
                "type": "String"
              },
              {
                "default_value": "",
                "description": "Type of workload being deployed",
                "name": "DeploymentType",
                "type": "String"
              },
              {
                "default_value": "",
                "description": "Stack Name Input for cfn resource signal",
                "name": "StackName",
                "type": "String"
              }
            ],
            "permissions": null,
            "platform_types": [
              "Windows",
              "Linux",
              "MacOS"
            ],
            "schema_version": "0.3",
            "status": "Active",
            "tags": null,
            "tags_all": {},
            "target_type": "",
            "version_name": ""
          },
          "sensitive_attributes": [],
          "private": "bnVsbA==",
          "dependencies": [
            "random_string.random_string"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_subnet",
      "name": "network_subnet1",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 1,
          "attributes": {
            "arn": "arn:aws:ec2:us-east-2:156285977455:subnet/subnet-028bf321af9ed43b0",
            "assign_ipv6_address_on_creation": false,
            "availability_zone": "us-east-2a",
            "availability_zone_id": "use2-az1",
            "cidr_block": "10.0.0.0/26",
            "customer_owned_ipv4_pool": "",
            "enable_dns64": false,
            "enable_resource_name_dns_a_record_on_launch": false,
            "enable_resource_name_dns_aaaa_record_on_launch": false,
            "id": "subnet-028bf321af9ed43b0",
            "ipv6_cidr_block": "",
            "ipv6_cidr_block_association_id": "",
            "ipv6_native": false,
            "map_customer_owned_ip_on_launch": false,
            "map_public_ip_on_launch": true,
            "outpost_arn": "",
            "owner_id": "156285977455",
            "private_dns_hostname_type_on_launch": "ip-name",
            "tags": {
              "Name": "Demo-VPC-Subnet1-dnb6z912"
            },
            "tags_all": {
              "Name": "Demo-VPC-Subnet1-dnb6z912"
            },
            "timeouts": null,
            "vpc_id": "vpc-04a2f5c1bfcfaf737"
          },
          "sensitive_attributes": [],
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjo2MDAwMDAwMDAwMDAsImRlbGV0ZSI6MTIwMDAwMDAwMDAwMH0sInNjaGVtYV92ZXJzaW9uIjoiMSJ9",
          "dependencies": [
            "aws_vpc.network",
            "data.aws_availability_zones.available",
            "random_string.random_string"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_subnet",
      "name": "network_subnet2",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 1,
          "attributes": {
            "arn": "arn:aws:ec2:us-east-2:156285977455:subnet/subnet-096dcdd45474860ae",
            "assign_ipv6_address_on_creation": false,
            "availability_zone": "us-east-2b",
            "availability_zone_id": "use2-az2",
            "cidr_block": "10.0.0.64/26",
            "customer_owned_ipv4_pool": "",
            "enable_dns64": false,
            "enable_resource_name_dns_a_record_on_launch": false,
            "enable_resource_name_dns_aaaa_record_on_launch": false,
            "id": "subnet-096dcdd45474860ae",
            "ipv6_cidr_block": "",
            "ipv6_cidr_block_association_id": "",
            "ipv6_native": false,
            "map_customer_owned_ip_on_launch": false,
            "map_public_ip_on_launch": true,
            "outpost_arn": "",
            "owner_id": "156285977455",
            "private_dns_hostname_type_on_launch": "ip-name",
            "tags": {
              "Name": "Demo-VPC-Subnet2-dnb6z912"
            },
            "tags_all": {
              "Name": "Demo-VPC-Subnet2-dnb6z912"
            },
            "timeouts": null,
            "vpc_id": "vpc-04a2f5c1bfcfaf737"
          },
          "sensitive_attributes": [],
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjo2MDAwMDAwMDAwMDAsImRlbGV0ZSI6MTIwMDAwMDAwMDAwMH0sInNjaGVtYV92ZXJzaW9uIjoiMSJ9",
          "dependencies": [
            "aws_vpc.network",
            "data.aws_availability_zones.available",
            "random_string.random_string"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_vpc",
      "name": "network",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 1,
          "attributes": {
            "arn": "arn:aws:ec2:us-east-2:156285977455:vpc/vpc-04a2f5c1bfcfaf737",
            "assign_generated_ipv6_cidr_block": false,
            "cidr_block": "10.0.0.0/24",
            "default_network_acl_id": "acl-08a8d308ad7768396",
            "default_route_table_id": "rtb-0d3753644c7723c1f",
            "default_security_group_id": "sg-00380b5aaea674e4d",
            "dhcp_options_id": "dopt-48377323",
            "enable_classiclink": false,
            "enable_classiclink_dns_support": false,
            "enable_dns_hostnames": true,
            "enable_dns_support": true,
            "id": "vpc-04a2f5c1bfcfaf737",
            "instance_tenancy": "default",
            "ipv4_ipam_pool_id": null,
            "ipv4_netmask_length": null,
            "ipv6_association_id": "",
            "ipv6_cidr_block": "",
            "ipv6_cidr_block_network_border_group": "",
            "ipv6_ipam_pool_id": "",
            "ipv6_netmask_length": 0,
            "main_route_table_id": "rtb-0d3753644c7723c1f",
            "owner_id": "156285977455",
            "tags": {
              "Name": "Demo-VPC-dnb6z912"
            },
            "tags_all": {
              "Name": "Demo-VPC-dnb6z912"
            }
          },
          "sensitive_attributes": [],
          "private": "eyJzY2hlbWFfdmVyc2lvbiI6IjEifQ==",
          "dependencies": [
            "random_string.random_string"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "random_password",
      "name": "secret_fsx",
      "provider": "provider[\"registry.terraform.io/hashicorp/random\"]",
      "instances": [
        {
          "schema_version": 2,
          "attributes": {
            "bcrypt_hash": "$2a$10$iNy.8.UZ0JJyTtPaITLtZe9.6UUxRCMYxfPL9Sxyyry0cenJ7T16a",
            "id": "none",
            "keepers": null,
            "length": 32,
            "lower": true,
            "min_lower": 0,
            "min_numeric": 0,
            "min_special": 0,
            "min_upper": 0,
            "number": true,
            "numeric": true,
            "override_special": "!#$%\u0026*()-_=+[]{}\u003c\u003e:?",
            "result": "0}o9PJME!{c%N)wTm\u003caP?IYLEBXf5#aF",
            "special": true,
            "upper": true
          },
          "sensitive_attributes": [],
          "private": "eyJzY2hlbWFfdmVyc2lvbiI6IjIifQ=="
        }
      ]
    },
    {
      "mode": "managed",
      "type": "random_password",
      "name": "secret_mad",
      "provider": "provider[\"registry.terraform.io/hashicorp/random\"]",
      "instances": [
        {
          "schema_version": 2,
          "attributes": {
            "bcrypt_hash": "$2a$10$st/zwez7KRRL4q0Q05RSC.rEogTEve3GQ9/ERd4LGPGDkvDgDmDQq",
            "id": "none",
            "keepers": null,
            "length": 32,
            "lower": true,
            "min_lower": 0,
            "min_numeric": 0,
            "min_special": 0,
            "min_upper": 0,
            "number": true,
            "numeric": true,
            "override_special": "!#$%\u0026*()-_=+[]{}\u003c\u003e:?",
            "result": "1g3?D!l3?1Nv3Ve-i1L=qmkH4#Q3bSTE",
            "special": true,
            "upper": true
          },
          "sensitive_attributes": [],
          "private": "eyJzY2hlbWFfdmVyc2lvbiI6IjIifQ=="
        }
      ]
    },
    {
      "mode": "managed",
      "type": "random_password",
      "name": "secret_onprem",
      "provider": "provider[\"registry.terraform.io/hashicorp/random\"]",
      "instances": [
        {
          "schema_version": 2,
          "attributes": {
            "bcrypt_hash": "$2a$10$0U1S9D4UBYkdprztrQ331OA7BqO2WuG02z/bQTFLVNsGkqC.FbuZ.",
            "id": "none",
            "keepers": null,
            "length": 32,
            "lower": true,
            "min_lower": 0,
            "min_numeric": 0,
            "min_special": 0,
            "min_upper": 0,
            "number": true,
            "numeric": true,
            "override_special": "!#$%\u0026*()-_=+[]{}\u003c\u003e:?",
            "result": "l5Nrq[H[46BV9Hj8EiZiyW8ZpIm?Vi?s",
            "special": true,
            "upper": true
          },
          "sensitive_attributes": [],
          "private": "eyJzY2hlbWFfdmVyc2lvbiI6IjIifQ=="
        }
      ]
    },
    {
      "mode": "managed",
      "type": "random_password",
      "name": "secret_rds",
      "provider": "provider[\"registry.terraform.io/hashicorp/random\"]",
      "instances": [
        {
          "schema_version": 2,
          "attributes": {
            "bcrypt_hash": "$2a$10$clZO5JEpp1cyYITErWb3kuKC8EUj8Z8dtXlrCDIfAtBFfkG.l4wj2",
            "id": "none",
            "keepers": null,
            "length": 32,
            "lower": true,
            "min_lower": 0,
            "min_numeric": 0,
            "min_special": 0,
            "min_upper": 0,
            "number": true,
            "numeric": true,
            "override_special": "!#$%\u0026*()-_=+[]{}\u003c\u003e:?",
            "result": "XNb(n+oM=\u0026PFmt+{u{KB3d8iMi]a+jGz",
            "special": true,
            "upper": true
          },
          "sensitive_attributes": [],
          "private": "eyJzY2hlbWFfdmVyc2lvbiI6IjIifQ=="
        }
      ]
    },
    {
      "mode": "managed",
      "type": "random_string",
      "name": "random_string",
      "provider": "provider[\"registry.terraform.io/hashicorp/random\"]",
      "instances": [
        {
          "schema_version": 2,
          "attributes": {
            "id": "dnb6z912",
            "keepers": null,
            "length": 8,
            "lower": true,
            "min_lower": 0,
            "min_numeric": 0,
            "min_special": 0,
            "min_upper": 0,
            "number": true,
            "numeric": true,
            "override_special": null,
            "result": "dnb6z912",
            "special": false,
            "upper": false
          },
          "sensitive_attributes": [],
          "private": "eyJzY2hlbWFfdmVyc2lvbiI6IjIifQ=="
        }
      ]
    }
  ]
}
